const e=e=>typeof e,n=e(""),t=e(!0),l=e(0),r=e(e),o=(e,n)=>e.every(n),s=(e,n)=>e.forEach(n),i=e=>u(e,((e,n)=>e+n),0),a=e=>e.length,d=e=>0==a(e),u=(e,n,t)=>e.reduce(n,t),c=(e,...n)=>e.push(...n),v=Math.max,h=Math.min,w=isFinite,f=e=>null==e,g=(e,n,t)=>f(e)?null==t?void 0:t():n(e),R=n=>e(n)==r,y=e=>Array.isArray(e),L=()=>{},p=e=>e.size,b=(e,n)=>{var t;return null!=(t=null==e?void 0:e.has(n))&&t},T=e=>f(e)||0==p(e),m=e=>{var n;return[...null!=(n=null==e?void 0:e.values())?n:[]]},C=e=>e.clear(),I=(e,n)=>null==e?void 0:e.forEach(n),O=(e,n)=>null==e?void 0:e.delete(n),S=e=>new Map(e),j=(e,n)=>null==e?void 0:e.get(n),x=(e,n)=>I(e,((e,t)=>n(t,e))),E=(e,n,t)=>f(t)?(O(e,n),e):null==e?void 0:e.set(n,t),Q=(e,n,t)=>(b(e,n)||E(e,n,t()),j(e,n)),M=(e,n,t,l,r=0)=>g((t?Q:j)(e,n[r],r>a(n)-2?t:S),(o=>{if(r>a(n)-2)return(null==l?void 0:l(o))&&E(e,n[r]),o;const s=M(o,n,t,l,r+1);return T(o)&&E(e,n[r]),s})),D=e=>new Set(y(e)||f(e)?e:[e]),F=(e,n)=>null==e?void 0:e.add(n),k=S([["avg",[(e,n)=>i(e)/n,(e,n,t)=>e+(n-e)/(t+1),(e,n,t)=>e+(e-n)/(t-1),(e,n,t,l)=>e+(n-t)/l]],["max",[e=>v(...e),(e,n)=>v(n,e),(e,n)=>n==e?void 0:e,(e,n,t)=>t==e?void 0:v(n,e)]],["min",[e=>h(...e),(e,n)=>h(n,e),(e,n)=>n==e?void 0:e,(e,n,t)=>t==e?void 0:h(n,e)]],["sum",[e=>i(e),(e,n)=>e+n,(e,n)=>e-n,(e,n,t)=>e-t+n]]]),z=Object,A=z.freeze;var P=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;const B=(r=>{const i=new WeakMap;return r=>(i.has(r)||i.set(r,(r=>{const i=r.createStore,[u,v,h,B,G,,,H,,J,K,N,U]=((e,n,t)=>{const l=e.hasRow,r=S(),i=S(),u=S(),c=S(),v=S(),h=(n,t,...l)=>{const r=Q(v,n,D);return s(l,(n=>F(r,n)&&t&&e.callListener(n))),l},w=(n,...t)=>g(j(v,n),(l=>{s(d(t)?m(l):t,(n=>{e.delListener(n),O(l,n)})),T(l)&&E(v,n)})),R=(e,n)=>{E(r,e,n),b(i,e)||(E(i,e,!0),E(u,e,S()),E(c,e,S()))},L=e=>{E(r,e),E(i,e),E(u,e),E(c,e),w(e)};return[()=>e,()=>{return[...null!=(n=null==(e=r)?void 0:e.keys())?n:[]];var e,n},e=>x(i,e),e=>b(i,e),e=>j(r,e),e=>j(i,e),(e,n)=>E(i,e,n),R,(n,r,i,d,v)=>{R(n,r);const g=S(),L=S(),p=j(u,n),T=j(c,n),m=n=>{const s=t=>e.getCell(r,n,t),i=j(p,n),u=l(r,n)?t(d(s,n)):void 0;var c,h;if(i===u||y(i)&&y(u)&&(h=u,a(c=i)===a(h)&&o(c,((e,n)=>h[n]===e)))||E(g,n,[i,u]),!f(v)){const e=j(T,n),t=l(r,n)?v(s,n):void 0;e!=t&&E(L,n,t)}},O=e=>{i((()=>{I(g,(([,e],n)=>E(p,n,e))),I(L,((e,n)=>E(T,n,e)))}),g,L,p,T,e),C(g),C(L)};x(p,m),e.hasTable(r)&&s(e.getRowIds(r),(e=>{b(p,e)||m(e)})),O(!0),w(n),h(n,0,e.addRowListener(r,null,((e,n,t)=>m(t))),e.addTableListener(r,(()=>O())))},L,()=>x(v,L),h,w]})(r,0,L),V=i(),X=i(),Y=S(),Z=(e,n,...t)=>s(t,(t=>F(Q(Q(Y,n,S),e,D),t))),$=e=>{g(j(Y,e),(e=>{x(e,((e,n)=>I(n,(n=>e.delListener(n))))),C(e)})),s([X,V],(n=>n.delTable(e)))},_=(e,n,t)=>Z(n,e,n.addWillFinishTransactionListener(t.startTransaction),n.addDidFinishTransactionListener((()=>t.finishTransaction()))),ee={setQueryDefinition:(i,u,v)=>{H(i,u),$(i);const h=[],y=[[null,[u,null,null,[],S()]]],L=[],C=[],z=[];v({select:(e,n)=>{const t=R(e)?[a(h)+"",e]:[f(n)?e:n,t=>t(e,n)];return c(h,t),{as:e=>t[0]=e}},join:(e,n,t)=>{const l=f(t)||R(n)?null:n,r=f(l)?n:t,o=[e,[e,l,R(r)?r:e=>e(r),[],S()]];return c(y,o),{as:e=>o[0]=e}},where:(e,n,t)=>c(L,R(e)?e:f(t)?t=>t(e)===n:l=>l(e,n)===t),group:(e,n,t,l,r)=>{var o;const s=[e,[e,R(n)?[n,t,l,r]:null!=(o=j(k,n))?o:[(e,n)=>n]]];return c(C,s),{as:e=>s[0]=e}},having:(e,n)=>c(z,R(e)?e:t=>t(e)===n)});const A=S(h);if(T(A))return ee;const P=S(y);x(P,((e,[,n])=>g(j(P,n),(({3:n})=>f(e)?0:c(n,e)))));const W=S(C);let q=V;if(T(W)&&d(z))q=X;else{_(i,q,X);const r=S();x(W,((e,[n,t])=>F(Q(r,n,D),[e,t])));const s=D();x(A,(e=>b(r,e)?0:F(s,e)));const a=S(),d=(s,a,d,u)=>g(s,(([c,v,h,g])=>{x(a,((o,[s])=>{const i=Q(c,o,S),a=j(i,d),v=u?void 0:s;if(a!==v){const s=D([[a,v]]),u=p(i);E(i,d,v),I(j(r,o),(([r,o])=>{const a=((e,n,t,l,r,o=!1)=>{if(T(t))return;const[s,i,a,d]=r;return o||(o=f(e)),I(l,(([t,l])=>{o||(e=f(t)?null==i?void 0:i(e,l,n++):f(l)?null==a?void 0:a(e,t,n--):null==d?void 0:d(e,l,t,n),o||(o=f(e)))})),o?s(m(t),p(t)):e})(g[r],u,i,s,o);g[r]=f((r=>{const o=e(r);return(e=>e==n||e==t)(o)||o==l&&w(r)?o:void 0})(a))?null:a}))}})),T(v)||!o(z,(e=>e((e=>g[e]))))?X.delRow(i,h):f(h)?s[2]=X.addRow(i,g):X.setRow(i,h,g)}));Z(q,i,q.addRowListener(i,null,((e,n,t,l)=>{const o=[],u=[],v=S(),h=q.hasRow(i,t);let w=!h;I(s,(e=>{const[n,r,s]=l(i,t,e);c(o,r),c(u,s),w||(w=n)})),x(r,(e=>{const[n,,r]=l(i,t,e);(w||n)&&E(v,e,[r])})),w&&d(M(a,o,void 0,(([,e])=>(O(e,t),T(e)))),v,t,1),h&&d(M(a,u,(()=>{const e={};return I(s,(n=>e[n]=q.getCell(i,t,n))),[S(),D(),void 0,e]}),(([,e])=>{F(e,t)})),v,t)})))}_(i,r,q);const B=(e,n,t,l)=>{const a=e=>r.getCell(n,t,e);s(l,(n=>{var t;const[l,,o,s,d]=j(P,n),u=null==o?void 0:o(a,e),[c,v]=null!=(t=j(d,e))?t:[];u!=c&&(f(v)||U(i,v),E(d,e,f(u)?null:[u,...N(i,1,r.addRowListener(l,u,(()=>B(e,l,u,s))))]))})),(e=>{const n=(n,t)=>{var l,o,s;return r.getCell(...f(t)?[u,e,n]:n===u?[u,e,t]:[null==(l=j(P,n))?void 0:l[0],null==(s=j(null==(o=j(P,n))?void 0:o[4],e))?void 0:s[0],t])};q.transaction((()=>o(L,(e=>e(n)))?x(A,((t,l)=>((e,n,t,l,r)=>f(r)?e.delCell(n,t,l,!0):e.setCell(n,t,l,r))(q,i,e,t,l(n,e)))):q.delRow(i,e)))})(e)},{3:G}=j(P,null);return q.transaction((()=>N(i,1,r.addRowListener(u,null,((e,n,t)=>{r.hasRow(u,t)?B(t,u,t,G):(q.delRow(i,t),I(P,(({4:e})=>g(j(e,t),(([,n])=>{U(i,n),E(e,t)})))))}))))),ee},delQueryDefinition:e=>($(e),J(e),ee),getStore:u,getQueryIds:v,forEachQuery:h,hasQuery:B,getTableId:G,delListener:e=>(X.delListener(e),ee),destroy:K,getListenerStats:()=>((e,n)=>{var t={};for(var l in e)W.call(e,l)&&n.indexOf(l)<0&&(t[l]=e[l]);if(null!=e&&P)for(var l of P(e))n.indexOf(l)<0&&q.call(e,l)&&(t[l]=e[l]);return t})(X.getListenerStats(),["tables","tableIds","transaction"])};var ne,te;return ne={Table:[1,1],RowIds:[0,1],SortedRowIds:[0,5],Row:[1,2],CellIds:[0,2],Cell:[1,3]},te=([e,n],t)=>{s(e?["get","has","forEach"]:["get"],(e=>ee[e+"Result"+t]=(...n)=>X[e+t](...n))),ee["addResult"+t+"Listener"]=(...e)=>{return X["add"+t+"Listener"](...(l=e,0,r=n,l.slice(0,r)),((t,...l)=>e[n](ee,...l)));var l,r}},((e,n)=>{e.map(n)})(z.entries(ne),(([e,n])=>te(n,e))),A(ee)})(r)),i.get(r))})();export{B as createQueries};
