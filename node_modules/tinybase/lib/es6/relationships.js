const e=e=>typeof e,n=e(""),t=(e,n)=>e.forEach(n),l=e=>e.length,r=(e,...n)=>e.push(...n),o=e=>null==e,s=(e,n,t)=>o(e)?null==t?void 0:t():n(e),i=e=>Array.isArray(e),u=(e,n)=>{var t;return null!=(t=null==e?void 0:e.has(n))&&t},d=e=>o(e)||0==(e=>e.size)(e),a=e=>{var n;return[...null!=(n=null==e?void 0:e.values())?n:[]]},c=e=>e.clear(),v=(e,n)=>null==e?void 0:e.forEach(n),R=(e,n)=>null==e?void 0:e.delete(n),h=e=>new Map(e),f=(e,n)=>null==e?void 0:e.get(n),L=(e,n)=>v(e,((e,t)=>n(t,e))),g=(e,n,t)=>o(t)?(R(e,n),e):null==e?void 0:e.set(n,t),w=(e,n,t)=>(u(e,n)||g(e,n,t()),f(e,n)),p=(e,n,t,r,o=0)=>s((t?w:f)(e,n[o],o>l(n)-2?t:h),(s=>{if(o>l(n)-2)return(null==r?void 0:r(s))&&g(e,n[o]),s;const i=p(s,n,t,r,o+1);return d(s)&&g(e,n[o]),i})),I=e=>new Set(i(e)||o(e)?e:[e]),y=(e,n)=>null==e?void 0:e.add(n),b=/^\d+$/,k=Object.freeze,E=(E=>{const T=new WeakMap;return E=>(T.has(E)||T.set(E,(E=>{const T=h(),m=h(),S=h(),z=h(),[A,D,M,j,x,C,,,O,W,$]=((e,n,r)=>{const p=e.hasRow,b=h(),k=h(),E=h(),T=h(),m=h(),S=(n,l,...r)=>{const o=w(m,n,I);return t(r,(n=>y(o,n)&&l&&e.callListener(n))),r},z=(n,...r)=>s(f(m,n),(o=>{t(0==l(r)?a(o):r,(n=>{e.delListener(n),R(o,n)})),d(o)&&g(m,n)})),A=(e,n)=>{g(b,e,n),u(k,e)||(g(k,e,[h(),h(),h(),h()]),g(E,e,h()),g(T,e,h()))},D=e=>{g(b,e),g(k,e),g(E,e),g(T,e),z(e)};return[()=>e,()=>{return[...null!=(n=null==(e=b)?void 0:e.keys())?n:[]];var e,n},e=>L(k,e),e=>u(k,e),e=>f(b,e),e=>f(k,e),(e,n)=>g(k,e,n),A,(n,r,s,d,a)=>{A(n,r);const R=h(),w=h(),I=f(E,n),y=f(T,n),b=n=>{const t=t=>e.getCell(r,n,t),s=f(I,n),u=p(r,n)?(c=d(t,n),o(c)?void 0:c+""):void 0;var c,v,h,L;if(s===u||i(s)&&i(u)&&(h=u,l(v=s)===l(h)&&(L=(e,n)=>h[n]===e,v.every(L)))||g(R,n,[s,u]),!o(a)){const e=f(y,n),l=p(r,n)?a(t,n):void 0;e!=l&&g(w,n,l)}},k=e=>{s((()=>{v(R,(([,e],n)=>g(I,n,e))),v(w,((e,n)=>g(y,n,e)))}),R,w,I,y,e),c(R),c(w)};L(I,b),e.hasTable(r)&&t(e.getRowIds(r),(e=>{u(I,e)||b(e)})),k(!0),z(n),S(n,0,e.addRowListener(r,null,((e,n,t)=>b(t))),e.addTableListener(r,(()=>k())))},D,()=>L(m,D),S,z]})(E),[q,B,F]=(e=>{let n;const[i,u]=(()=>{const e=[];let n=0;return[()=>{var t;return null!=(t=e.shift())?t:""+n++},n=>{b.test(n)&&l(e)<1e3&&r(e,n)}]})(),a=h();return[(e,t,l,r=[],o=(()=>[]))=>{null!=n||(n=K);const s=i();return g(a,s,[e,t,l,r,o]),y(p(t,null!=l?l:[""],I),s),s},(e,o,...s)=>t(((e,n=[""])=>{const o=[],s=(e,i)=>i==l(n)?r(o,e):null===n[i]?v(e,(e=>s(e,i+1))):t([n[i],null],(n=>s(f(e,n),i+1)));return s(e,0),o})(e,o),(e=>v(e,(e=>f(a,e)[0](n,...null!=o?o:[],...s))))),e=>s(f(a,e),(([,n,t])=>(p(n,null!=t?t:[""],void 0,(n=>(R(n,e),d(n)?1:0))),g(a,e),u(e),t))),e=>s(f(a,e),(([e,,r=[],s,i])=>{const u=(...d)=>{var a,c;const v=l(d);v==l(r)?e(n,...d,...i(d)):o(r[v])?t(null!=(c=null==(a=s[v])?void 0:a.call(s,...d))?c:[],(e=>u(...d,e))):u(...d,r[v])};u()}))]})(),G=(e,n,t)=>s(C(e),(([l,,r])=>{if(!u(r,n)){const s=I();if(x(e)!=J(e))y(s,n);else{let e=n;for(;!o(e)&&!u(s,e);)y(s,e),e=f(l,e)}if(t)return s;g(r,n,s)}return f(r,n)})),H=(e,n)=>s(C(e),(([,,e])=>g(e,n))),J=e=>f(T,e),K={setRelationshipDefinition:(t,l,r,i)=>{return g(T,t,r),O(t,l,((e,n)=>{const l=I(),r=I(),i=I(),[a,c]=C(t);v(n,(([e,n],v)=>{o(e)||(y(r,e),s(f(c,e),(n=>{R(n,v),d(n)&&g(c,e)}))),o(n)||(y(r,n),u(c,n)||g(c,n,I()),y(f(c,n),v)),y(l,v),g(a,v,n),L(f(z,t),(e=>{u(G(t,e),v)&&y(i,e)}))})),e(),v(l,(e=>B(m,[t,e]))),v(r,(e=>B(S,[t,e]))),v(i,(e=>{H(t,e),B(z,[t,e])}))}),e(a=i)==n?e=>e(a):null!=a?a:()=>""),K;var a},delRelationshipDefinition:e=>(g(T,e),W(e),K),getStore:A,getRelationshipIds:D,forEachRelationship:e=>M((n=>e(n,(e=>E.forEachRow(x(n),e))))),hasRelationship:j,getLocalTableId:x,getRemoteTableId:J,getRemoteRowId:(e,n)=>{var t;return f(null==(t=C(e))?void 0:t[0],n)},getLocalRowIds:(e,n)=>{var t;return a(f(null==(t=C(e))?void 0:t[1],n))},getLinkedRowIds:(e,n)=>o(C(e))?[n]:a(G(e,n,!0)),addRemoteRowIdListener:(e,n,t)=>q(t,m,[e,n]),addLocalRowIdsListener:(e,n,t)=>q(t,S,[e,n]),addLinkedRowIdsListener:(e,n,t)=>(G(e,n),q(t,z,[e,n])),delListener:e=>(H(...F(e)),K),destroy:$,getListenerStats:()=>({})};return k(K)})(E)),T.get(E))})();export{E as createRelationships};
