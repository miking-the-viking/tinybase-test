const e=e=>typeof e,n=e(""),l=e=>""+e,t=(e,n)=>e.every(n),r=(e,n)=>t(e,((l,t)=>0==t||n(e[t-1],l)<=0)),s=(e,n)=>e.sort(n),o=(e,n)=>e.forEach(n),u=e=>e.length,d=(e,...n)=>e.push(...n),i=e=>null==e,a=(e,n,l)=>i(e)?null==l?void 0:l():n(e),c=e=>Array.isArray(e),v=(e,n)=>{var l;return null!=(l=null==e?void 0:e.has(n))&&l},h=e=>i(e)||0==(e=>e.size)(e),f=e=>{var n;return[...null!=(n=null==e?void 0:e.values())?n:[]]},I=e=>e.clear(),g=(e,n)=>null==e?void 0:e.forEach(n),S=(e,n)=>null==e?void 0:e.delete(n),w=e=>new Map(e),L=e=>{var n;return[...null!=(n=null==e?void 0:e.keys())?n:[]]},p=(e,n)=>null==e?void 0:e.get(n),x=(e,n)=>g(e,((e,l)=>n(l,e))),y=(e,n,l)=>i(l)?(S(e,n),e):null==e?void 0:e.set(n,l),E=(e,n,l)=>(v(e,n)||y(e,n,l()),p(e,n)),R=(e,n,l,t,r=0)=>a((l?E:p)(e,n[r],r>u(n)-2?l:w),(s=>{if(r>u(n)-2)return(null==t?void 0:t(s))&&y(e,n[r]),s;const o=R(s,n,l,t,r+1);return h(s)&&y(e,n[r]),o})),b=e=>new Set(c(e)||i(e)?e:[e]),T=(e,n)=>null==e?void 0:e.add(n),k=(l,t)=>e(l)==n?e=>e(l):null!=l?l:()=>null!=t?t:"",z=(e,n)=>e<n?-1:1,A=/^\d+$/,C=Object.freeze,D=(e=>{const n=new WeakMap;return e=>(n.has(e)||n.set(e,(e=>{const n=w(),D=w(),[M,j,m,O,W,$,q,,B,F,G]=((e,n,l)=>{const r=e.hasRow,s=w(),d=w(),R=w(),k=w(),z=w(),A=(n,l,...t)=>{const r=E(z,n,b);return o(t,(n=>T(r,n)&&l&&e.callListener(n))),t},C=(n,...l)=>a(p(z,n),(t=>{o(0==u(l)?f(t):l,(n=>{e.delListener(n),S(t,n)})),h(t)&&y(z,n)})),D=(e,l)=>{y(s,e,l),v(d,e)||(y(d,e,n()),y(R,e,w()),y(k,e,w()))},M=e=>{y(s,e),y(d,e),y(R,e),y(k,e),C(e)};return[()=>e,()=>L(s),e=>x(d,e),e=>v(d,e),e=>p(s,e),e=>p(d,e),(e,n)=>y(d,e,n),D,(n,s,d,a,h)=>{D(n,s);const f=w(),S=w(),L=p(R,n),E=p(k,n),b=n=>{const o=l=>e.getCell(s,n,l),d=p(L,n),v=r(s,n)?l(a(o,n)):void 0;var I,g;if(d===v||c(d)&&c(v)&&(g=v,u(I=d)===u(g)&&t(I,((e,n)=>g[n]===e)))||y(f,n,[d,v]),!i(h)){const e=p(E,n),l=r(s,n)?h(o,n):void 0;e!=l&&y(S,n,l)}},T=e=>{d((()=>{g(f,(([,e],n)=>y(L,n,e))),g(S,((e,n)=>y(E,n,e)))}),f,S,L,E,e),I(f),I(S)};x(L,b),e.hasTable(s)&&o(e.getRowIds(s),(e=>{v(L,e)||b(e)})),T(!0),C(n),A(n,0,e.addRowListener(s,null,((e,n,l)=>b(l))),e.addTableListener(s,(()=>T())))},M,()=>x(z,M),A,C]})(e,w,(e=>{return i(e)?"":c(e)?(n=l,e.map(n)):l(e);var n})),[H,J,K]=(e=>{let n;const[l,t]=(()=>{const e=[];let n=0;return[()=>{var l;return null!=(l=e.shift())?l:""+n++},n=>{A.test(n)&&u(e)<1e3&&d(e,n)}]})(),r=w();return[(e,t,s,o=[],u=(()=>[]))=>{null!=n||(n=P);const d=l();return y(r,d,[e,t,s,o,u]),T(R(t,null!=s?s:[""],b),d),d},(e,l,...t)=>o(((e,n=[""])=>{const l=[],t=(e,r)=>r==u(n)?d(l,e):null===n[r]?g(e,(e=>t(e,r+1))):o([n[r],null],(n=>t(p(e,n),r+1)));return t(e,0),l})(e,l),(e=>g(e,(e=>p(r,e)[0](n,...null!=l?l:[],...t))))),e=>a(p(r,e),(([,n,l])=>(R(n,null!=l?l:[""],void 0,(n=>(S(n,e),h(n)?1:0))),y(r,e),t(e),l))),e=>a(p(r,e),(([e,,l=[],t,r])=>{const s=(...d)=>{var a,c;const v=u(d);v==u(l)?e(n,...d,...r(d)):i(l[v])?o(null!=(c=null==(a=t[v])?void 0:a.call(t,...d))?c:[],(e=>s(...d,e))):s(...d,l[v])};s()}))]})(),N=(n,l,t)=>{const r=W(n);g(t,((n,t)=>l(t,(l=>g(n,(n=>l(n,(l=>e.forEachCell(r,n,l)))))))))},P={setIndexDefinition:(e,l,t,o,u,d=z)=>{const c=i(u)?void 0:([e],[n])=>u(e,n);return B(e,l,((l,t,u,f,I,L)=>{let E=0;const R=b(),k=b(),z=$(e);if(g(t,(([e,n],l)=>{const t=b(e),r=b(n);g(t,(e=>S(r,e)?S(t,e):0)),g(t,(e=>{T(R,e),a(p(z,e),(n=>{S(n,l),h(n)&&(y(z,e),E=1)}))})),g(r,(e=>{T(R,e),v(z,e)||(y(z,e,b()),E=1),T(p(z,e),l),i(o)||T(k,e)}))})),l(),h(I)||(L?x(z,(e=>T(k,e))):x(u,(e=>a(p(f,e),(e=>T(k,e))))),g(k,(e=>{const n=(n,l)=>d(p(I,n),p(I,l),e),l=[...p(z,e)];r(l,n)||(y(z,e,b(s(l,n))),T(R,e))}))),(E||L)&&!i(c)){const n=[...z];r(n,c)||(q(e,w(s(n,c))),E=1)}E&&J(n,[e]),g(R,(n=>J(D,[e,n])))}),k(t),a(o,k)),P},delIndexDefinition:e=>(F(e),P),getStore:M,getIndexIds:j,forEachIndex:e=>m(((n,l)=>e(n,(e=>N(n,e,l))))),forEachSlice:(e,n)=>N(e,n,$(e)),hasIndex:O,hasSlice:(e,n)=>v($(e),n),getTableId:W,getSliceIds:e=>L($(e)),getSliceRowIds:(e,n)=>f(p($(e),n)),addSliceIdsListener:(e,l)=>H(l,n,[e]),addSliceRowIdsListener:(e,n,l)=>H(l,D,[e,n]),delListener:e=>(K(e),P),destroy:G,getListenerStats:()=>({})};return C(P)})(e)),n.get(e))})();export{D as createIndexes};
