var e,t;e=this,t=function(e,t){"use strict";const n=e=>typeof e,l="",s=n(l),o=n(!0),r=n(0),a=n(n),i="default",d="utf8",c="Listener",u="Result",v="add",h="Table",f="RowIds",g="CellIds",p="Cell",y=e=>l+e,L=(e,t)=>e.includes(t),w=(e,t)=>e.every(t),S=(e,t)=>C(e)===C(t)&&w(e,((e,n)=>t[n]===e)),I=(e,t)=>w(e,((n,l)=>0==l||t(e[l-1],n)<=0)),R=(e,t)=>e.sort(t),T=(e,t)=>e.forEach(t),b=(e,t)=>e.map(t),m=e=>x(e,((e,t)=>e+t),0),C=e=>e.length,V=e=>0==C(e),x=(e,t,n)=>e.reduce(t,n),E=(e,t,n)=>e.slice(t,n),P=(e,...t)=>e.push(...t),k=e=>e.pop(),J=e=>e.shift(),M=e=>JSON.stringify(e,((e,t)=>j(t,Map)?x([...t],((e,[t,n])=>(e[t]=n,e)),{}):t)),A=JSON.parse,D=Math.max,O=Math.min,F=isFinite,j=(e,t)=>e instanceof t,Q=e=>null==e,z=(e,t,n)=>Q(e)?null==n?void 0:n():t(e),N=e=>e==s||e==o,W=e=>n(e)==a,B=e=>Array.isArray(e),q=()=>{},H=e=>e.size,$=(e,t)=>{var n;return null!=(n=null==e?void 0:e.has(t))&&n},G=e=>Q(e)||0==H(e),K=e=>{var t;return[...null!=(t=null==e?void 0:e.values())?t:[]]},U=e=>e.clear(),X=(e,t)=>null==e?void 0:e.forEach(t),Y=(e,t)=>null==e?void 0:e.delete(t),Z=e=>new Map(e),_=e=>{var t;return[...null!=(t=null==e?void 0:e.keys())?t:[]]},ee=(e,t)=>null==e?void 0:e.get(t),te=(e,t)=>X(e,((e,n)=>t(n,e))),ne=(e,t,n)=>Q(n)?(Y(e,t),e):null==e?void 0:e.set(t,n),le=(e,t,n)=>($(e,t)||ne(e,t,n()),ee(e,t)),se=(e,t,n)=>{const l={},s=null!=t?t:e=>e;return X(e,((e,t)=>z(s(e),(e=>(null==n?void 0:n(e))?0:l[t]=e)))),l},oe=(e,t)=>{const n=Z(),l=null!=t?t:e=>e;return X(e,((e,t)=>n.set(t,l(e)))),n},re=e=>oe(e,oe),ae=(e,t,n,l,s=0)=>z((n?le:ee)(e,t[s],s>C(t)-2?n:Z),(o=>{if(s>C(t)-2)return(null==l?void 0:l(o))&&ne(e,t[s]),o;const r=ae(o,t,n,l,s+1);return G(o)&&ne(e,t[s]),r})),ie=e=>{const t=n(e);return N(t)||t==r&&F(e)?t:void 0},de=(e,t,n,l,s)=>Q(s)?e.delCell(t,n,l,!0):e.setCell(t,n,l,s),ce=(e,t,n)=>Q(n)?e.delValue(t):e.setValue(t,n),ue=e=>new Set(B(e)||Q(e)?e:[e]),ve=(e,t)=>null==e?void 0:e.add(t),he=(e,t,n)=>{const l=e.hasRow,s=Z(),o=Z(),r=Z(),a=Z(),i=Z(),d=(t,n,...l)=>{const s=le(i,t,ue);return T(l,(t=>ve(s,t)&&n&&e.callListener(t))),l},c=(t,...n)=>z(ee(i,t),(l=>{T(V(n)?K(l):n,(t=>{e.delListener(t),Y(l,t)})),G(l)&&ne(i,t)})),u=(e,n)=>{ne(s,e,n),$(o,e)||(ne(o,e,t()),ne(r,e,Z()),ne(a,e,Z()))},v=e=>{ne(s,e),ne(o,e),ne(r,e),ne(a,e),c(e)};return[()=>e,()=>_(s),e=>te(o,e),e=>$(o,e),e=>ee(s,e),e=>ee(o,e),(e,t)=>ne(o,e,t),u,(t,s,o,i,v)=>{u(t,s);const h=Z(),f=Z(),g=ee(r,t),p=ee(a,t),y=t=>{const o=n=>e.getCell(s,t,n),r=ee(g,t),a=l(s,t)?n(i(o,t)):void 0;if(r===a||B(r)&&B(a)&&S(r,a)||ne(h,t,[r,a]),!Q(v)){const e=ee(p,t),n=l(s,t)?v(o,t):void 0;e!=n&&ne(f,t,n)}},L=e=>{o((()=>{X(h,(([,e],t)=>ne(g,t,e))),X(f,((e,t)=>ne(p,t,e)))}),h,f,g,p,e),U(h),U(f)};te(g,y),e.hasTable(s)&&T(e.getRowIds(s),(e=>{$(g,e)||y(e)})),L(!0),c(t),d(t,0,e.addRowListener(s,null,((e,t,n)=>y(n))),e.addTableListener(s,(()=>L())))},v,()=>te(i,v),d,c]},fe=(e,t)=>n(e)==s?t=>t(e):null!=e?e:()=>null!=t?t:l,ge=e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))},pe=/^\d+$/,ye=()=>{const e=[];let t=0;return[()=>{var n;return null!=(n=J(e))?n:l+t++},t=>{pe.test(t)&&C(e)<1e3&&P(e,t)}]},Le=e=>{let t;const[n,s]=ye(),o=Z();return[(s,r,a,i=[],d=(()=>[]))=>{null!=t||(t=e());const c=n();return ne(o,c,[s,r,a,i,d]),ve(ae(r,null!=a?a:[l],ue),c),c},(e,n,...s)=>T(((e,t=[l])=>{const n=[],s=(e,l)=>l==C(t)?P(n,e):null===t[l]?X(e,(e=>s(e,l+1))):T([t[l],null],(t=>s(ee(e,t),l+1)));return s(e,0),n})(e,n),(e=>X(e,(e=>ee(o,e)[0](t,...null!=n?n:[],...s))))),e=>z(ee(o,e),(([,t,n])=>(ae(t,null!=n?n:[l],void 0,(t=>(Y(t,e),G(t)?1:0))),ne(o,e),s(e),n))),e=>z(ee(o,e),(([e,,n=[],l,s])=>{const o=(...r)=>{var a,i;const d=C(r);d==C(n)?e(t,...r,...s(r)):Q(n[d])?T(null!=(i=null==(a=l[d])?void 0:a.call(l,...r))?i:[],(e=>o(...r,e))):o(...r,n[d])};o()}))]},we=Object,Se=we.keys,Ie=we.isFrozen,Re=we.freeze,Te=e=>j(e,we)&&e.constructor==we,be=(e,t)=>!Q(((e,t)=>z(e,(e=>e[t])))(e,t)),me=(e,t)=>delete e[t],Ce=(e,t)=>b(we.entries(e),(([e,n])=>t(n,e))),Ve=e=>Te(e)&&V(Se(e)),xe=ge((e=>{let t,n,s,o=100,r=Z(),a=Z(),i=1;const d=Z(),c=Z(),[u,v,h]=Le((()=>W)),f=Z(),g=Z(),p=[],y=[],w=(t,n)=>{i=0,e.transaction((()=>{const[l,s]=ee(f,n);X(l,((n,l)=>X(n,((n,s)=>X(n,((n,o)=>de(e,l,s,o,n[t]))))))),X(s,((n,l)=>ce(e,l,n[t])))})),i=1},S=e=>{ne(f,e),ne(g,e),v(c,[e])},I=(e,t)=>T(((e,t)=>e.splice(0,t))(e,null!=t?t:C(e)),S),R=()=>I(p,C(p)-o),b=()=>z(t,(()=>{P(p,t),R(),I(y),t=void 0,s=1})),m=()=>{t=k(p),s=1},x=e.addCellListener(null,null,null,((e,t,n,l,s,o)=>{if(i){b();const e=le(r,t,Z),a=le(e,n,Z),i=le(a,l,(()=>[o,void 0]));i[1]=s,i[0]===s&&G(ne(a,l))&&G(ne(e,n))&&G(ne(r,t))&&m(),O()}})),E=e.addValueListener(null,((e,t,n,l)=>{if(i){b();const e=le(a,t,(()=>[l,void 0]));e[1]=n,e[0]===n&&G(ne(a,t))&&m(),O()}})),M=(e="")=>(Q(t)&&(t=l+n++,ne(f,t,[r,a]),j(t,e),r=Z(),a=Z(),s=1),t),A=()=>{V(p)||(((e,...t)=>{e.unshift(...t)})(y,M()),w(0,t),t=k(p),s=1)},D=()=>{V(y)||(P(p,t),t=J(y),w(1,t),s=1)},O=()=>{s&&(v(d),s=0)},F=e=>{const t=M(e);return O(),t},j=(e,t)=>(N(e)&&ee(g,e)!==t&&(ne(g,e,t),v(c,[e])),W),N=e=>$(f,e),W={setSize:e=>(o=e,R(),W),addCheckpoint:F,setCheckpoint:j,getStore:()=>e,getCheckpointIds:()=>[[...p],t,[...y]],forEachCheckpoint:e=>te(g,e),hasCheckpoint:N,getCheckpoint:e=>ee(g,e),goBackward:()=>(A(),O(),W),goForward:()=>(D(),O(),W),goTo:e=>{const n=L(p,e)?A:L(y,e)?D:null;for(;!Q(n)&&e!=t;)n();return O(),W},addCheckpointIdsListener:e=>u(e,d),addCheckpointListener:(e,t)=>u(t,c,[e]),delListener:e=>(h(e),W),clear:()=>(I(p),I(y),Q(t)||S(t),t=void 0,n=0,F(),W),destroy:()=>{e.delListener(x),e.delListener(E)},getListenerStats:()=>({})};return Re(W.clear())})),Ee=(e,t)=>e<t?-1:1,Pe=ge((e=>{const t=Z(),n=Z(),[s,o,r,a,i,d,c,,u,v,h]=he(e,Z,(e=>Q(e)?l:B(e)?b(e,y):y(e))),[f,g,p]=Le((()=>w)),L=(t,n,l)=>{const s=i(t);X(l,((t,l)=>n(l,(n=>X(t,(t=>n(t,(n=>e.forEachCell(s,t,n)))))))))},w={setIndexDefinition:(e,l,s,o,r,a=Ee)=>{const i=Q(r)?void 0:([e],[t])=>r(e,t);return u(e,l,((l,s,r,u,v,h)=>{let f=0;const p=ue(),y=ue(),L=d(e);if(X(s,(([e,t],n)=>{const l=ue(e),s=ue(t);X(l,(e=>Y(s,e)?Y(l,e):0)),X(l,(e=>{ve(p,e),z(ee(L,e),(t=>{Y(t,n),G(t)&&(ne(L,e),f=1)}))})),X(s,(e=>{ve(p,e),$(L,e)||(ne(L,e,ue()),f=1),ve(ee(L,e),n),Q(o)||ve(y,e)}))})),l(),G(v)||(h?te(L,(e=>ve(y,e))):te(r,(e=>z(ee(u,e),(e=>ve(y,e))))),X(y,(e=>{const t=(t,n)=>a(ee(v,t),ee(v,n),e),n=[...ee(L,e)];I(n,t)||(ne(L,e,ue(R(n,t))),ve(p,e))}))),(f||h)&&!Q(i)){const t=[...L];I(t,i)||(c(e,Z(R(t,i))),f=1)}f&&g(t,[e]),X(p,(t=>g(n,[e,t])))}),fe(s),z(o,fe)),w},delIndexDefinition:e=>(v(e),w),getStore:s,getIndexIds:o,forEachIndex:e=>r(((t,n)=>e(t,(e=>L(t,e,n))))),forEachSlice:(e,t)=>L(e,t,d(e)),hasIndex:a,hasSlice:(e,t)=>$(d(e),t),getTableId:i,getSliceIds:e=>_(d(e)),getSliceRowIds:(e,t)=>K(ee(d(e),t)),addSliceIdsListener:(e,n)=>f(n,t,[e]),addSliceRowIdsListener:(e,t,l)=>f(l,n,[e,t]),delListener:e=>(p(e),w),destroy:h,getListenerStats:()=>({})};return Re(w)})),ke=Z([["avg",[(e,t)=>m(e)/t,(e,t,n)=>e+(t-e)/(n+1),(e,t,n)=>e+(e-t)/(n-1),(e,t,n,l)=>e+(t-n)/l]],["max",[e=>D(...e),(e,t)=>D(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:D(t,e)]],["min",[e=>O(...e),(e,t)=>O(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:O(t,e)]],["sum",[e=>m(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,n)=>e-n+t]]]),Je=(e,t,n,l,s,o=!1)=>{if(G(n))return;const[r,a,i,d]=s;return o||(o=Q(e)),X(l,(([n,l])=>{o||(e=Q(n)?null==a?void 0:a(e,l,t++):Q(l)?null==i?void 0:i(e,n,t--):null==d?void 0:d(e,l,n,t),o||(o=Q(e)))})),o?r(K(n),H(n)):e},Me=ge((e=>{const t=Z(),[n,s,o,r,a,i,d,,c,u,v]=he(e,q,(e=>isNaN(e)||Q(e)||!0===e||!1===e||e===l?void 0:1*e)),[h,f,g]=Le((()=>p)),p={setMetricDefinition:(e,n,l,s,o,r,a)=>{var u;const v=W(l)?[l,o,r,a]:null!=(u=ee(ke,l))?u:ee(ke,"sum");return c(e,n,((n,l,s,o,r,a)=>{const c=i(e),u=H(o);a||(a=Q(c)),n();let h=Je(c,u,o,l,v,a);F(h)||(h=void 0),h!=c&&(d(e,h),f(t,[e],h,c))}),fe(s,1)),p},delMetricDefinition:e=>(u(e),p),getStore:n,getMetricIds:s,forEachMetric:o,hasMetric:r,getTableId:a,getMetric:i,addMetricListener:(e,n)=>h(n,t,[e]),delListener:e=>(g(e),p),destroy:v,getListenerStats:()=>({})};return Re(p)}));var Ae=(e,t,n)=>new Promise(((l,s)=>{var o=e=>{try{a(n.next(e))}catch(e){s(e)}},r=e=>{try{a(n.throw(e))}catch(e){s(e)}},a=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,r);a((n=n.apply(e,t)).next())}));const De=(e,t,n,s,o)=>{let r,a,i=0;const d={load:(n,s)=>Ae(void 0,null,(function*(){if(2!=i){i=1;const o=yield t();Q(o)||o==l?e.transaction((()=>e.setTables(n).setValues(s))):e.setJson(o),i=0}return d})),startAutoLoad:(e,t)=>Ae(void 0,null,(function*(){return d.stopAutoLoad(),yield d.load(e,t),s(d.load),d})),stopAutoLoad:()=>(o(),d),save:()=>Ae(void 0,null,(function*(){return 1!=i&&(i=2,yield n(e.getJson()),i=0),d})),startAutoSave:()=>Ae(void 0,null,(function*(){return yield d.stopAutoSave().save(),r=e.addTablesListener(d.save),a=e.addValuesListener(d.save),d})),stopAutoSave:()=>(z(r,e.delListener),z(a,e.delListener),d),getStore:()=>e,destroy:()=>d.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return Re(d)};var Oe=(e,t,n)=>new Promise(((l,s)=>{var o=e=>{try{a(n.next(e))}catch(e){s(e)}},r=e=>{try{a(n.throw(e))}catch(e){s(e)}},a=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,r);a((n=n.apply(e,t)).next())}));const Fe="storage",je=globalThis.window,Qe=(e,t,n)=>{let l;return De(e,(()=>Oe(void 0,null,(function*(){return n.getItem(t)}))),(e=>Oe(void 0,null,(function*(){return n.setItem(t,e)}))),(e=>{l=l=>{l.storageArea===n&&l.key===t&&e()},je.addEventListener(Fe,l)}),(()=>{je.removeEventListener(Fe,l),l=void 0}))};var ze=(e,t,n)=>new Promise(((l,s)=>{var o=e=>{try{a(n.next(e))}catch(e){s(e)}},r=e=>{try{a(n.throw(e))}catch(e){s(e)}},a=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,r);a((n=n.apply(e,t)).next())})),Ne=(e,t,n)=>new Promise(((l,s)=>{var o=e=>{try{a(n.next(e))}catch(e){s(e)}},r=e=>{try{a(n.throw(e))}catch(e){s(e)}},a=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,r);a((n=n.apply(e,t)).next())}));const We=e=>e.headers.get("ETag");var Be=Object.getOwnPropertySymbols,qe=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;const $e=ge((e=>{const t=e.createStore,[n,s,o,r,a,,,i,,d,y,L,S]=he(e,(()=>!0),q),I=t(),R=t(),b=Z(),m=(e,t,...n)=>T(n,(n=>ve(le(le(b,t,Z),e,ue),n))),x=e=>{z(ee(b,e),(e=>{te(e,((e,t)=>X(t,(t=>e.delListener(t))))),U(e)})),T([R,I],(t=>t.delTable(e)))},k=(e,t,n)=>m(t,e,t.addWillFinishTransactionListener(n.startTransaction),t.addDidFinishTransactionListener((()=>n.finishTransaction()))),J={setQueryDefinition:(t,n,s)=>{i(t,n),x(t);const o=[],r=[[null,[n,null,null,[],Z()]]],a=[],d=[],c=[];s({select:(e,t)=>{const n=W(e)?[C(o)+l,e]:[Q(t)?e:t,n=>n(e,t)];return P(o,n),{as:e=>n[0]=e}},join:(e,t,n)=>{const l=Q(n)||W(t)?null:t,s=Q(l)?t:n,o=[e,[e,l,W(s)?s:e=>e(s),[],Z()]];return P(r,o),{as:e=>o[0]=e}},where:(e,t,n)=>P(a,W(e)?e:Q(n)?n=>n(e)===t:l=>l(e,t)===n),group:(e,t,n,l,s)=>{var o;const r=[e,[e,W(t)?[t,n,l,s]:null!=(o=ee(ke,t))?o:[(e,t)=>t]]];return P(d,r),{as:e=>r[0]=e}},having:(e,t)=>P(c,W(e)?e:n=>n(e)===t)});const u=Z(o);if(G(u))return J;const v=Z(r);te(v,((e,[,t])=>z(ee(v,t),(({3:t})=>Q(e)?0:P(t,e)))));const h=Z(d);let f=I;if(G(h)&&V(c))f=R;else{k(t,f,R);const e=Z();te(h,((t,[n,l])=>ve(le(e,n,ue),[t,l])));const n=ue();te(u,(t=>$(e,t)?0:ve(n,t)));const l=Z(),s=(n,l,s,o)=>z(n,(([r,a,i,d])=>{te(l,((t,[n])=>{const l=le(r,t,Z),a=ee(l,s),i=o?void 0:n;if(a!==i){const n=ue([[a,i]]),o=H(l);ne(l,s,i),X(ee(e,t),(([e,t])=>{const s=Je(d[e],o,l,n,t);d[e]=Q(ie(s))?null:s}))}})),G(a)||!w(c,(e=>e((e=>d[e]))))?R.delRow(t,i):Q(i)?n[2]=R.addRow(t,d):R.setRow(t,i,d)}));m(f,t,f.addRowListener(t,null,((o,r,a,i)=>{const d=[],c=[],u=Z(),v=f.hasRow(t,a);let h=!v;X(n,(e=>{const[n,l,s]=i(t,a,e);P(d,l),P(c,s),h||(h=n)})),te(e,(e=>{const[n,,l]=i(t,a,e);(h||n)&&ne(u,e,[l])})),h&&s(ae(l,d,void 0,(([,e])=>(Y(e,a),G(e)))),u,a,1),v&&s(ae(l,c,(()=>{const e={};return X(n,(n=>e[n]=f.getCell(t,a,n))),[Z(),ue(),void 0,e]}),(([,e])=>{ve(e,a)})),u,a)})))}k(t,e,f);const g=(l,s,o,r)=>{const i=t=>e.getCell(s,o,t);T(r,(n=>{var s;const[o,,r,a,d]=ee(v,n),c=null==r?void 0:r(i,l),[u,h]=null!=(s=ee(d,l))?s:[];c!=u&&(Q(h)||S(t,h),ne(d,l,Q(c)?null:[c,...L(t,1,e.addRowListener(o,c,(()=>g(l,o,c,a))))]))})),(l=>{const s=(t,s)=>{var o,r,a;return e.getCell(...Q(s)?[n,l,t]:t===n?[n,l,s]:[null==(o=ee(v,t))?void 0:o[0],null==(a=ee(null==(r=ee(v,t))?void 0:r[4],l))?void 0:a[0],s])};f.transaction((()=>w(a,(e=>e(s)))?te(u,((e,n)=>de(f,t,l,e,n(s,l)))):f.delRow(t,l)))})(l)},{3:p}=ee(v,null);return f.transaction((()=>L(t,1,e.addRowListener(n,null,((l,s,o)=>{e.hasRow(n,o)?g(o,n,o,p):(f.delRow(t,o),X(v,(({4:e})=>z(ee(e,o),(([,n])=>{S(t,n),ne(e,o)})))))}))))),J},delQueryDefinition:e=>(x(e),d(e),J),getStore:n,getQueryIds:s,forEachQuery:o,hasQuery:r,getTableId:a,delListener:e=>(R.delListener(e),J),destroy:y,getListenerStats:()=>((e,t)=>{var n={};for(var l in e)qe.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&Be)for(var l of Be(e))t.indexOf(l)<0&&He.call(e,l)&&(n[l]=e[l]);return n})(R.getListenerStats(),["tables","tableIds","transaction"])};return Ce({[h]:[1,1],[f]:[0,1],SortedRowIds:[0,5],Row:[1,2],[g]:[0,2],[p]:[1,3]},(([e,t],n)=>{T(e?["get","has","forEach"]:["get"],(e=>J[e+u+n]=(...t)=>R[e+n](...t))),J[v+u+n+c]=(...e)=>R[v+n+c](...E(e,0,t),((n,...l)=>e[t](J,...l)))})),Re(J)})),Ge=ge((e=>{const t=Z(),n=Z(),s=Z(),o=Z(),[r,a,i,d,c,u,,,v,h,f]=he(e,(()=>[Z(),Z(),Z(),Z()]),(e=>Q(e)?void 0:e+l)),[g,p,y]=Le((()=>I)),L=(e,t,n)=>z(u(e),(([l,,s])=>{if(!$(s,t)){const o=ue();if(c(e)!=S(e))ve(o,t);else{let e=t;for(;!Q(e)&&!$(o,e);)ve(o,e),e=ee(l,e)}if(n)return o;ne(s,t,o)}return ee(s,t)})),w=(e,t)=>z(u(e),(([,,e])=>ne(e,t))),S=e=>ee(t,e),I={setRelationshipDefinition:(e,l,r,a)=>(ne(t,e,r),v(e,l,((t,l)=>{const r=ue(),a=ue(),i=ue(),[d,c]=u(e);X(l,(([t,n],l)=>{Q(t)||(ve(a,t),z(ee(c,t),(e=>{Y(e,l),G(e)&&ne(c,t)}))),Q(n)||(ve(a,n),$(c,n)||ne(c,n,ue()),ve(ee(c,n),l)),ve(r,l),ne(d,l,n),te(ee(o,e),(t=>{$(L(e,t),l)&&ve(i,t)}))})),t(),X(r,(t=>p(n,[e,t]))),X(a,(t=>p(s,[e,t]))),X(i,(t=>{w(e,t),p(o,[e,t])}))}),fe(a)),I),delRelationshipDefinition:e=>(ne(t,e),h(e),I),getStore:r,getRelationshipIds:a,forEachRelationship:t=>i((n=>t(n,(t=>e.forEachRow(c(n),t))))),hasRelationship:d,getLocalTableId:c,getRemoteTableId:S,getRemoteRowId:(e,t)=>{var n;return ee(null==(n=u(e))?void 0:n[0],t)},getLocalRowIds:(e,t)=>{var n;return K(ee(null==(n=u(e))?void 0:n[1],t))},getLinkedRowIds:(e,t)=>Q(u(e))?[t]:K(L(e,t,!0)),addRemoteRowIdListener:(e,t,l)=>g(l,n,[e,t]),addLocalRowIdsListener:(e,t,n)=>g(n,s,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(L(e,t),g(n,o,[e,t])),delListener:e=>(w(...y(e)),I),destroy:f,getListenerStats:()=>({})};return Re(I)})),Ke=e=>[e,e],Ue=()=>[Z(),Z()],Xe=(e,t,n,l=ne)=>{const s=(o=e=>!be(t,e),_(e).filter(o));var o;return T(Se(t),(l=>n(e,l,t[l]))),T(s,(t=>l(e,t))),e},Ye=(e,t,n)=>Q(e)||!Te(e)||Ve(e)||Ie(e)?(null==n||n(),!1):(Ce(e,((n,l)=>{t(n,l)||me(e,l)})),!Ve(e)),Ze=(e,t,n)=>ne(e,t,ee(e,t)==-n?void 0:n),_e=()=>{let e,t,n,l,s=0;const o=Z(),a=Z(),d=Z(),u=Z(),w=Z(),I=Z(),m=Z(),C=Z(),V=Z(),x=Z(),k=Z(),J=Z(),D=ue(),O=Z(),F=Z(),j=Z(),B=Ue(),q=Ue(),H=Ue(),K=Ue(),ae=Ue(),he=Ue(),fe=Ue(),ge=Ue(),pe=Ue(),we=Ue(),Se=Ue(),Ie=Ue(),Te=Ue(),xe=Ue(),[Pe,ke,Je,Me]=Le((()=>Kt)),Ae=e=>{if(!Ye(e,((e,t)=>L(["type",i],t))))return!1;const t=e.type;return!(!N(t)&&t!=r||(ie(e.default)!=t&&me(e,i),0))},De=(t,n)=>(!e||$(V,n)||yt(n))&&Ye(t,((e,t)=>Oe(n,t,e)),(()=>yt(n))),Oe=(e,t,n,l)=>Ye(l?n:ze(n,e,t),((l,s)=>z(Fe(e,t,s,l),(e=>(n[s]=e,!0)),(()=>!1))),(()=>yt(e,t))),Fe=(t,n,l,s)=>e?z(ee(ee(V,t),l),(e=>ie(s)!=e.type?yt(t,n,l,s,e.default):s),(()=>yt(t,n,l,s))):Q(ie(s))?yt(t,n,l,s):s,je=(e,t)=>Ye(t?e:Ne(e),((t,n)=>z(Qe(n,t),(t=>(e[n]=t,!0)),(()=>!1))),(()=>Lt())),Qe=(e,n)=>t?z(ee(k,e),(t=>ie(n)!=t.type?Lt(e,n,t.default):n),(()=>Lt(e,n))):Q(ie(n))?Lt(e,n):n,ze=(e,t,n)=>(z(ee(x,t),(([l,s])=>{X(l,((t,n)=>{be(e,n)||(e[n]=t)})),X(s,(l=>{be(e,l)||yt(t,n,l)}))})),e),Ne=e=>(t&&(X(J,((t,n)=>{be(e,n)||(e[n]=t)})),X(D,(t=>{be(e,t)||Lt(t)}))),e),We=e=>Xe(V,e,((e,t,n)=>{const l=Z(),s=ue();Xe(le(V,t,Z),n,((e,t,n)=>{ne(e,t,n),z(n.default,(e=>ne(l,t,e)),(()=>ve(s,t)))})),ne(x,t,[l,s])}),((e,t)=>{ne(V,t),ne(x,t)})),Be=e=>Xe(k,e,((e,t,n)=>{ne(k,t,n),z(n.default,(e=>ne(J,t,e)),(()=>ve(D,t)))}),((e,t)=>{ne(k,t),ne(J,t),Y(D,t)})),qe=e=>Ve(e)?Nt():Ot(e),He=e=>Xe(F,e,((e,t,n)=>$e(t,n)),((e,t)=>at(t))),$e=(e,t)=>Xe(le(F,e,(()=>(ut(e,1),Z()))),t,((t,n,l)=>Ge(e,t,n,l)),((t,n)=>it(e,t,n))),Ge=(e,t,n,l,s)=>Xe(le(t,n,(()=>(vt(e,n,1),Z()))),l,((t,l,s)=>et(e,n,t,l,s)),((l,o)=>dt(e,t,n,l,o,s))),et=(e,t,n,l,s)=>{$(n,l)||ht(e,t,l,1);const o=ee(n,l);s!==o&&(ft(e,t,l,o,s),ne(n,l,s))},tt=(e,t,n,l,s)=>z(ee(t,n),(t=>et(e,n,t,l,s)),(()=>Ge(e,t,n,ze({[l]:s},e,n)))),nt=e=>Ve(e)?Wt():Ft(e),lt=e=>Xe(j,e,((e,t,n)=>st(t,n)),((e,t)=>ct(t))),st=(e,t)=>{$(j,e)||gt(e,1);const n=ee(j,e);t!==n&&(pt(e,n,t),ne(j,e,t))},ot=e=>{const[t]=le(O,e,ye),n=t();return $(ee(F,e),n)?ot(e):n},rt=e=>{var t;return null!=(t=ee(F,e))?t:$e(e,{})},at=e=>$e(e,{}),it=(e,t,n)=>{const[,l]=le(O,e,ye);l(n),Ge(e,t,n,{},!0)},dt=(e,t,n,l,s,o)=>{var r;const a=ee(null==(r=ee(x,e))?void 0:r[0],s);if(!Q(a)&&!o)return et(e,n,l,s,a);const i=t=>{ft(e,n,t,ee(l,t)),ht(e,n,t,-1),ne(l,t)};Q(a)?i(s):te(l,i),G(l)&&(vt(e,n,-1),G(ne(t,n))&&(ut(e,-1),ne(F,e),ne(O,e)))},ct=e=>{const t=ee(J,e);if(!Q(t))return st(e,t);pt(e,ee(j,e)),gt(e,-1),ne(j,e)},ut=(e,t)=>Ze(o,e,t),vt=(e,t,n)=>Ze(le(a,e,Z),t,n),ht=(e,t,n,l)=>Ze(le(le(d,e,Z),t,Z),n,l),ft=(e,t,n,l,s)=>le(le(le(u,e,Z),t,Z),n,(()=>[l,0]))[1]=s,gt=(e,t)=>Ze(w,e,t),pt=(e,t,n)=>le(I,e,(()=>[t,0]))[1]=n,yt=(e,t,n,l,s)=>(P(le(le(le(m,e,Z),t,Z),n,(()=>[])),l),s),Lt=(e,t,n)=>(P(le(C,e,(()=>[])),t),n),wt=(e,t,n)=>z(ee(ee(ee(u,e),t),n),(([e,t])=>[!0,e,t]),(()=>[!1,...Ke(Jt(e,t,n))])),St=e=>z(ee(I,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Ke(Dt(e))])),It=e=>G(m)||G(pe[e])?0:X(e?oe(m,re):m,((t,n)=>X(t,((t,l)=>X(t,((t,s)=>ke(pe[e],[n,l,s],t))))))),Rt=e=>G(C)||G(we[e])?0:X(e?oe(C):C,((t,n)=>ke(we[e],[n],t))),Tt=(e,t,n)=>{if(!G(t))return ke(e,n),1},bt=e=>{const t=G(ae[e]),n=G(fe[e])&&G(K[e])&&t&&G(q[e]),l=G(ge[e])&&G(he[e])&&G(H[e])&&G(B[e]);if(!n||!l){const s=e?[oe(o),re(a),oe(d,re),oe(u,re)]:[o,a,d,u];if(!n){X(s[2],((t,n)=>X(t,((t,l)=>Tt(fe[e],t,[n,l])))));const n=ue();X(s[1],((l,s)=>{Tt(K[e],l,[s])&&!t&&(ke(ae[e],[s,null]),ve(n,s))})),t||X(s[3],((t,l)=>{if(!$(n,l)){const n=ue();X(t,(e=>X(e,(([t,l],s)=>l!==t?ve(n,s):Y(e,s))))),X(n,(t=>ke(ae[e],[l,t])))}})),Tt(q[e],s[0])}if(!l){let t;X(s[3],((n,l)=>{let s;X(n,((n,o)=>{let r;X(n,(([n,a],i)=>{a!==n&&(ke(ge[e],[l,o,i],a,n,wt),t=s=r=1)})),r&&ke(he[e],[l,o],wt)})),s&&ke(H[e],[l],wt)})),t&&ke(B[e],void 0,wt)}}},mt=e=>{const t=G(Ie[e]),n=G(Te[e])&&G(Se[e]);if(!t||!n){const l=e?[oe(w),oe(I)]:[w,I];if(t||Tt(Ie[e],l[0]),!n){let t;X(l[1],(([n,l],s)=>{l!==n&&(ke(Te[e],[s],l,n,St),t=1)})),t&&ke(Se[e],void 0,St)}}},Ct=(e,...t)=>(Ht((()=>e(...b(t,y)))),Kt),Vt=()=>se(F,(e=>se(e,se))),xt=()=>_(F),Et=e=>_(ee(F,y(e))),Pt=(e,t,n,l=0,s)=>{return b(E(R((o=ee(F,y(e)),r=(e,n)=>[Q(t)?n:ee(e,y(t)),n],b([...null!=(a=null==o?void 0:o.entries())?a:[]],(([e,t])=>r(t,e)))),(([e],[t])=>Ee(e,t)*(n?-1:1))),l,Q(s)?s:l+s),(([,e])=>e));var o,r,a},kt=(e,t)=>_(ee(ee(F,y(e)),y(t))),Jt=(e,t,n)=>ee(ee(ee(F,y(e)),y(t)),y(n)),Mt=()=>se(j),At=()=>_(j),Dt=e=>ee(j,y(e)),Ot=e=>Ct((()=>(e=>Ye(e,De,yt))(e)?He(e):0)),Ft=e=>Ct((()=>je(e)?lt(e):0)),jt=e=>{try{qe(A(e))}catch(e){}return Kt},Qt=t=>Ct((()=>{if((e=Ye(t,(e=>Ye(e,Ae))))&&(We(t),!G(F))){const e=Vt();Nt(),Ot(e)}})),zt=e=>Ct((()=>{if(t=(e=>Ye(e,Ae))(e)){const n=Mt();qt(),Wt(),t=!0,Be(e),Ft(n)}})),Nt=()=>Ct((()=>He({}))),Wt=()=>Ct((()=>lt({}))),Bt=()=>Ct((()=>{We({}),e=!1})),qt=()=>Ct((()=>{Be({}),t=!1})),Ht=(e,t)=>{if(-1==s)return;$t();const n=e();return Gt(t),n},$t=()=>(s++,Kt),Gt=e=>(s>0&&(s--,0==s&&(n=!G(u),l=!G(I),s=1,It(1),n&&bt(1),Rt(1),l&&mt(1),s=-1,(null==e?void 0:e(se(u,(e=>se(e,(e=>se(e,(e=>[...e]),(([e,t])=>e===t))),Ve)),Ve),se(m,(e=>se(e,se))),se(I,(e=>[...e]),(([e,t])=>e===t)),se(C)))&&(s=1,X(u,((e,t)=>X(e,((e,n)=>X(e,(([e],l)=>de(Kt,t,n,l,e))))))),X(I,(([e],t)=>ce(Kt,t,e))),s=-1,n=l=!1),ke(xe[0],void 0,n,l),It(0),n&&bt(0),Rt(0),l&&mt(0),ke(xe[1],void 0,n,l),s=0,T([o,a,d,u,m,w,I,C],U))),Kt),Kt={getTables:Vt,getTableIds:xt,getTable:e=>se(ee(F,y(e)),se),getRowIds:Et,getSortedRowIds:Pt,getRow:(e,t)=>se(ee(ee(F,y(e)),y(t))),getCellIds:kt,getCell:Jt,getValues:Mt,getValueIds:At,getValue:Dt,hasTables:()=>!G(F),hasTable:e=>$(F,y(e)),hasRow:(e,t)=>$(ee(F,y(e)),y(t)),hasCell:(e,t,n)=>$(ee(ee(F,y(e)),y(t)),y(n)),hasValues:()=>!G(j),hasValue:e=>$(j,y(e)),getTablesJson:()=>M(F),getValuesJson:()=>M(j),getJson:()=>M([F,j]),getTablesSchemaJson:()=>M(V),getValuesSchemaJson:()=>M(k),getSchemaJson:()=>M([V,k]),setTables:Ot,setTable:(e,t)=>Ct((e=>De(t,e)?$e(e,t):0),e),setRow:(e,t,n)=>Ct(((e,t)=>Oe(e,t,n)?Ge(e,rt(e),t,n):0),e,t),addRow:(e,t)=>Ht((()=>{let n;return Oe(e,n,t)&&(e=y(e),Ge(e,rt(e),n=ot(e),t)),n})),setPartialRow:(e,t,n)=>Ct(((e,t)=>{if(Oe(e,t,n,1)){const l=rt(e);Ce(n,((n,s)=>tt(e,l,t,s,n)))}}),e,t),setCell:(e,t,n,l)=>Ct(((e,t,n)=>z(Fe(e,t,n,W(l)?l(Jt(e,t,n)):l),(l=>tt(e,rt(e),t,n,l)))),e,t,n),setValues:Ft,setPartialValues:e=>Ct((()=>je(e,1)?Ce(e,((e,t)=>st(t,e))):0)),setValue:(e,t)=>Ct((e=>z(Qe(e,W(t)?t(Dt(e)):t),(t=>st(e,t)))),e),setTablesJson:jt,setValuesJson:e=>{try{nt(A(e))}catch(e){}return Kt},setJson:e=>{try{const[t,n]=A(e);qe(t),nt(n)}catch(t){jt(e)}return Kt},setTablesSchema:Qt,setValuesSchema:zt,setSchema:(e,t)=>Ct((()=>{Qt(e),zt(t)})),delTables:Nt,delTable:e=>Ct((e=>$(F,e)?at(e):0),e),delRow:(e,t)=>Ct(((e,t)=>z(ee(F,e),(n=>$(n,t)?it(e,n,t):0))),e,t),delCell:(e,t,n,l)=>Ct(((e,t,n)=>z(ee(F,e),(s=>z(ee(s,t),(o=>$(o,n)?dt(e,s,t,o,n,l):0))))),e,t,n),delValues:Wt,delValue:e=>Ct((e=>$(j,e)?ct(e):0),e),delTablesSchema:Bt,delValuesSchema:qt,delSchema:()=>Ct((()=>{Bt(),qt()})),transaction:Ht,startTransaction:$t,finishTransaction:Gt,forEachTable:e=>X(F,((t,n)=>e(n,(e=>X(t,((t,n)=>e(n,(e=>te(t,e))))))))),forEachRow:(e,t)=>X(ee(F,y(e)),((e,n)=>t(n,(t=>te(e,t))))),forEachCell:(e,t,n)=>te(ee(ee(F,y(e)),y(t)),n),forEachValue:e=>te(j,e),addSortedRowIdsListener:(e,t,n,l,s,o,r)=>{let a=Pt(e,t,n,l,s);return Pe((()=>{const r=Pt(e,t,n,l,s);S(r,a)||(a=r,o(Kt,e,t,n,l,s,a))}),ae[r?1:0],[e,t],[xt])},addWillFinishTransactionListener:e=>Pe(e,xe[0]),addDidFinishTransactionListener:e=>Pe(e,xe[1]),callListener:e=>(Me(e),Kt),delListener:e=>(Je(e),Kt),getListenerStats:()=>({}),createStore:_e};return Ce({Tables:[0,B],TableIds:[0,q],[h]:[1,H,[xt]],[f]:[1,K,[xt]],Row:[2,he,[xt,Et]],[g]:[2,fe,[xt,Et]],[p]:[3,ge,[xt,Et,kt],e=>Ke(Jt(...e))],InvalidCell:[3,pe],Values:[0,Se],ValueIds:[0,Ie],Value:[1,Te,[At],e=>Ke(Dt(e[0]))],InvalidValue:[1,we]},(([e,t,n,l],s)=>{Kt[v+s+c]=(...s)=>Pe(s[e],t[s[e+1]?1:0],e>0?E(s,0,e):void 0,n,l)})),Re(Kt)};e.createCheckpoints=xe,e.createCustomPersister=De,e.createFilePersister=(e,n)=>{let l;return De(e,(()=>ze(void 0,null,(function*(){try{return yield t.promises.readFile(n,d)}catch(e){}}))),(e=>ze(void 0,null,(function*(){try{yield t.promises.writeFile(n,e,d)}catch(e){}}))),(e=>{l=t.watch(n,e)}),(()=>{null==l||l.close(),l=void 0}))},e.createIndexes=Pe,e.createLocalPersister=(e,t)=>Qe(e,t,localStorage),e.createMetrics=Me,e.createQueries=$e,e.createRelationships=Ge,e.createRemotePersister=(e,t,n,l)=>{let s,o;return De(e,(()=>Ne(void 0,null,(function*(){const e=yield fetch(t);return o=We(e),e.text()}))),(e=>Ne(void 0,null,(function*(){return yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:e})}))),(e=>{s=setInterval((()=>Ne(void 0,null,(function*(){const n=yield fetch(t,{method:"HEAD"}),l=We(n);Q(o)||Q(l)||l==o||(o=l,e())}))),1e3*l)}),(()=>{z(s,clearInterval),s=void 0}))},e.createSessionPersister=(e,t)=>Qe(e,t,sessionStorage),e.createStore=_e,e.defaultSorter=Ee},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("fs")):"function"==typeof define&&define.amd?define(["exports","fs"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBase={},e.fs);
