var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,l="",n=t(l),s=t(!0),r=t(0),a=t(t),o="type",u="default",i=e=>l+e,d=(e,t)=>e.forEach(t),c=(e,t)=>e.map(t),f=e=>e.length,v=(e,t,l)=>e.slice(t,l),h=(e,...t)=>e.push(...t),T=e=>JSON.stringify(e,((e,t)=>{return V(t,Map)?(l=(e,[t,l])=>(e[t]=l,e),n={},[...t].reduce(l,n)):t;var l,n})),g=JSON.parse,b=isFinite,V=(e,t)=>e instanceof t,y=e=>null==e,S=(e,t,l)=>y(e)?null==l?void 0:l():t(e),p=e=>e==n||e==s,w=e=>t(e)==a,m=(e,t)=>{var l;return null!=(l=null==e?void 0:e.has(t))&&l},I=e=>y(e)||0==(e=>e.size)(e),R=e=>e.clear(),C=(e,t)=>null==e?void 0:e.forEach(t),J=(e,t)=>null==e?void 0:e.delete(t),L=e=>new Map(e),E=e=>{var t;return[...null!=(t=null==e?void 0:e.keys())?t:[]]},F=(e,t)=>null==e?void 0:e.get(t),x=(e,t)=>C(e,((e,l)=>t(l,e))),z=(e,t,l)=>y(l)?(J(e,t),e):null==e?void 0:e.set(t,l),O=(e,t,l)=>(m(e,t)||z(e,t,l()),F(e,t)),j=(e,t,l)=>{const n={},s=null!=t?t:e=>e;return C(e,((e,t)=>S(s(e),(e=>(null==l?void 0:l(e))?0:n[t]=e)))),n},k=(e,t)=>{const l=L(),n=null!=t?t:e=>e;return C(e,((e,t)=>l.set(t,n(e)))),l},A=e=>k(e,k),M=(e,t,l,n,s=0)=>S((l?O:F)(e,t[s],s>f(t)-2?l:L),(r=>{if(s>f(t)-2)return(null==n?void 0:n(r))&&z(e,t[s]),r;const a=M(r,t,l,n,s+1);return I(r)&&z(e,t[s]),a})),N=e=>new Set(Array.isArray(e)||y(e)?e:[e]),P=(e,t)=>null==e?void 0:e.add(t),B=/^\d+$/,D=()=>{const e=[];let t=0;return[()=>{var n;return null!=(n=e.shift())?n:l+t++},t=>{B.test(t)&&f(e)<1e3&&h(e,t)}]},W=Object,$=W.keys,q=W.isFrozen,G=W.freeze,H=e=>V(e,W)&&e.constructor==W,K=(e,t)=>!y(((e,t)=>S(e,(e=>e[t])))(e,t)),Q=(e,t)=>delete e[t],U=(e,t)=>c(W.entries(e),(([e,l])=>t(l,e))),X=e=>{return H(e)&&(t=$(e),0==f(t));var t},Y=e=>[e,e],Z=()=>[L(),L()],_=e=>{const l=t(e);return p(l)||l==r&&b(e)?l:void 0},ee=(e,t,l,n=z)=>{const s=(r=e=>!K(t,e),E(e).filter(r));var r;return d($(t),(n=>l(e,n,t[n]))),d(s,(t=>n(e,t))),e},te=(e,t,l)=>y(e)||!H(e)||X(e)||q(e)?(null==l||l(),!1):(U(e,((l,n)=>{t(l,n)||Q(e,n)})),!X(e)),le=(e,t,l)=>z(e,t,F(e,t)==-l?void 0:l),ne=()=>{let e,t,n,s,a=0;const b=L(),V=L(),B=L(),W=L(),$=L(),q=L(),H=L(),se=L(),re=L(),ae=L(),oe=L(),ue=L(),ie=N(),de=L(),ce=L(),fe=L(),ve=Z(),he=Z(),Te=Z(),ge=Z(),be=Z(),Ve=Z(),ye=Z(),Se=Z(),pe=Z(),we=Z(),me=Z(),Ie=Z(),Re=Z(),Ce=Z(),[Je,Le,Ee,Fe]=(e=>{let t;const[n,s]=D(),r=L();return[(e,s,a,o=[],u=(()=>[]))=>{null!=t||(t=Pt);const i=n();return z(r,i,[e,s,a,o,u]),P(M(s,null!=a?a:[l],N),i),i},(e,n,...s)=>d(((e,t=[l])=>{const n=[],s=(e,l)=>l==f(t)?h(n,e):null===t[l]?C(e,(e=>s(e,l+1))):d([t[l],null],(t=>s(F(e,t),l+1)));return s(e,0),n})(e,n),(e=>C(e,(e=>F(r,e)[0](t,...null!=n?n:[],...s))))),e=>S(F(r,e),(([,t,n])=>(M(t,null!=n?n:[l],void 0,(t=>(J(t,e),I(t)?1:0))),z(r,e),s(e),n))),e=>S(F(r,e),(([e,,l=[],n,s])=>{const r=(...a)=>{var o,u;const i=f(a);i==f(l)?e(t,...a,...s(a)):y(l[i])?d(null!=(u=null==(o=n[i])?void 0:o.call(n,...a))?u:[],(e=>r(...a,e))):r(...a,l[i])};r()}))]})(),xe=e=>{if(!te(e,((e,t)=>[o,u].includes(t))))return!1;const t=e.type;return!(!p(t)&&t!=r||(_(e.default)!=t&&Q(e,u),0))},ze=(t,l)=>(!e||m(re,l)||ut(l))&&te(t,((e,t)=>Oe(l,t,e)),(()=>ut(l))),Oe=(e,t,l,n)=>te(n?l:Me(l,e,t),((n,s)=>S(je(e,t,s,n),(e=>(l[s]=e,!0)),(()=>!1))),(()=>ut(e,t))),je=(t,l,n,s)=>e?S(F(F(re,t),n),(e=>_(s)!=e.type?ut(t,l,n,s,e.default):s),(()=>ut(t,l,n,s))):y(_(s))?ut(t,l,n,s):s,ke=(e,t)=>te(t?e:Ne(e),((t,l)=>S(Ae(l,t),(t=>(e[l]=t,!0)),(()=>!1))),(()=>it())),Ae=(e,l)=>t?S(F(oe,e),(t=>_(l)!=t.type?it(e,l,t.default):l),(()=>it(e,l))):y(_(l))?it(e,l):l,Me=(e,t,l)=>(S(F(ae,t),(([n,s])=>{C(n,((t,l)=>{K(e,l)||(e[l]=t)})),C(s,(n=>{K(e,n)||ut(t,l,n)}))})),e),Ne=e=>(t&&(C(ue,((t,l)=>{K(e,l)||(e[l]=t)})),C(ie,(t=>{K(e,t)||it(t)}))),e),Pe=e=>ee(re,e,((e,t,l)=>{const n=L(),s=N();ee(O(re,t,L),l,((e,t,l)=>{z(e,t,l),S(l.default,(e=>z(n,t,e)),(()=>P(s,t)))})),z(ae,t,[n,s])}),((e,t)=>{z(re,t),z(ae,t)})),Be=e=>ee(oe,e,((e,t,l)=>{z(oe,t,l),S(l.default,(e=>z(ue,t,e)),(()=>P(ie,t)))}),((e,t)=>{z(oe,t),z(ue,t),J(ie,t)})),De=e=>X(e)?zt():Jt(e),We=e=>ee(ce,e,((e,t,l)=>$e(t,l)),((e,t)=>Ze(t))),$e=(e,t)=>ee(O(ce,e,(()=>(lt(e,1),L()))),t,((t,l,n)=>qe(e,t,l,n)),((t,l)=>_e(e,t,l))),qe=(e,t,l,n,s)=>ee(O(t,l,(()=>(nt(e,l,1),L()))),n,((t,n,s)=>Ge(e,l,t,n,s)),((n,r)=>et(e,t,l,n,r,s))),Ge=(e,t,l,n,s)=>{m(l,n)||st(e,t,n,1);const r=F(l,n);s!==r&&(rt(e,t,n,r,s),z(l,n,s))},He=(e,t,l,n,s)=>S(F(t,l),(t=>Ge(e,l,t,n,s)),(()=>qe(e,t,l,Me({[n]:s},e,l)))),Ke=e=>X(e)?Ot():Lt(e),Qe=e=>ee(fe,e,((e,t,l)=>Ue(t,l)),((e,t)=>tt(t))),Ue=(e,t)=>{m(fe,e)||at(e,1);const l=F(fe,e);t!==l&&(ot(e,l,t),z(fe,e,t))},Xe=e=>{const[t]=O(de,e,D),l=t();return m(F(ce,e),l)?Xe(e):l},Ye=e=>{var t;return null!=(t=F(ce,e))?t:$e(e,{})},Ze=e=>$e(e,{}),_e=(e,t,l)=>{const[,n]=O(de,e,D);n(l),qe(e,t,l,{},!0)},et=(e,t,l,n,s,r)=>{var a;const o=F(null==(a=F(ae,e))?void 0:a[0],s);if(!y(o)&&!r)return Ge(e,l,n,s,o);const u=t=>{rt(e,l,t,F(n,t)),st(e,l,t,-1),z(n,t)};y(o)?u(s):x(n,u),I(n)&&(nt(e,l,-1),I(z(t,l))&&(lt(e,-1),z(ce,e),z(de,e)))},tt=e=>{const t=F(ue,e);if(!y(t))return Ue(e,t);ot(e,F(fe,e)),at(e,-1),z(fe,e)},lt=(e,t)=>le(b,e,t),nt=(e,t,l)=>le(O(V,e,L),t,l),st=(e,t,l,n)=>le(O(O(B,e,L),t,L),l,n),rt=(e,t,l,n,s)=>O(O(O(W,e,L),t,L),l,(()=>[n,0]))[1]=s,at=(e,t)=>le($,e,t),ot=(e,t,l)=>O(q,e,(()=>[t,0]))[1]=l,ut=(e,t,l,n,s)=>(h(O(O(O(H,e,L),t,L),l,(()=>[])),n),s),it=(e,t,l)=>(h(O(se,e,(()=>[])),t),l),dt=(e,t,l)=>S(F(F(F(W,e),t),l),(([e,t])=>[!0,e,t]),(()=>[!1,...Y(mt(e,t,l))])),ct=e=>S(F(q,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Y(Ct(e))])),ft=e=>I(H)||I(pe[e])?0:C(e?k(H,A):H,((t,l)=>C(t,((t,n)=>C(t,((t,s)=>Le(pe[e],[l,n,s],t))))))),vt=e=>I(se)||I(we[e])?0:C(e?k(se):se,((t,l)=>Le(we[e],[l],t))),ht=(e,t,l)=>{if(!I(t))return Le(e,l),1},Tt=e=>{const t=I(be[e]),l=I(ye[e])&&I(ge[e])&&t&&I(he[e]),n=I(Se[e])&&I(Ve[e])&&I(Te[e])&&I(ve[e]);if(!l||!n){const s=e?[k(b),A(V),k(B,A),k(W,A)]:[b,V,B,W];if(!l){C(s[2],((t,l)=>C(t,((t,n)=>ht(ye[e],t,[l,n])))));const l=N();C(s[1],((n,s)=>{ht(ge[e],n,[s])&&!t&&(Le(be[e],[s,null]),P(l,s))})),t||C(s[3],((t,n)=>{if(!m(l,n)){const l=N();C(t,(e=>C(e,(([t,n],s)=>n!==t?P(l,s):J(e,s))))),C(l,(t=>Le(be[e],[n,t])))}})),ht(he[e],s[0])}if(!n){let t;C(s[3],((l,n)=>{let s;C(l,((l,r)=>{let a;C(l,(([l,o],u)=>{o!==l&&(Le(Se[e],[n,r,u],o,l,dt),t=s=a=1)})),a&&Le(Ve[e],[n,r],dt)})),s&&Le(Te[e],[n],dt)})),t&&Le(ve[e],void 0,dt)}}},gt=e=>{const t=I(Ie[e]),l=I(Re[e])&&I(me[e]);if(!t||!l){const n=e?[k($),k(q)]:[$,q];if(t||ht(Ie[e],n[0]),!l){let t;C(n[1],(([l,n],s)=>{n!==l&&(Le(Re[e],[s],n,l,ct),t=1)})),t&&Le(me[e],void 0,ct)}}},bt=(e,...t)=>(At((()=>e(...c(t,i)))),Pt),Vt=()=>j(ce,(e=>j(e,j))),yt=()=>E(ce),St=e=>E(F(ce,i(e))),pt=(e,t,l,n=0,s)=>{return c(v((a=F(ce,i(e)),o=(e,l)=>[y(t)?l:F(e,i(t)),l],r=([e],[t])=>(e<t?-1:1)*(l?-1:1),c([...null!=(u=null==a?void 0:a.entries())?u:[]],(([e,t])=>o(t,e))).sort(r)),n,y(s)?s:n+s),(([,e])=>e));var r,a,o,u},wt=(e,t)=>E(F(F(ce,i(e)),i(t))),mt=(e,t,l)=>F(F(F(ce,i(e)),i(t)),i(l)),It=()=>j(fe),Rt=()=>E(fe),Ct=e=>F(fe,i(e)),Jt=e=>bt((()=>(e=>te(e,ze,ut))(e)?We(e):0)),Lt=e=>bt((()=>ke(e)?Qe(e):0)),Et=e=>{try{De(g(e))}catch(e){}return Pt},Ft=t=>bt((()=>{if((e=te(t,(e=>te(e,xe))))&&(Pe(t),!I(ce))){const e=Vt();zt(),Jt(e)}})),xt=e=>bt((()=>{if(t=(e=>te(e,xe))(e)){const l=It();kt(),Ot(),t=!0,Be(e),Lt(l)}})),zt=()=>bt((()=>We({}))),Ot=()=>bt((()=>Qe({}))),jt=()=>bt((()=>{Pe({}),e=!1})),kt=()=>bt((()=>{Be({}),t=!1})),At=(e,t)=>{if(-1==a)return;Mt();const l=e();return Nt(t),l},Mt=()=>(a++,Pt),Nt=e=>(a>0&&(a--,0==a&&(n=!I(W),s=!I(q),a=1,ft(1),n&&Tt(1),vt(1),s&&gt(1),a=-1,(null==e?void 0:e(j(W,(e=>j(e,(e=>j(e,(e=>[...e]),(([e,t])=>e===t))),X)),X),j(H,(e=>j(e,j))),j(q,(e=>[...e]),(([e,t])=>e===t)),j(se)))&&(a=1,C(W,((e,t)=>C(e,((e,l)=>C(e,(([e],n)=>((e,t,l,n,s)=>y(s)?e.delCell(t,l,n,!0):e.setCell(t,l,n,s))(Pt,t,l,n,e))))))),C(q,(([e],t)=>((e,t,l)=>y(l)?e.delValue(t):e.setValue(t,l))(Pt,t,e))),a=-1,n=s=!1),Le(Ce[0],void 0,n,s),ft(0),n&&Tt(0),vt(0),s&&gt(0),Le(Ce[1],void 0,n,s),a=0,d([b,V,B,W,H,$,q,se],R))),Pt),Pt={getTables:Vt,getTableIds:yt,getTable:e=>j(F(ce,i(e)),j),getRowIds:St,getSortedRowIds:pt,getRow:(e,t)=>j(F(F(ce,i(e)),i(t))),getCellIds:wt,getCell:mt,getValues:It,getValueIds:Rt,getValue:Ct,hasTables:()=>!I(ce),hasTable:e=>m(ce,i(e)),hasRow:(e,t)=>m(F(ce,i(e)),i(t)),hasCell:(e,t,l)=>m(F(F(ce,i(e)),i(t)),i(l)),hasValues:()=>!I(fe),hasValue:e=>m(fe,i(e)),getTablesJson:()=>T(ce),getValuesJson:()=>T(fe),getJson:()=>T([ce,fe]),getTablesSchemaJson:()=>T(re),getValuesSchemaJson:()=>T(oe),getSchemaJson:()=>T([re,oe]),setTables:Jt,setTable:(e,t)=>bt((e=>ze(t,e)?$e(e,t):0),e),setRow:(e,t,l)=>bt(((e,t)=>Oe(e,t,l)?qe(e,Ye(e),t,l):0),e,t),addRow:(e,t)=>At((()=>{let l;return Oe(e,l,t)&&(e=i(e),qe(e,Ye(e),l=Xe(e),t)),l})),setPartialRow:(e,t,l)=>bt(((e,t)=>{if(Oe(e,t,l,1)){const n=Ye(e);U(l,((l,s)=>He(e,n,t,s,l)))}}),e,t),setCell:(e,t,l,n)=>bt(((e,t,l)=>S(je(e,t,l,w(n)?n(mt(e,t,l)):n),(n=>He(e,Ye(e),t,l,n)))),e,t,l),setValues:Lt,setPartialValues:e=>bt((()=>ke(e,1)?U(e,((e,t)=>Ue(t,e))):0)),setValue:(e,t)=>bt((e=>S(Ae(e,w(t)?t(Ct(e)):t),(t=>Ue(e,t)))),e),setTablesJson:Et,setValuesJson:e=>{try{Ke(g(e))}catch(e){}return Pt},setJson:e=>{try{const[t,l]=g(e);De(t),Ke(l)}catch(t){Et(e)}return Pt},setTablesSchema:Ft,setValuesSchema:xt,setSchema:(e,t)=>bt((()=>{Ft(e),xt(t)})),delTables:zt,delTable:e=>bt((e=>m(ce,e)?Ze(e):0),e),delRow:(e,t)=>bt(((e,t)=>S(F(ce,e),(l=>m(l,t)?_e(e,l,t):0))),e,t),delCell:(e,t,l,n)=>bt(((e,t,l)=>S(F(ce,e),(s=>S(F(s,t),(r=>m(r,l)?et(e,s,t,r,l,n):0))))),e,t,l),delValues:Ot,delValue:e=>bt((e=>m(fe,e)?tt(e):0),e),delTablesSchema:jt,delValuesSchema:kt,delSchema:()=>bt((()=>{jt(),kt()})),transaction:At,startTransaction:Mt,finishTransaction:Nt,forEachTable:e=>C(ce,((t,l)=>e(l,(e=>C(t,((t,l)=>e(l,(e=>x(t,e))))))))),forEachRow:(e,t)=>C(F(ce,i(e)),((e,l)=>t(l,(t=>x(e,t))))),forEachCell:(e,t,l)=>x(F(F(ce,i(e)),i(t)),l),forEachValue:e=>x(fe,e),addSortedRowIdsListener:(e,t,l,n,s,r,a)=>{let o=pt(e,t,l,n,s);return Je((()=>{const a=pt(e,t,l,n,s);var u,i,d;i=o,f(u=a)===f(i)&&(d=(e,t)=>i[t]===e,u.every(d))||(o=a,r(Pt,e,t,l,n,s,o))}),be[a?1:0],[e,t],[yt])},addWillFinishTransactionListener:e=>Je(e,Ce[0]),addDidFinishTransactionListener:e=>Je(e,Ce[1]),callListener:e=>(Fe(e),Pt),delListener:e=>(Ee(e),Pt),getListenerStats:()=>({}),createStore:ne};return U({Tables:[0,ve],TableIds:[0,he],Table:[1,Te,[yt]],RowIds:[1,ge,[yt]],Row:[2,Ve,[yt,St]],CellIds:[2,ye,[yt,St]],Cell:[3,Se,[yt,St,wt],e=>Y(mt(...e))],InvalidCell:[3,pe],Values:[0,me],ValueIds:[0,Ie],Value:[1,Re,[Rt],e=>Y(Ct(e[0]))],InvalidValue:[1,we]},(([e,t,l,n],s)=>{Pt["add"+s+"Listener"]=(...s)=>Je(s[e],t[s[e+1]?1:0],e>0?v(s,0,e):void 0,l,n)})),G(Pt)};e.createStore=ne},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
