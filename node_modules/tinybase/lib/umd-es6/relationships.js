var e,n;e=this,n=function(e){"use strict";const n=e=>typeof e,t="",l=n(t),o=(e,n)=>e.forEach(n),r=e=>e.length,s=(e,...n)=>e.push(...n),i=e=>null==e,d=(e,n,t)=>i(e)?null==t?void 0:t():n(e),a=e=>Array.isArray(e),u=(e,n)=>{var t;return null!=(t=null==e?void 0:e.has(n))&&t},c=e=>i(e)||0==(e=>e.size)(e),v=e=>{var n;return[...null!=(n=null==e?void 0:e.values())?n:[]]},f=e=>e.clear(),h=(e,n)=>null==e?void 0:e.forEach(n),R=(e,n)=>null==e?void 0:e.delete(n),p=e=>new Map(e),g=(e,n)=>null==e?void 0:e.get(n),L=(e,n)=>h(e,((e,t)=>n(t,e))),w=(e,n,t)=>i(t)?(R(e,n),e):null==e?void 0:e.set(n,t),y=(e,n,t)=>(u(e,n)||w(e,n,t()),g(e,n)),I=(e,n,t,l,o=0)=>d((t?y:g)(e,n[o],o>r(n)-2?t:p),(s=>{if(o>r(n)-2)return(null==l?void 0:l(s))&&w(e,n[o]),s;const i=I(s,n,t,l,o+1);return c(s)&&w(e,n[o]),i})),b=e=>new Set(a(e)||i(e)?e:[e]),T=(e,n)=>null==e?void 0:e.add(n),m=/^\d+$/,k=Object.freeze,E=(e=>{const E=new WeakMap;return e=>(E.has(e)||E.set(e,(e=>{const E=p(),x=p(),S=p(),j=p(),[z,A,D,M,B,C,,,O,W,$]=((e,n,l)=>{const s=e.hasRow,I=p(),m=p(),k=p(),E=p(),x=p(),S=(n,t,...l)=>{const r=y(x,n,b);return o(l,(n=>T(r,n)&&t&&e.callListener(n))),l},j=(n,...t)=>d(g(x,n),(l=>{o(0==r(t)?v(l):t,(n=>{e.delListener(n),R(l,n)})),c(l)&&w(x,n)})),z=(e,n)=>{w(I,e,n),u(m,e)||(w(m,e,[p(),p(),p(),p()]),w(k,e,p()),w(E,e,p()))},A=e=>{w(I,e),w(m,e),w(k,e),w(E,e),j(e)};return[()=>e,()=>{return[...null!=(n=null==(e=I)?void 0:e.keys())?n:[]];var e,n},e=>L(m,e),e=>u(m,e),e=>g(I,e),e=>g(m,e),(e,n)=>w(m,e,n),z,(n,l,d,c,v)=>{z(n,l);const R=p(),y=p(),I=g(k,n),b=g(E,n),T=n=>{const o=t=>e.getCell(l,n,t),d=g(I,n),u=s(l,n)?(f=c(o,n),i(f)?void 0:f+t):void 0;var f,h,p,L;if(d===u||a(d)&&a(u)&&(p=u,r(h=d)===r(p)&&(L=(e,n)=>p[n]===e,h.every(L)))||w(R,n,[d,u]),!i(v)){const e=g(b,n),t=s(l,n)?v(o,n):void 0;e!=t&&w(y,n,t)}},m=e=>{d((()=>{h(R,(([,e],n)=>w(I,n,e))),h(y,((e,n)=>w(b,n,e)))}),R,y,I,b,e),f(R),f(y)};L(I,T),e.hasTable(l)&&o(e.getRowIds(l),(e=>{u(I,e)||T(e)})),m(!0),j(n),S(n,0,e.addRowListener(l,null,((e,n,t)=>T(t))),e.addTableListener(l,(()=>m())))},A,()=>L(x,A),S,j]})(e),[q,F,G]=(e=>{let n;const[l,a]=(()=>{const e=[];let n=0;return[()=>{var l;return null!=(l=e.shift())?l:t+n++},n=>{m.test(n)&&r(e)<1e3&&s(e,n)}]})(),u=p();return[(e,o,r,s=[],i=(()=>[]))=>{null!=n||(n=N);const d=l();return w(u,d,[e,o,r,s,i]),T(I(o,null!=r?r:[t],b),d),d},(e,l,...i)=>o(((e,n=[t])=>{const l=[],i=(e,t)=>t==r(n)?s(l,e):null===n[t]?h(e,(e=>i(e,t+1))):o([n[t],null],(n=>i(g(e,n),t+1)));return i(e,0),l})(e,l),(e=>h(e,(e=>g(u,e)[0](n,...null!=l?l:[],...i))))),e=>d(g(u,e),(([,n,l])=>(I(n,null!=l?l:[t],void 0,(n=>(R(n,e),c(n)?1:0))),w(u,e),a(e),l))),e=>d(g(u,e),(([e,,t=[],l,s])=>{const d=(...a)=>{var u,c;const v=r(a);v==r(t)?e(n,...a,...s(a)):i(t[v])?o(null!=(c=null==(u=l[v])?void 0:u.call(l,...a))?c:[],(e=>d(...a,e))):d(...a,t[v])};d()}))]})(),H=(e,n,t)=>d(C(e),(([l,,o])=>{if(!u(o,n)){const r=b();if(B(e)!=K(e))T(r,n);else{let e=n;for(;!i(e)&&!u(r,e);)T(r,e),e=g(l,e)}if(t)return r;w(o,n,r)}return g(o,n)})),J=(e,n)=>d(C(e),(([,,e])=>w(e,n))),K=e=>g(E,e),N={setRelationshipDefinition:(e,o,r,s)=>{return w(E,e,r),O(e,o,((n,t)=>{const l=b(),o=b(),r=b(),[s,a]=C(e);h(t,(([n,t],v)=>{i(n)||(T(o,n),d(g(a,n),(e=>{R(e,v),c(e)&&w(a,n)}))),i(t)||(T(o,t),u(a,t)||w(a,t,b()),T(g(a,t),v)),T(l,v),w(s,v,t),L(g(j,e),(n=>{u(H(e,n),v)&&T(r,n)}))})),n(),h(l,(n=>F(x,[e,n]))),h(o,(n=>F(S,[e,n]))),h(r,(n=>{J(e,n),F(j,[e,n])}))}),n(a=s)==l?e=>e(a):null!=a?a:()=>t),N;var a},delRelationshipDefinition:e=>(w(E,e),W(e),N),getStore:z,getRelationshipIds:A,forEachRelationship:n=>D((t=>n(t,(n=>e.forEachRow(B(t),n))))),hasRelationship:M,getLocalTableId:B,getRemoteTableId:K,getRemoteRowId:(e,n)=>{var t;return g(null==(t=C(e))?void 0:t[0],n)},getLocalRowIds:(e,n)=>{var t;return v(g(null==(t=C(e))?void 0:t[1],n))},getLinkedRowIds:(e,n)=>i(C(e))?[n]:v(H(e,n,!0)),addRemoteRowIdListener:(e,n,t)=>q(t,x,[e,n]),addLocalRowIdsListener:(e,n,t)=>q(t,S,[e,n]),addLinkedRowIdsListener:(e,n,t)=>(H(e,n),q(t,j,[e,n])),delListener:e=>(J(...G(e)),N),destroy:$,getListenerStats:()=>({})};return k(N)})(e)),E.get(e))})();e.createRelationships=E},"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseRelationships={});
