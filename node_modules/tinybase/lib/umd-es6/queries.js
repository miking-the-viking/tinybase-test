var e,n;e=this,n=function(e){"use strict";const n=e=>typeof e,t=n(""),l=n(!0),r=n(0),o=n(n),s="Listener",i=(e,n)=>e.every(n),a=(e,n)=>e.forEach(n),d=e=>v(e,((e,n)=>e+n),0),u=e=>e.length,c=e=>0==u(e),v=(e,n,t)=>e.reduce(n,t),f=(e,...n)=>e.push(...n),h=Math.max,w=Math.min,y=isFinite,g=e=>null==e,p=(e,n,t)=>g(e)?null==t?void 0:t():n(e),R=e=>n(e)==o,b=e=>Array.isArray(e),L=()=>{},T=e=>e.size,m=(e,n)=>{var t;return null!=(t=null==e?void 0:e.has(n))&&t},C=e=>g(e)||0==T(e),I=e=>{var n;return[...null!=(n=null==e?void 0:e.values())?n:[]]},O=e=>e.clear(),x=(e,n)=>null==e?void 0:e.forEach(n),Q=(e,n)=>null==e?void 0:e.delete(n),S=e=>new Map(e),j=(e,n)=>null==e?void 0:e.get(n),E=(e,n)=>x(e,((e,t)=>n(t,e))),M=(e,n,t)=>g(t)?(Q(e,n),e):null==e?void 0:e.set(n,t),D=(e,n,t)=>(m(e,n)||M(e,n,t()),j(e,n)),F=(e,n,t,l,r=0)=>p((t?D:j)(e,n[r],r>u(n)-2?t:S),(o=>{if(r>u(n)-2)return(null==l?void 0:l(o))&&M(e,n[r]),o;const s=F(o,n,t,l,r+1);return C(o)&&M(e,n[r]),s})),k=e=>new Set(b(e)||g(e)?e:[e]),z=(e,n)=>null==e?void 0:e.add(n),A=S([["avg",[(e,n)=>d(e)/n,(e,n,t)=>e+(n-e)/(t+1),(e,n,t)=>e+(e-n)/(t-1),(e,n,t,l)=>e+(n-t)/l]],["max",[e=>h(...e),(e,n)=>h(n,e),(e,n)=>n==e?void 0:e,(e,n,t)=>t==e?void 0:h(n,e)]],["min",[e=>w(...e),(e,n)=>w(n,e),(e,n)=>n==e?void 0:e,(e,n,t)=>t==e?void 0:w(n,e)]],["sum",[e=>d(e),(e,n)=>e+n,(e,n)=>e-n,(e,n,t)=>e-t+n]]]),P=Object,W=P.freeze;var B=Object.getOwnPropertySymbols,q=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;const H=(e=>{const o=new WeakMap;return e=>(o.has(e)||o.set(e,(e=>{const o=e.createStore,[d,v,h,w,H,,,J,,K,N,U,V]=((e,n,t)=>{const l=e.hasRow,r=S(),o=S(),s=S(),d=S(),v=S(),f=(n,t,...l)=>{const r=D(v,n,k);return a(l,(n=>z(r,n)&&t&&e.callListener(n))),l},h=(n,...t)=>p(j(v,n),(l=>{a(c(t)?I(l):t,(n=>{e.delListener(n),Q(l,n)})),C(l)&&M(v,n)})),w=(e,n)=>{M(r,e,n),m(o,e)||(M(o,e,!0),M(s,e,S()),M(d,e,S()))},y=e=>{M(r,e),M(o,e),M(s,e),M(d,e),h(e)};return[()=>e,()=>{return[...null!=(n=null==(e=r)?void 0:e.keys())?n:[]];var e,n},e=>E(o,e),e=>m(o,e),e=>j(r,e),e=>j(o,e),(e,n)=>M(o,e,n),w,(n,r,o,c,v)=>{w(n,r);const y=S(),p=S(),R=j(s,n),L=j(d,n),T=n=>{const o=t=>e.getCell(r,n,t),s=j(R,n),a=l(r,n)?t(c(o,n)):void 0;var d,f;if(s===a||b(s)&&b(a)&&(f=a,u(d=s)===u(f)&&i(d,((e,n)=>f[n]===e)))||M(y,n,[s,a]),!g(v)){const e=j(L,n),t=l(r,n)?v(o,n):void 0;e!=t&&M(p,n,t)}},C=e=>{o((()=>{x(y,(([,e],n)=>M(R,n,e))),x(p,((e,n)=>M(L,n,e)))}),y,p,R,L,e),O(y),O(p)};E(R,T),e.hasTable(r)&&a(e.getRowIds(r),(e=>{m(R,e)||T(e)})),C(!0),h(n),f(n,0,e.addRowListener(r,null,((e,n,t)=>T(t))),e.addTableListener(r,(()=>C())))},y,()=>E(v,y),f,h]})(e,0,L),X=o(),Y=o(),Z=S(),$=(e,n,...t)=>a(t,(t=>z(D(D(Z,n,S),e,k),t))),_=e=>{p(j(Z,e),(e=>{E(e,((e,n)=>x(n,(n=>e.delListener(n))))),O(e)})),a([Y,X],(n=>n.delTable(e)))},ee=(e,n,t)=>$(n,e,n.addWillFinishTransactionListener(t.startTransaction),n.addDidFinishTransactionListener((()=>t.finishTransaction()))),ne={setQueryDefinition:(o,s,d)=>{J(o,s),_(o);const v=[],h=[[null,[s,null,null,[],S()]]],w=[],b=[],L=[];d({select:(e,n)=>{const t=R(e)?[u(v)+"",e]:[g(n)?e:n,t=>t(e,n)];return f(v,t),{as:e=>t[0]=e}},join:(e,n,t)=>{const l=g(t)||R(n)?null:n,r=g(l)?n:t,o=[e,[e,l,R(r)?r:e=>e(r),[],S()]];return f(h,o),{as:e=>o[0]=e}},where:(e,n,t)=>f(w,R(e)?e:g(t)?t=>t(e)===n:l=>l(e,n)===t),group:(e,n,t,l,r)=>{var o;const s=[e,[e,R(n)?[n,t,l,r]:null!=(o=j(A,n))?o:[(e,n)=>n]]];return f(b,s),{as:e=>s[0]=e}},having:(e,n)=>f(L,R(e)?e:t=>t(e)===n)});const O=S(v);if(C(O))return ne;const P=S(h);E(P,((e,[,n])=>p(j(P,n),(({3:n})=>g(e)?0:f(n,e)))));const W=S(b);let B=X;if(C(W)&&c(L))B=Y;else{ee(o,B,Y);const e=S();E(W,((n,[t,l])=>z(D(e,t,k),[n,l])));const s=k();E(O,(n=>m(e,n)?0:z(s,n)));const a=S(),d=(s,a,d,u)=>p(s,(([c,v,f,h])=>{E(a,((o,[s])=>{const i=D(c,o,S),a=j(i,d),v=u?void 0:s;if(a!==v){const s=k([[a,v]]),u=T(i);M(i,d,v),x(j(e,o),(([e,o])=>{const a=((e,n,t,l,r,o=!1)=>{if(C(t))return;const[s,i,a,d]=r;return o||(o=g(e)),x(l,(([t,l])=>{o||(e=g(t)?null==i?void 0:i(e,l,n++):g(l)?null==a?void 0:a(e,t,n--):null==d?void 0:d(e,l,t,n),o||(o=g(e)))})),o?s(I(t),T(t)):e})(h[e],u,i,s,o);h[e]=g((e=>{const o=n(e);return(e=>e==t||e==l)(o)||o==r&&y(e)?o:void 0})(a))?null:a}))}})),C(v)||!i(L,(e=>e((e=>h[e]))))?Y.delRow(o,f):g(f)?s[2]=Y.addRow(o,h):Y.setRow(o,f,h)}));$(B,o,B.addRowListener(o,null,((n,t,l,r)=>{const i=[],u=[],c=S(),v=B.hasRow(o,l);let h=!v;x(s,(e=>{const[n,t,s]=r(o,l,e);f(i,t),f(u,s),h||(h=n)})),E(e,(e=>{const[n,,t]=r(o,l,e);(h||n)&&M(c,e,[t])})),h&&d(F(a,i,void 0,(([,e])=>(Q(e,l),C(e)))),c,l,1),v&&d(F(a,u,(()=>{const e={};return x(s,(n=>e[n]=B.getCell(o,l,n))),[S(),k(),void 0,e]}),(([,e])=>{z(e,l)})),c,l)})))}ee(o,e,B);const q=(n,t,l,r)=>{const d=n=>e.getCell(t,l,n);a(r,(t=>{var l;const[r,,s,i,a]=j(P,t),u=null==s?void 0:s(d,n),[c,v]=null!=(l=j(a,n))?l:[];u!=c&&(g(v)||V(o,v),M(a,n,g(u)?null:[u,...U(o,1,e.addRowListener(r,u,(()=>q(n,r,u,i))))]))})),(n=>{const t=(t,l)=>{var r,o,i;return e.getCell(...g(l)?[s,n,t]:t===s?[s,n,l]:[null==(r=j(P,t))?void 0:r[0],null==(i=j(null==(o=j(P,t))?void 0:o[4],n))?void 0:i[0],l])};B.transaction((()=>i(w,(e=>e(t)))?E(O,((e,l)=>((e,n,t,l,r)=>g(r)?e.delCell(n,t,l,!0):e.setCell(n,t,l,r))(B,o,n,e,l(t,n)))):B.delRow(o,n)))})(n)},{3:G}=j(P,null);return B.transaction((()=>U(o,1,e.addRowListener(s,null,((n,t,l)=>{e.hasRow(s,l)?q(l,s,l,G):(B.delRow(o,l),x(P,(({4:e})=>p(j(e,l),(([,n])=>{V(o,n),M(e,l)})))))}))))),ne},delQueryDefinition:e=>(_(e),K(e),ne),getStore:d,getQueryIds:v,forEachQuery:h,hasQuery:w,getTableId:H,delListener:e=>(Y.delListener(e),ne),destroy:N,getListenerStats:()=>((e,n)=>{var t={};for(var l in e)q.call(e,l)&&n.indexOf(l)<0&&(t[l]=e[l]);if(null!=e&&B)for(var l of B(e))n.indexOf(l)<0&&G.call(e,l)&&(t[l]=e[l]);return t})(Y.getListenerStats(),["tables","tableIds","transaction"])};var te,le;return te={Table:[1,1],RowIds:[0,1],SortedRowIds:[0,5],Row:[1,2],CellIds:[0,2],Cell:[1,3]},le=([e,n],t)=>{a(e?["get","has","forEach"]:["get"],(e=>ne[e+"Result"+t]=(...n)=>Y[e+t](...n))),ne["addResult"+t+s]=(...e)=>{return Y["add"+t+s](...(l=e,0,r=n,l.slice(0,r)),((t,...l)=>e[n](ne,...l)));var l,r}},((e,n)=>{e.map(n)})(P.entries(te),(([e,n])=>le(n,e))),W(ne)})(e)),o.get(e))})();e.createQueries=H},"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseQueries={});
