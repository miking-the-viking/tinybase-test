"use strict";const e=e=>typeof e,t=e(""),n=(e,t)=>e.forEach(t),l=e=>e.length,r=(e,...t)=>e.push(...t),o=e=>null==e,s=(e,t,n)=>o(e)?null==n?void 0:n():t(e),i=e=>Array.isArray(e),u=(e,t)=>{var n;return null!=(n=null==e?void 0:e.has(t))&&n},a=e=>o(e)||0==(e=>e.size)(e),d=e=>{var t;return[...null!=(t=null==e?void 0:e.values())?t:[]]},c=e=>e.clear(),v=(e,t)=>null==e?void 0:e.forEach(t),R=(e,t)=>null==e?void 0:e.delete(t),h=e=>new Map(e),f=(e,t)=>null==e?void 0:e.get(t),L=(e,t)=>v(e,((e,n)=>t(n,e))),g=(e,t,n)=>o(n)?(R(e,t),e):null==e?void 0:e.set(t,n),w=(e,t,n)=>(u(e,t)||g(e,t,n()),f(e,t)),p=(e,t,n,r,o=0)=>s((n?w:f)(e,t[o],o>l(t)-2?n:h),(s=>{if(o>l(t)-2)return(null==r?void 0:r(s))&&g(e,t[o]),s;const i=p(s,t,n,r,o+1);return a(s)&&g(e,t[o]),i})),I=e=>new Set(i(e)||o(e)?e:[e]),y=(e,t)=>null==e?void 0:e.add(t),b=/^\d+$/,k=Object.freeze,E=(E=>{const T=new WeakMap;return E=>(T.has(E)||T.set(E,(E=>{const T=h(),m=h(),S=h(),z=h(),[A,D,M,j,x,C,,,O,W,$]=((e,t,r)=>{const p=e.hasRow,b=h(),k=h(),E=h(),T=h(),m=h(),S=(t,l,...r)=>{const o=w(m,t,I);return n(r,(t=>y(o,t)&&l&&e.callListener(t))),r},z=(t,...r)=>s(f(m,t),(o=>{n(0==l(r)?d(o):r,(t=>{e.delListener(t),R(o,t)})),a(o)&&g(m,t)})),A=(e,t)=>{g(b,e,t),u(k,e)||(g(k,e,[h(),h(),h(),h()]),g(E,e,h()),g(T,e,h()))},D=e=>{g(b,e),g(k,e),g(E,e),g(T,e),z(e)};return[()=>e,()=>{return[...null!=(t=null==(e=b)?void 0:e.keys())?t:[]];var e,t},e=>L(k,e),e=>u(k,e),e=>f(b,e),e=>f(k,e),(e,t)=>g(k,e,t),A,(t,r,s,a,d)=>{A(t,r);const R=h(),w=h(),I=f(E,t),y=f(T,t),b=t=>{const n=n=>e.getCell(r,t,n),s=f(I,t),u=p(r,t)?(c=a(n,t),o(c)?void 0:c+""):void 0;var c,v,h,L;if(s===u||i(s)&&i(u)&&(h=u,l(v=s)===l(h)&&(L=(e,t)=>h[t]===e,v.every(L)))||g(R,t,[s,u]),!o(d)){const e=f(y,t),l=p(r,t)?d(n,t):void 0;e!=l&&g(w,t,l)}},k=e=>{s((()=>{v(R,(([,e],t)=>g(I,t,e))),v(w,((e,t)=>g(y,t,e)))}),R,w,I,y,e),c(R),c(w)};L(I,b),e.hasTable(r)&&n(e.getRowIds(r),(e=>{u(I,e)||b(e)})),k(!0),z(t),S(t,0,e.addRowListener(r,null,((e,t,n)=>b(n))),e.addTableListener(r,(()=>k())))},D,()=>L(m,D),S,z]})(E),[q,B,F]=(e=>{let t;const[i,u]=(()=>{const e=[];let t=0;return[()=>{var n;return null!=(n=e.shift())?n:""+t++},t=>{b.test(t)&&l(e)<1e3&&r(e,t)}]})(),d=h();return[(e,n,l,r=[],o=(()=>[]))=>{null!=t||(t=K);const s=i();return g(d,s,[e,n,l,r,o]),y(p(n,null!=l?l:[""],I),s),s},(e,o,...s)=>n(((e,t=[""])=>{const o=[],s=(e,i)=>i==l(t)?r(o,e):null===t[i]?v(e,(e=>s(e,i+1))):n([t[i],null],(t=>s(f(e,t),i+1)));return s(e,0),o})(e,o),(e=>v(e,(e=>f(d,e)[0](t,...null!=o?o:[],...s))))),e=>s(f(d,e),(([,t,n])=>(p(t,null!=n?n:[""],void 0,(t=>(R(t,e),a(t)?1:0))),g(d,e),u(e),n))),e=>s(f(d,e),(([e,,r=[],s,i])=>{const u=(...a)=>{var d,c;const v=l(a);v==l(r)?e(t,...a,...i(a)):o(r[v])?n(null!=(c=null==(d=s[v])?void 0:d.call(s,...a))?c:[],(e=>u(...a,e))):u(...a,r[v])};u()}))]})(),G=(e,t,n)=>s(C(e),(([l,,r])=>{if(!u(r,t)){const s=I();if(x(e)!=J(e))y(s,t);else{let e=t;for(;!o(e)&&!u(s,e);)y(s,e),e=f(l,e)}if(n)return s;g(r,t,s)}return f(r,t)})),H=(e,t)=>s(C(e),(([,,e])=>g(e,t))),J=e=>f(T,e),K={setRelationshipDefinition:(n,l,r,i)=>{return g(T,n,r),O(n,l,((e,t)=>{const l=I(),r=I(),i=I(),[d,c]=C(n);v(t,(([e,t],v)=>{o(e)||(y(r,e),s(f(c,e),(t=>{R(t,v),a(t)&&g(c,e)}))),o(t)||(y(r,t),u(c,t)||g(c,t,I()),y(f(c,t),v)),y(l,v),g(d,v,t),L(f(z,n),(e=>{u(G(n,e),v)&&y(i,e)}))})),e(),v(l,(e=>B(m,[n,e]))),v(r,(e=>B(S,[n,e]))),v(i,(e=>{H(n,e),B(z,[n,e])}))}),e(d=i)==t?e=>e(d):null!=d?d:()=>""),K;var d},delRelationshipDefinition:e=>(g(T,e),W(e),K),getStore:A,getRelationshipIds:D,forEachRelationship:e=>M((t=>e(t,(e=>E.forEachRow(x(t),e))))),hasRelationship:j,getLocalTableId:x,getRemoteTableId:J,getRemoteRowId:(e,t)=>{var n;return f(null==(n=C(e))?void 0:n[0],t)},getLocalRowIds:(e,t)=>{var n;return d(f(null==(n=C(e))?void 0:n[1],t))},getLinkedRowIds:(e,t)=>o(C(e))?[t]:d(G(e,t,!0)),addRemoteRowIdListener:(e,t,n)=>q(n,m,[e,t]),addLocalRowIdsListener:(e,t,n)=>q(n,S,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(G(e,t),q(n,z,[e,t])),delListener:e=>(H(...F(e)),K),destroy:$,getListenerStats:()=>({})};return k(K)})(E)),T.get(E))})();exports.createRelationships=E;
