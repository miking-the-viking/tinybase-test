"use strict";var e=require("fs");const t=e=>typeof e,n=t(""),s=t(!0),r=t(0),l=t(t),o=e=>""+e,a=(e,t)=>e.includes(t),i=(e,t)=>e.every(t),d=(e,t)=>g(e)===g(t)&&i(e,((e,n)=>t[n]===e)),c=(e,t)=>i(e,((n,s)=>0==s||t(e[s-1],n)<=0)),u=(e,t)=>e.sort(t),v=(e,t)=>e.forEach(t),h=(e,t)=>e.map(t),f=e=>L(e,((e,t)=>e+t),0),g=e=>e.length,p=e=>0==g(e),L=(e,t,n)=>e.reduce(t,n),w=(e,t,n)=>e.slice(t,n),y=(e,...t)=>e.push(...t),I=e=>e.pop(),R=e=>e.shift(),S=e=>JSON.stringify(e,((e,t)=>C(t,Map)?L([...t],((e,[t,n])=>(e[t]=n,e)),{}):t)),T=JSON.parse,b=Math.max,m=Math.min,x=isFinite,C=(e,t)=>e instanceof t,V=e=>null==e,E=(e,t,n)=>V(e)?null==n?void 0:n():t(e),P=e=>e==n||e==s,k=e=>t(e)==l,J=e=>Array.isArray(e),M=()=>{},A=e=>e.size,D=(e,t)=>{var n;return null!=(n=null==e?void 0:e.has(t))&&n},O=e=>V(e)||0==A(e),F=e=>{var t;return[...null!=(t=null==e?void 0:e.values())?t:[]]},j=e=>e.clear(),Q=(e,t)=>null==e?void 0:e.forEach(t),z=(e,t)=>null==e?void 0:e.delete(t),N=e=>new Map(e),W=e=>{var t;return[...null!=(t=null==e?void 0:e.keys())?t:[]]},q=(e,t)=>null==e?void 0:e.get(t),B=(e,t)=>Q(e,((e,n)=>t(n,e))),H=(e,t,n)=>V(n)?(z(e,t),e):null==e?void 0:e.set(t,n),$=(e,t,n)=>(D(e,t)||H(e,t,n()),q(e,t)),G=(e,t,n)=>{const s={},r=null!=t?t:e=>e;return Q(e,((e,t)=>E(r(e),(e=>(null==n?void 0:n(e))?0:s[t]=e)))),s},K=(e,t)=>{const n=N(),s=null!=t?t:e=>e;return Q(e,((e,t)=>n.set(t,s(e)))),n},U=e=>K(e,K),X=(e,t,n,s,r=0)=>E((n?$:q)(e,t[r],r>g(t)-2?n:N),(l=>{if(r>g(t)-2)return(null==s?void 0:s(l))&&H(e,t[r]),l;const o=X(l,t,n,s,r+1);return O(l)&&H(e,t[r]),o})),Y=e=>{const n=t(e);return P(n)||n==r&&x(e)?n:void 0},Z=(e,t,n,s,r)=>V(r)?e.delCell(t,n,s,!0):e.setCell(t,n,s,r),_=(e,t,n)=>V(n)?e.delValue(t):e.setValue(t,n),ee=e=>new Set(J(e)||V(e)?e:[e]),te=(e,t)=>null==e?void 0:e.add(t),ne=(e,t,n)=>{const s=e.hasRow,r=N(),l=N(),o=N(),a=N(),i=N(),c=(t,n,...s)=>{const r=$(i,t,ee);return v(s,(t=>te(r,t)&&n&&e.callListener(t))),s},u=(t,...n)=>E(q(i,t),(s=>{v(p(n)?F(s):n,(t=>{e.delListener(t),z(s,t)})),O(s)&&H(i,t)})),h=(e,n)=>{H(r,e,n),D(l,e)||(H(l,e,t()),H(o,e,N()),H(a,e,N()))},f=e=>{H(r,e),H(l,e),H(o,e),H(a,e),u(e)};return[()=>e,()=>W(r),e=>B(l,e),e=>D(l,e),e=>q(r,e),e=>q(l,e),(e,t)=>H(l,e,t),h,(t,r,l,i,f)=>{h(t,r);const g=N(),p=N(),L=q(o,t),w=q(a,t),y=t=>{const l=n=>e.getCell(r,t,n),o=q(L,t),a=s(r,t)?n(i(l,t)):void 0;if(o===a||J(o)&&J(a)&&d(o,a)||H(g,t,[o,a]),!V(f)){const e=q(w,t),n=s(r,t)?f(l,t):void 0;e!=n&&H(p,t,n)}},I=e=>{l((()=>{Q(g,(([,e],t)=>H(L,t,e))),Q(p,((e,t)=>H(w,t,e)))}),g,p,L,w,e),j(g),j(p)};B(L,y),e.hasTable(r)&&v(e.getRowIds(r),(e=>{D(L,e)||y(e)})),I(!0),u(t),c(t,0,e.addRowListener(r,null,((e,t,n)=>y(n))),e.addTableListener(r,(()=>I())))},f,()=>B(i,f),c,u]},se=(e,s)=>t(e)==n?t=>t(e):null!=e?e:()=>null!=s?s:"",re=e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))},le=/^\d+$/,oe=()=>{const e=[];let t=0;return[()=>{var n;return null!=(n=R(e))?n:""+t++},t=>{le.test(t)&&g(e)<1e3&&y(e,t)}]},ae=e=>{let t;const[n,s]=oe(),r=N();return[(s,l,o,a=[],i=(()=>[]))=>{null!=t||(t=e());const d=n();return H(r,d,[s,l,o,a,i]),te(X(l,null!=o?o:[""],ee),d),d},(e,n,...s)=>v(((e,t=[""])=>{const n=[],s=(e,r)=>r==g(t)?y(n,e):null===t[r]?Q(e,(e=>s(e,r+1))):v([t[r],null],(t=>s(q(e,t),r+1)));return s(e,0),n})(e,n),(e=>Q(e,(e=>q(r,e)[0](t,...null!=n?n:[],...s))))),e=>E(q(r,e),(([,t,n])=>(X(t,null!=n?n:[""],void 0,(t=>(z(t,e),O(t)?1:0))),H(r,e),s(e),n))),e=>E(q(r,e),(([e,,n=[],s,r])=>{const l=(...o)=>{var a,i;const d=g(o);d==g(n)?e(t,...o,...r(o)):V(n[d])?v(null!=(i=null==(a=s[d])?void 0:a.call(s,...o))?i:[],(e=>l(...o,e))):l(...o,n[d])};l()}))]},ie=Object,de=ie.keys,ce=ie.isFrozen,ue=ie.freeze,ve=e=>C(e,ie)&&e.constructor==ie,he=(e,t)=>!V(((e,t)=>E(e,(e=>e[t])))(e,t)),fe=(e,t)=>delete e[t],ge=(e,t)=>h(ie.entries(e),(([e,n])=>t(n,e))),pe=e=>ve(e)&&p(de(e)),Le=re((e=>{let t,n,s,r=100,l=N(),o=N(),i=1;const d=N(),c=N(),[u,h,f]=ae((()=>U)),L=N(),w=N(),S=[],T=[],b=(t,n)=>{i=0,e.transaction((()=>{const[s,r]=q(L,n);Q(s,((n,s)=>Q(n,((n,r)=>Q(n,((n,l)=>Z(e,s,r,l,n[t]))))))),Q(r,((n,s)=>_(e,s,n[t])))})),i=1},m=e=>{H(L,e),H(w,e),h(c,[e])},x=(e,t)=>v(((e,t)=>e.splice(0,t))(e,null!=t?t:g(e)),m),C=()=>x(S,g(S)-r),P=()=>E(t,(()=>{y(S,t),C(),x(T),t=void 0,s=1})),k=()=>{t=I(S),s=1},J=e.addCellListener(null,null,null,((e,t,n,s,r,o)=>{if(i){P();const e=$(l,t,N),a=$(e,n,N),i=$(a,s,(()=>[o,void 0]));i[1]=r,i[0]===r&&O(H(a,s))&&O(H(e,n))&&O(H(l,t))&&k(),z()}})),M=e.addValueListener(null,((e,t,n,s)=>{if(i){P();const e=$(o,t,(()=>[s,void 0]));e[1]=n,e[0]===n&&O(H(o,t))&&k(),z()}})),A=(e="")=>(V(t)&&(t=""+n++,H(L,t,[l,o]),G(t,e),l=N(),o=N(),s=1),t),F=()=>{p(S)||(((e,...t)=>{e.unshift(...t)})(T,A()),b(0,t),t=I(S),s=1)},j=()=>{p(T)||(y(S,t),t=R(T),b(1,t),s=1)},z=()=>{s&&(h(d),s=0)},W=e=>{const t=A(e);return z(),t},G=(e,t)=>(K(e)&&q(w,e)!==t&&(H(w,e,t),h(c,[e])),U),K=e=>D(L,e),U={setSize:e=>(r=e,C(),U),addCheckpoint:W,setCheckpoint:G,getStore:()=>e,getCheckpointIds:()=>[[...S],t,[...T]],forEachCheckpoint:e=>B(w,e),hasCheckpoint:K,getCheckpoint:e=>q(w,e),goBackward:()=>(F(),z(),U),goForward:()=>(j(),z(),U),goTo:e=>{const n=a(S,e)?F:a(T,e)?j:null;for(;!V(n)&&e!=t;)n();return z(),U},addCheckpointIdsListener:e=>u(e,d),addCheckpointListener:(e,t)=>u(t,c,[e]),delListener:e=>(f(e),U),clear:()=>(x(S),x(T),V(t)||m(t),t=void 0,n=0,W(),U),destroy:()=>{e.delListener(J),e.delListener(M)},getListenerStats:()=>({})};return ue(U.clear())})),we=(e,t)=>e<t?-1:1,ye=re((e=>{const t=N(),n=N(),[s,r,l,a,i,d,v,,f,g,p]=ne(e,N,(e=>V(e)?"":J(e)?h(e,o):o(e))),[L,w,y]=ae((()=>R)),I=(t,n,s)=>{const r=i(t);Q(s,((t,s)=>n(s,(n=>Q(t,(t=>n(t,(n=>e.forEachCell(r,t,n)))))))))},R={setIndexDefinition:(e,s,r,l,o,a=we)=>{const i=V(o)?void 0:([e],[t])=>o(e,t);return f(e,s,((s,r,o,h,f,g)=>{let p=0;const L=ee(),y=ee(),I=d(e);if(Q(r,(([e,t],n)=>{const s=ee(e),r=ee(t);Q(s,(e=>z(r,e)?z(s,e):0)),Q(s,(e=>{te(L,e),E(q(I,e),(t=>{z(t,n),O(t)&&(H(I,e),p=1)}))})),Q(r,(e=>{te(L,e),D(I,e)||(H(I,e,ee()),p=1),te(q(I,e),n),V(l)||te(y,e)}))})),s(),O(f)||(g?B(I,(e=>te(y,e))):B(o,(e=>E(q(h,e),(e=>te(y,e))))),Q(y,(e=>{const t=(t,n)=>a(q(f,t),q(f,n),e),n=[...q(I,e)];c(n,t)||(H(I,e,ee(u(n,t))),te(L,e))}))),(p||g)&&!V(i)){const t=[...I];c(t,i)||(v(e,N(u(t,i))),p=1)}p&&w(t,[e]),Q(L,(t=>w(n,[e,t])))}),se(r),E(l,se)),R},delIndexDefinition:e=>(g(e),R),getStore:s,getIndexIds:r,forEachIndex:e=>l(((t,n)=>e(t,(e=>I(t,e,n))))),forEachSlice:(e,t)=>I(e,t,d(e)),hasIndex:a,hasSlice:(e,t)=>D(d(e),t),getTableId:i,getSliceIds:e=>W(d(e)),getSliceRowIds:(e,t)=>F(q(d(e),t)),addSliceIdsListener:(e,n)=>L(n,t,[e]),addSliceRowIdsListener:(e,t,s)=>L(s,n,[e,t]),delListener:e=>(y(e),R),destroy:p,getListenerStats:()=>({})};return ue(R)})),Ie=N([["avg",[(e,t)=>f(e)/t,(e,t,n)=>e+(t-e)/(n+1),(e,t,n)=>e+(e-t)/(n-1),(e,t,n,s)=>e+(t-n)/s]],["max",[e=>b(...e),(e,t)=>b(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:b(t,e)]],["min",[e=>m(...e),(e,t)=>m(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:m(t,e)]],["sum",[e=>f(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,n)=>e-n+t]]]),Re=(e,t,n,s,r,l=!1)=>{if(O(n))return;const[o,a,i,d]=r;return l||(l=V(e)),Q(s,(([n,s])=>{l||(e=V(n)?null==a?void 0:a(e,s,t++):V(s)?null==i?void 0:i(e,n,t--):null==d?void 0:d(e,s,n,t),l||(l=V(e)))})),l?o(F(n),A(n)):e},Se=re((e=>{const t=N(),[n,s,r,l,o,a,i,,d,c,u]=ne(e,M,(e=>isNaN(e)||V(e)||!0===e||!1===e||""===e?void 0:1*e)),[v,h,f]=ae((()=>g)),g={setMetricDefinition:(e,n,s,r,l,o,c)=>{var u;const v=k(s)?[s,l,o,c]:null!=(u=q(Ie,s))?u:q(Ie,"sum");return d(e,n,((n,s,r,l,o,d)=>{const c=a(e),u=A(l);d||(d=V(c)),n();let f=Re(c,u,l,s,v,d);x(f)||(f=void 0),f!=c&&(i(e,f),h(t,[e],f,c))}),se(r,1)),g},delMetricDefinition:e=>(c(e),g),getStore:n,getMetricIds:s,forEachMetric:r,hasMetric:l,getTableId:o,getMetric:a,addMetricListener:(e,n)=>v(n,t,[e]),delListener:e=>(f(e),g),destroy:u,getListenerStats:()=>({})};return ue(g)}));var Te=(e,t,n)=>new Promise(((s,r)=>{var l=e=>{try{a(n.next(e))}catch(e){r(e)}},o=e=>{try{a(n.throw(e))}catch(e){r(e)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(l,o);a((n=n.apply(e,t)).next())}));const be=(e,t,n,s,r)=>{let l,o,a=0;const i={load:(n,s)=>Te(void 0,null,(function*(){if(2!=a){a=1;const r=yield t();V(r)||""==r?e.transaction((()=>e.setTables(n).setValues(s))):e.setJson(r),a=0}return i})),startAutoLoad:(e,t)=>Te(void 0,null,(function*(){return i.stopAutoLoad(),yield i.load(e,t),s(i.load),i})),stopAutoLoad:()=>(r(),i),save:()=>Te(void 0,null,(function*(){return 1!=a&&(a=2,yield n(e.getJson()),a=0),i})),startAutoSave:()=>Te(void 0,null,(function*(){return yield i.stopAutoSave().save(),l=e.addTablesListener(i.save),o=e.addValuesListener(i.save),i})),stopAutoSave:()=>(E(l,e.delListener),E(o,e.delListener),i),getStore:()=>e,destroy:()=>i.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return ue(i)};var me=(e,t,n)=>new Promise(((s,r)=>{var l=e=>{try{a(n.next(e))}catch(e){r(e)}},o=e=>{try{a(n.throw(e))}catch(e){r(e)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(l,o);a((n=n.apply(e,t)).next())}));const xe=globalThis.window,Ce=(e,t,n)=>{let s;return be(e,(()=>me(void 0,null,(function*(){return n.getItem(t)}))),(e=>me(void 0,null,(function*(){return n.setItem(t,e)}))),(e=>{s=s=>{s.storageArea===n&&s.key===t&&e()},xe.addEventListener("storage",s)}),(()=>{xe.removeEventListener("storage",s),s=void 0}))};var Ve=(e,t,n)=>new Promise(((s,r)=>{var l=e=>{try{a(n.next(e))}catch(e){r(e)}},o=e=>{try{a(n.throw(e))}catch(e){r(e)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(l,o);a((n=n.apply(e,t)).next())})),Ee=(e,t,n)=>new Promise(((s,r)=>{var l=e=>{try{a(n.next(e))}catch(e){r(e)}},o=e=>{try{a(n.throw(e))}catch(e){r(e)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(l,o);a((n=n.apply(e,t)).next())}));const Pe=e=>e.headers.get("ETag");var ke=Object.getOwnPropertySymbols,Je=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;const Ae=re((e=>{const t=e.createStore,[n,s,r,l,o,,,a,,d,c,u,h]=ne(e,(()=>!0),M),f=t(),L=t(),I=N(),R=(e,t,...n)=>v(n,(n=>te($($(I,t,N),e,ee),n))),S=e=>{E(q(I,e),(e=>{B(e,((e,t)=>Q(t,(t=>e.delListener(t))))),j(e)})),v([L,f],(t=>t.delTable(e)))},T=(e,t,n)=>R(t,e,t.addWillFinishTransactionListener(n.startTransaction),t.addDidFinishTransactionListener((()=>n.finishTransaction()))),b={setQueryDefinition:(t,n,s)=>{a(t,n),S(t);const r=[],l=[[null,[n,null,null,[],N()]]],o=[],d=[],c=[];s({select:(e,t)=>{const n=k(e)?[g(r)+"",e]:[V(t)?e:t,n=>n(e,t)];return y(r,n),{as:e=>n[0]=e}},join:(e,t,n)=>{const s=V(n)||k(t)?null:t,r=V(s)?t:n,o=[e,[e,s,k(r)?r:e=>e(r),[],N()]];return y(l,o),{as:e=>o[0]=e}},where:(e,t,n)=>y(o,k(e)?e:V(n)?n=>n(e)===t:s=>s(e,t)===n),group:(e,t,n,s,r)=>{var l;const o=[e,[e,k(t)?[t,n,s,r]:null!=(l=q(Ie,t))?l:[(e,t)=>t]]];return y(d,o),{as:e=>o[0]=e}},having:(e,t)=>y(c,k(e)?e:n=>n(e)===t)});const w=N(r);if(O(w))return b;const I=N(l);B(I,((e,[,t])=>E(q(I,t),(({3:t})=>V(e)?0:y(t,e)))));const m=N(d);let x=f;if(O(m)&&p(c))x=L;else{T(t,x,L);const e=N();B(m,((t,[n,s])=>te($(e,n,ee),[t,s])));const n=ee();B(w,(t=>D(e,t)?0:te(n,t)));const s=N(),r=(n,s,r,l)=>E(n,(([o,a,d,u])=>{B(s,((t,[n])=>{const s=$(o,t,N),a=q(s,r),i=l?void 0:n;if(a!==i){const n=ee([[a,i]]),l=A(s);H(s,r,i),Q(q(e,t),(([e,t])=>{const r=Re(u[e],l,s,n,t);u[e]=V(Y(r))?null:r}))}})),O(a)||!i(c,(e=>e((e=>u[e]))))?L.delRow(t,d):V(d)?n[2]=L.addRow(t,u):L.setRow(t,d,u)}));R(x,t,x.addRowListener(t,null,((l,o,a,i)=>{const d=[],c=[],u=N(),v=x.hasRow(t,a);let h=!v;Q(n,(e=>{const[n,s,r]=i(t,a,e);y(d,s),y(c,r),h||(h=n)})),B(e,(e=>{const[n,,s]=i(t,a,e);(h||n)&&H(u,e,[s])})),h&&r(X(s,d,void 0,(([,e])=>(z(e,a),O(e)))),u,a,1),v&&r(X(s,c,(()=>{const e={};return Q(n,(n=>e[n]=x.getCell(t,a,n))),[N(),ee(),void 0,e]}),(([,e])=>{te(e,a)})),u,a)})))}T(t,e,x);const C=(s,r,l,a)=>{const d=t=>e.getCell(r,l,t);v(a,(n=>{var r;const[l,,o,a,i]=q(I,n),c=null==o?void 0:o(d,s),[v,f]=null!=(r=q(i,s))?r:[];c!=v&&(V(f)||h(t,f),H(i,s,V(c)?null:[c,...u(t,1,e.addRowListener(l,c,(()=>C(s,l,c,a))))]))})),(s=>{const r=(t,r)=>{var l,o,a;return e.getCell(...V(r)?[n,s,t]:t===n?[n,s,r]:[null==(l=q(I,t))?void 0:l[0],null==(a=q(null==(o=q(I,t))?void 0:o[4],s))?void 0:a[0],r])};x.transaction((()=>i(o,(e=>e(r)))?B(w,((e,n)=>Z(x,t,s,e,n(r,s)))):x.delRow(t,s)))})(s)},{3:P}=q(I,null);return x.transaction((()=>u(t,1,e.addRowListener(n,null,((s,r,l)=>{e.hasRow(n,l)?C(l,n,l,P):(x.delRow(t,l),Q(I,(({4:e})=>E(q(e,l),(([,n])=>{h(t,n),H(e,l)})))))}))))),b},delQueryDefinition:e=>(S(e),d(e),b),getStore:n,getQueryIds:s,forEachQuery:r,hasQuery:l,getTableId:o,delListener:e=>(L.delListener(e),b),destroy:c,getListenerStats:()=>((e,t)=>{var n={};for(var s in e)Je.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&ke)for(var s of ke(e))t.indexOf(s)<0&&Me.call(e,s)&&(n[s]=e[s]);return n})(L.getListenerStats(),["tables","tableIds","transaction"])};return ge({Table:[1,1],RowIds:[0,1],SortedRowIds:[0,5],Row:[1,2],CellIds:[0,2],Cell:[1,3]},(([e,t],n)=>{v(e?["get","has","forEach"]:["get"],(e=>b[e+"Result"+n]=(...t)=>L[e+n](...t))),b["addResult"+n+"Listener"]=(...e)=>L["add"+n+"Listener"](...w(e,0,t),((n,...s)=>e[t](b,...s)))})),ue(b)})),De=re((e=>{const t=N(),n=N(),s=N(),r=N(),[l,o,a,i,d,c,,,u,v,h]=ne(e,(()=>[N(),N(),N(),N()]),(e=>V(e)?void 0:e+"")),[f,g,p]=ae((()=>I)),L=(e,t,n)=>E(c(e),(([s,,r])=>{if(!D(r,t)){const l=ee();if(d(e)!=y(e))te(l,t);else{let e=t;for(;!V(e)&&!D(l,e);)te(l,e),e=q(s,e)}if(n)return l;H(r,t,l)}return q(r,t)})),w=(e,t)=>E(c(e),(([,,e])=>H(e,t))),y=e=>q(t,e),I={setRelationshipDefinition:(e,l,o,a)=>(H(t,e,o),u(e,l,((t,l)=>{const o=ee(),a=ee(),i=ee(),[d,u]=c(e);Q(l,(([t,n],s)=>{V(t)||(te(a,t),E(q(u,t),(e=>{z(e,s),O(e)&&H(u,t)}))),V(n)||(te(a,n),D(u,n)||H(u,n,ee()),te(q(u,n),s)),te(o,s),H(d,s,n),B(q(r,e),(t=>{D(L(e,t),s)&&te(i,t)}))})),t(),Q(o,(t=>g(n,[e,t]))),Q(a,(t=>g(s,[e,t]))),Q(i,(t=>{w(e,t),g(r,[e,t])}))}),se(a)),I),delRelationshipDefinition:e=>(H(t,e),v(e),I),getStore:l,getRelationshipIds:o,forEachRelationship:t=>a((n=>t(n,(t=>e.forEachRow(d(n),t))))),hasRelationship:i,getLocalTableId:d,getRemoteTableId:y,getRemoteRowId:(e,t)=>{var n;return q(null==(n=c(e))?void 0:n[0],t)},getLocalRowIds:(e,t)=>{var n;return F(q(null==(n=c(e))?void 0:n[1],t))},getLinkedRowIds:(e,t)=>V(c(e))?[t]:F(L(e,t,!0)),addRemoteRowIdListener:(e,t,s)=>f(s,n,[e,t]),addLocalRowIdsListener:(e,t,n)=>f(n,s,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(L(e,t),f(n,r,[e,t])),delListener:e=>(w(...p(e)),I),destroy:h,getListenerStats:()=>({})};return ue(I)})),Oe=e=>[e,e],Fe=()=>[N(),N()],je=(e,t,n,s=H)=>{const r=(l=e=>!he(t,e),W(e).filter(l));var l;return v(de(t),(s=>n(e,s,t[s]))),v(r,(t=>s(e,t))),e},Qe=(e,t,n)=>V(e)||!ve(e)||pe(e)||ce(e)?(null==n||n(),!1):(ge(e,((n,s)=>{t(n,s)||fe(e,s)})),!pe(e)),ze=(e,t,n)=>H(e,t,q(e,t)==-n?void 0:n),Ne=()=>{let e,t,n,s,l=0;const i=N(),c=N(),f=N(),g=N(),p=N(),L=N(),I=N(),R=N(),b=N(),m=N(),x=N(),C=N(),J=ee(),M=N(),A=N(),F=N(),X=Fe(),ne=Fe(),se=Fe(),re=Fe(),le=Fe(),ie=Fe(),de=Fe(),ce=Fe(),ve=Fe(),Le=Fe(),ye=Fe(),Ie=Fe(),Re=Fe(),Se=Fe(),[Te,be,me,xe]=ae((()=>Nt)),Ce=e=>{if(!Qe(e,((e,t)=>a(["type","default"],t))))return!1;const t=e.type;return!(!P(t)&&t!=r||(Y(e.default)!=t&&fe(e,"default"),0))},Ve=(t,n)=>(!e||D(b,n)||ct(n))&&Qe(t,((e,t)=>Ee(n,t,e)),(()=>ct(n))),Ee=(e,t,n,s)=>Qe(s?n:Me(n,e,t),((s,r)=>E(Pe(e,t,r,s),(e=>(n[r]=e,!0)),(()=>!1))),(()=>ct(e,t))),Pe=(t,n,s,r)=>e?E(q(q(b,t),s),(e=>Y(r)!=e.type?ct(t,n,s,r,e.default):r),(()=>ct(t,n,s,r))):V(Y(r))?ct(t,n,s,r):r,ke=(e,t)=>Qe(t?e:Ae(e),((t,n)=>E(Je(n,t),(t=>(e[n]=t,!0)),(()=>!1))),(()=>ut())),Je=(e,n)=>t?E(q(x,e),(t=>Y(n)!=t.type?ut(e,n,t.default):n),(()=>ut(e,n))):V(Y(n))?ut(e,n):n,Me=(e,t,n)=>(E(q(m,t),(([s,r])=>{Q(s,((t,n)=>{he(e,n)||(e[n]=t)})),Q(r,(s=>{he(e,s)||ct(t,n,s)}))})),e),Ae=e=>(t&&(Q(C,((t,n)=>{he(e,n)||(e[n]=t)})),Q(J,(t=>{he(e,t)||ut(t)}))),e),De=e=>je(b,e,((e,t,n)=>{const s=N(),r=ee();je($(b,t,N),n,((e,t,n)=>{H(e,t,n),E(n.default,(e=>H(s,t,e)),(()=>te(r,t)))})),H(m,t,[s,r])}),((e,t)=>{H(b,t),H(m,t)})),We=e=>je(x,e,((e,t,n)=>{H(x,t,n),E(n.default,(e=>H(C,t,e)),(()=>te(J,t)))}),((e,t)=>{H(x,t),H(C,t),z(J,t)})),qe=e=>pe(e)?At():Et(e),Be=e=>je(A,e,((e,t,n)=>He(t,n)),((e,t)=>et(t))),He=(e,t)=>je($(A,e,(()=>(rt(e,1),N()))),t,((t,n,s)=>$e(e,t,n,s)),((t,n)=>tt(e,t,n))),$e=(e,t,n,s,r)=>je($(t,n,(()=>(lt(e,n,1),N()))),s,((t,s,r)=>Ge(e,n,t,s,r)),((s,l)=>nt(e,t,n,s,l,r))),Ge=(e,t,n,s,r)=>{D(n,s)||ot(e,t,s,1);const l=q(n,s);r!==l&&(at(e,t,s,l,r),H(n,s,r))},Ke=(e,t,n,s,r)=>E(q(t,n),(t=>Ge(e,n,t,s,r)),(()=>$e(e,t,n,Me({[s]:r},e,n)))),Ue=e=>pe(e)?Dt():Pt(e),Xe=e=>je(F,e,((e,t,n)=>Ye(t,n)),((e,t)=>st(t))),Ye=(e,t)=>{D(F,e)||it(e,1);const n=q(F,e);t!==n&&(dt(e,n,t),H(F,e,t))},Ze=e=>{const[t]=$(M,e,oe),n=t();return D(q(A,e),n)?Ze(e):n},_e=e=>{var t;return null!=(t=q(A,e))?t:He(e,{})},et=e=>He(e,{}),tt=(e,t,n)=>{const[,s]=$(M,e,oe);s(n),$e(e,t,n,{},!0)},nt=(e,t,n,s,r,l)=>{var o;const a=q(null==(o=q(m,e))?void 0:o[0],r);if(!V(a)&&!l)return Ge(e,n,s,r,a);const i=t=>{at(e,n,t,q(s,t)),ot(e,n,t,-1),H(s,t)};V(a)?i(r):B(s,i),O(s)&&(lt(e,n,-1),O(H(t,n))&&(rt(e,-1),H(A,e),H(M,e)))},st=e=>{const t=q(C,e);if(!V(t))return Ye(e,t);dt(e,q(F,e)),it(e,-1),H(F,e)},rt=(e,t)=>ze(i,e,t),lt=(e,t,n)=>ze($(c,e,N),t,n),ot=(e,t,n,s)=>ze($($(f,e,N),t,N),n,s),at=(e,t,n,s,r)=>$($($(g,e,N),t,N),n,(()=>[s,0]))[1]=r,it=(e,t)=>ze(p,e,t),dt=(e,t,n)=>$(L,e,(()=>[t,0]))[1]=n,ct=(e,t,n,s,r)=>(y($($($(I,e,N),t,N),n,(()=>[])),s),r),ut=(e,t,n)=>(y($(R,e,(()=>[])),t),n),vt=(e,t,n)=>E(q(q(q(g,e),t),n),(([e,t])=>[!0,e,t]),(()=>[!1,...Oe(mt(e,t,n))])),ht=e=>E(q(L,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Oe(Vt(e))])),ft=e=>O(I)||O(ve[e])?0:Q(e?K(I,U):I,((t,n)=>Q(t,((t,s)=>Q(t,((t,r)=>be(ve[e],[n,s,r],t))))))),gt=e=>O(R)||O(Le[e])?0:Q(e?K(R):R,((t,n)=>be(Le[e],[n],t))),pt=(e,t,n)=>{if(!O(t))return be(e,n),1},Lt=e=>{const t=O(le[e]),n=O(de[e])&&O(re[e])&&t&&O(ne[e]),s=O(ce[e])&&O(ie[e])&&O(se[e])&&O(X[e]);if(!n||!s){const r=e?[K(i),U(c),K(f,U),K(g,U)]:[i,c,f,g];if(!n){Q(r[2],((t,n)=>Q(t,((t,s)=>pt(de[e],t,[n,s])))));const n=ee();Q(r[1],((s,r)=>{pt(re[e],s,[r])&&!t&&(be(le[e],[r,null]),te(n,r))})),t||Q(r[3],((t,s)=>{if(!D(n,s)){const n=ee();Q(t,(e=>Q(e,(([t,s],r)=>s!==t?te(n,r):z(e,r))))),Q(n,(t=>be(le[e],[s,t])))}})),pt(ne[e],r[0])}if(!s){let t;Q(r[3],((n,s)=>{let r;Q(n,((n,l)=>{let o;Q(n,(([n,a],i)=>{a!==n&&(be(ce[e],[s,l,i],a,n,vt),t=r=o=1)})),o&&be(ie[e],[s,l],vt)})),r&&be(se[e],[s],vt)})),t&&be(X[e],void 0,vt)}}},wt=e=>{const t=O(Ie[e]),n=O(Re[e])&&O(ye[e]);if(!t||!n){const s=e?[K(p),K(L)]:[p,L];if(t||pt(Ie[e],s[0]),!n){let t;Q(s[1],(([n,s],r)=>{s!==n&&(be(Re[e],[r],s,n,ht),t=1)})),t&&be(ye[e],void 0,ht)}}},yt=(e,...t)=>(jt((()=>e(...h(t,o)))),Nt),It=()=>G(A,(e=>G(e,G))),Rt=()=>W(A),St=e=>W(q(A,o(e))),Tt=(e,t,n,s=0,r)=>{return h(w(u((l=q(A,o(e)),a=(e,n)=>[V(t)?n:q(e,o(t)),n],h([...null!=(i=null==l?void 0:l.entries())?i:[]],(([e,t])=>a(t,e)))),(([e],[t])=>we(e,t)*(n?-1:1))),s,V(r)?r:s+r),(([,e])=>e));var l,a,i},bt=(e,t)=>W(q(q(A,o(e)),o(t))),mt=(e,t,n)=>q(q(q(A,o(e)),o(t)),o(n)),xt=()=>G(F),Ct=()=>W(F),Vt=e=>q(F,o(e)),Et=e=>yt((()=>(e=>Qe(e,Ve,ct))(e)?Be(e):0)),Pt=e=>yt((()=>ke(e)?Xe(e):0)),kt=e=>{try{qe(T(e))}catch(e){}return Nt},Jt=t=>yt((()=>{if((e=Qe(t,(e=>Qe(e,Ce))))&&(De(t),!O(A))){const e=It();At(),Et(e)}})),Mt=e=>yt((()=>{if(t=(e=>Qe(e,Ce))(e)){const n=xt();Ft(),Dt(),t=!0,We(e),Pt(n)}})),At=()=>yt((()=>Be({}))),Dt=()=>yt((()=>Xe({}))),Ot=()=>yt((()=>{De({}),e=!1})),Ft=()=>yt((()=>{We({}),t=!1})),jt=(e,t)=>{if(-1==l)return;Qt();const n=e();return zt(t),n},Qt=()=>(l++,Nt),zt=e=>(l>0&&(l--,0==l&&(n=!O(g),s=!O(L),l=1,ft(1),n&&Lt(1),gt(1),s&&wt(1),l=-1,(null==e?void 0:e(G(g,(e=>G(e,(e=>G(e,(e=>[...e]),(([e,t])=>e===t))),pe)),pe),G(I,(e=>G(e,G))),G(L,(e=>[...e]),(([e,t])=>e===t)),G(R)))&&(l=1,Q(g,((e,t)=>Q(e,((e,n)=>Q(e,(([e],s)=>Z(Nt,t,n,s,e))))))),Q(L,(([e],t)=>_(Nt,t,e))),l=-1,n=s=!1),be(Se[0],void 0,n,s),ft(0),n&&Lt(0),gt(0),s&&wt(0),be(Se[1],void 0,n,s),l=0,v([i,c,f,g,I,p,L,R],j))),Nt),Nt={getTables:It,getTableIds:Rt,getTable:e=>G(q(A,o(e)),G),getRowIds:St,getSortedRowIds:Tt,getRow:(e,t)=>G(q(q(A,o(e)),o(t))),getCellIds:bt,getCell:mt,getValues:xt,getValueIds:Ct,getValue:Vt,hasTables:()=>!O(A),hasTable:e=>D(A,o(e)),hasRow:(e,t)=>D(q(A,o(e)),o(t)),hasCell:(e,t,n)=>D(q(q(A,o(e)),o(t)),o(n)),hasValues:()=>!O(F),hasValue:e=>D(F,o(e)),getTablesJson:()=>S(A),getValuesJson:()=>S(F),getJson:()=>S([A,F]),getTablesSchemaJson:()=>S(b),getValuesSchemaJson:()=>S(x),getSchemaJson:()=>S([b,x]),setTables:Et,setTable:(e,t)=>yt((e=>Ve(t,e)?He(e,t):0),e),setRow:(e,t,n)=>yt(((e,t)=>Ee(e,t,n)?$e(e,_e(e),t,n):0),e,t),addRow:(e,t)=>jt((()=>{let n;return Ee(e,n,t)&&(e=o(e),$e(e,_e(e),n=Ze(e),t)),n})),setPartialRow:(e,t,n)=>yt(((e,t)=>{if(Ee(e,t,n,1)){const s=_e(e);ge(n,((n,r)=>Ke(e,s,t,r,n)))}}),e,t),setCell:(e,t,n,s)=>yt(((e,t,n)=>E(Pe(e,t,n,k(s)?s(mt(e,t,n)):s),(s=>Ke(e,_e(e),t,n,s)))),e,t,n),setValues:Pt,setPartialValues:e=>yt((()=>ke(e,1)?ge(e,((e,t)=>Ye(t,e))):0)),setValue:(e,t)=>yt((e=>E(Je(e,k(t)?t(Vt(e)):t),(t=>Ye(e,t)))),e),setTablesJson:kt,setValuesJson:e=>{try{Ue(T(e))}catch(e){}return Nt},setJson:e=>{try{const[t,n]=T(e);qe(t),Ue(n)}catch(t){kt(e)}return Nt},setTablesSchema:Jt,setValuesSchema:Mt,setSchema:(e,t)=>yt((()=>{Jt(e),Mt(t)})),delTables:At,delTable:e=>yt((e=>D(A,e)?et(e):0),e),delRow:(e,t)=>yt(((e,t)=>E(q(A,e),(n=>D(n,t)?tt(e,n,t):0))),e,t),delCell:(e,t,n,s)=>yt(((e,t,n)=>E(q(A,e),(r=>E(q(r,t),(l=>D(l,n)?nt(e,r,t,l,n,s):0))))),e,t,n),delValues:Dt,delValue:e=>yt((e=>D(F,e)?st(e):0),e),delTablesSchema:Ot,delValuesSchema:Ft,delSchema:()=>yt((()=>{Ot(),Ft()})),transaction:jt,startTransaction:Qt,finishTransaction:zt,forEachTable:e=>Q(A,((t,n)=>e(n,(e=>Q(t,((t,n)=>e(n,(e=>B(t,e))))))))),forEachRow:(e,t)=>Q(q(A,o(e)),((e,n)=>t(n,(t=>B(e,t))))),forEachCell:(e,t,n)=>B(q(q(A,o(e)),o(t)),n),forEachValue:e=>B(F,e),addSortedRowIdsListener:(e,t,n,s,r,l,o)=>{let a=Tt(e,t,n,s,r);return Te((()=>{const o=Tt(e,t,n,s,r);d(o,a)||(a=o,l(Nt,e,t,n,s,r,a))}),le[o?1:0],[e,t],[Rt])},addWillFinishTransactionListener:e=>Te(e,Se[0]),addDidFinishTransactionListener:e=>Te(e,Se[1]),callListener:e=>(xe(e),Nt),delListener:e=>(me(e),Nt),getListenerStats:()=>({}),createStore:Ne};return ge({Tables:[0,X],TableIds:[0,ne],Table:[1,se,[Rt]],RowIds:[1,re,[Rt]],Row:[2,ie,[Rt,St]],CellIds:[2,de,[Rt,St]],Cell:[3,ce,[Rt,St,bt],e=>Oe(mt(...e))],InvalidCell:[3,ve],Values:[0,ye],ValueIds:[0,Ie],Value:[1,Re,[Ct],e=>Oe(Vt(e[0]))],InvalidValue:[1,Le]},(([e,t,n,s],r)=>{Nt["add"+r+"Listener"]=(...r)=>Te(r[e],t[r[e+1]?1:0],e>0?w(r,0,e):void 0,n,s)})),ue(Nt)};exports.createCheckpoints=Le,exports.createCustomPersister=be,exports.createFilePersister=(t,n)=>{let s;return be(t,(()=>Ve(void 0,null,(function*(){try{return yield e.promises.readFile(n,"utf8")}catch(e){}}))),(t=>Ve(void 0,null,(function*(){try{yield e.promises.writeFile(n,t,"utf8")}catch(e){}}))),(t=>{s=e.watch(n,t)}),(()=>{null==s||s.close(),s=void 0}))},exports.createIndexes=ye,exports.createLocalPersister=(e,t)=>Ce(e,t,localStorage),exports.createMetrics=Se,exports.createQueries=Ae,exports.createRelationships=De,exports.createRemotePersister=(e,t,n,s)=>{let r,l;return be(e,(()=>Ee(void 0,null,(function*(){const e=yield fetch(t);return l=Pe(e),e.text()}))),(e=>Ee(void 0,null,(function*(){return yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:e})}))),(e=>{r=setInterval((()=>Ee(void 0,null,(function*(){const n=yield fetch(t,{method:"HEAD"}),s=Pe(n);V(l)||V(s)||s==l||(l=s,e())}))),1e3*s)}),(()=>{E(r,clearInterval),r=void 0}))},exports.createSessionPersister=(e,t)=>Ce(e,t,sessionStorage),exports.createStore=Ne,exports.defaultSorter=we;
