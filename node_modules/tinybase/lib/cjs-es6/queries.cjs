"use strict";const e=e=>typeof e,t=e(""),n=e(!0),l=e(0),r=e(e),o=(e,t)=>e.every(t),s=(e,t)=>e.forEach(t),i=e=>u(e,((e,t)=>e+t),0),a=e=>e.length,d=e=>0==a(e),u=(e,t,n)=>e.reduce(t,n),c=(e,...t)=>e.push(...t),v=Math.max,h=Math.min,w=isFinite,f=e=>null==e,g=(e,t,n)=>f(e)?null==n?void 0:n():t(e),R=t=>e(t)==r,y=e=>Array.isArray(e),L=()=>{},p=e=>e.size,b=(e,t)=>{var n;return null!=(n=null==e?void 0:e.has(t))&&n},T=e=>f(e)||0==p(e),m=e=>{var t;return[...null!=(t=null==e?void 0:e.values())?t:[]]},C=e=>e.clear(),I=(e,t)=>null==e?void 0:e.forEach(t),O=(e,t)=>null==e?void 0:e.delete(t),S=e=>new Map(e),Q=(e,t)=>null==e?void 0:e.get(t),j=(e,t)=>I(e,((e,n)=>t(n,e))),x=(e,t,n)=>f(n)?(O(e,t),e):null==e?void 0:e.set(t,n),E=(e,t,n)=>(b(e,t)||x(e,t,n()),Q(e,t)),M=(e,t,n,l,r=0)=>g((n?E:Q)(e,t[r],r>a(t)-2?n:S),(o=>{if(r>a(t)-2)return(null==l?void 0:l(o))&&x(e,t[r]),o;const s=M(o,t,n,l,r+1);return T(o)&&x(e,t[r]),s})),D=e=>new Set(y(e)||f(e)?e:[e]),F=(e,t)=>null==e?void 0:e.add(t),k=S([["avg",[(e,t)=>i(e)/t,(e,t,n)=>e+(t-e)/(n+1),(e,t,n)=>e+(e-t)/(n-1),(e,t,n,l)=>e+(t-n)/l]],["max",[e=>v(...e),(e,t)=>v(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:v(t,e)]],["min",[e=>h(...e),(e,t)=>h(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:h(t,e)]],["sum",[e=>i(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,n)=>e-n+t]]]),z=Object,A=z.freeze;var P=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;const B=(r=>{const i=new WeakMap;return r=>(i.has(r)||i.set(r,(r=>{const i=r.createStore,[u,v,h,B,G,,,H,,J,K,N,U]=((e,t,n)=>{const l=e.hasRow,r=S(),i=S(),u=S(),c=S(),v=S(),h=(t,n,...l)=>{const r=E(v,t,D);return s(l,(t=>F(r,t)&&n&&e.callListener(t))),l},w=(t,...n)=>g(Q(v,t),(l=>{s(d(n)?m(l):n,(t=>{e.delListener(t),O(l,t)})),T(l)&&x(v,t)})),R=(e,t)=>{x(r,e,t),b(i,e)||(x(i,e,!0),x(u,e,S()),x(c,e,S()))},L=e=>{x(r,e),x(i,e),x(u,e),x(c,e),w(e)};return[()=>e,()=>{return[...null!=(t=null==(e=r)?void 0:e.keys())?t:[]];var e,t},e=>j(i,e),e=>b(i,e),e=>Q(r,e),e=>Q(i,e),(e,t)=>x(i,e,t),R,(t,r,i,d,v)=>{R(t,r);const g=S(),L=S(),p=Q(u,t),T=Q(c,t),m=t=>{const s=n=>e.getCell(r,t,n),i=Q(p,t),u=l(r,t)?n(d(s,t)):void 0;var c,h;if(i===u||y(i)&&y(u)&&(h=u,a(c=i)===a(h)&&o(c,((e,t)=>h[t]===e)))||x(g,t,[i,u]),!f(v)){const e=Q(T,t),n=l(r,t)?v(s,t):void 0;e!=n&&x(L,t,n)}},O=e=>{i((()=>{I(g,(([,e],t)=>x(p,t,e))),I(L,((e,t)=>x(T,t,e)))}),g,L,p,T,e),C(g),C(L)};j(p,m),e.hasTable(r)&&s(e.getRowIds(r),(e=>{b(p,e)||m(e)})),O(!0),w(t),h(t,0,e.addRowListener(r,null,((e,t,n)=>m(n))),e.addTableListener(r,(()=>O())))},L,()=>j(v,L),h,w]})(r,0,L),V=i(),X=i(),Y=S(),Z=(e,t,...n)=>s(n,(n=>F(E(E(Y,t,S),e,D),n))),$=e=>{g(Q(Y,e),(e=>{j(e,((e,t)=>I(t,(t=>e.delListener(t))))),C(e)})),s([X,V],(t=>t.delTable(e)))},_=(e,t,n)=>Z(t,e,t.addWillFinishTransactionListener(n.startTransaction),t.addDidFinishTransactionListener((()=>n.finishTransaction()))),ee={setQueryDefinition:(i,u,v)=>{H(i,u),$(i);const h=[],y=[[null,[u,null,null,[],S()]]],L=[],C=[],z=[];v({select:(e,t)=>{const n=R(e)?[a(h)+"",e]:[f(t)?e:t,n=>n(e,t)];return c(h,n),{as:e=>n[0]=e}},join:(e,t,n)=>{const l=f(n)||R(t)?null:t,r=f(l)?t:n,o=[e,[e,l,R(r)?r:e=>e(r),[],S()]];return c(y,o),{as:e=>o[0]=e}},where:(e,t,n)=>c(L,R(e)?e:f(n)?n=>n(e)===t:l=>l(e,t)===n),group:(e,t,n,l,r)=>{var o;const s=[e,[e,R(t)?[t,n,l,r]:null!=(o=Q(k,t))?o:[(e,t)=>t]]];return c(C,s),{as:e=>s[0]=e}},having:(e,t)=>c(z,R(e)?e:n=>n(e)===t)});const A=S(h);if(T(A))return ee;const P=S(y);j(P,((e,[,t])=>g(Q(P,t),(({3:t})=>f(e)?0:c(t,e)))));const W=S(C);let q=V;if(T(W)&&d(z))q=X;else{_(i,q,X);const r=S();j(W,((e,[t,n])=>F(E(r,t,D),[e,n])));const s=D();j(A,(e=>b(r,e)?0:F(s,e)));const a=S(),d=(s,a,d,u)=>g(s,(([c,v,h,g])=>{j(a,((o,[s])=>{const i=E(c,o,S),a=Q(i,d),v=u?void 0:s;if(a!==v){const s=D([[a,v]]),u=p(i);x(i,d,v),I(Q(r,o),(([r,o])=>{const a=((e,t,n,l,r,o=!1)=>{if(T(n))return;const[s,i,a,d]=r;return o||(o=f(e)),I(l,(([n,l])=>{o||(e=f(n)?null==i?void 0:i(e,l,t++):f(l)?null==a?void 0:a(e,n,t--):null==d?void 0:d(e,l,n,t),o||(o=f(e)))})),o?s(m(n),p(n)):e})(g[r],u,i,s,o);g[r]=f((r=>{const o=e(r);return(e=>e==t||e==n)(o)||o==l&&w(r)?o:void 0})(a))?null:a}))}})),T(v)||!o(z,(e=>e((e=>g[e]))))?X.delRow(i,h):f(h)?s[2]=X.addRow(i,g):X.setRow(i,h,g)}));Z(q,i,q.addRowListener(i,null,((e,t,n,l)=>{const o=[],u=[],v=S(),h=q.hasRow(i,n);let w=!h;I(s,(e=>{const[t,r,s]=l(i,n,e);c(o,r),c(u,s),w||(w=t)})),j(r,(e=>{const[t,,r]=l(i,n,e);(w||t)&&x(v,e,[r])})),w&&d(M(a,o,void 0,(([,e])=>(O(e,n),T(e)))),v,n,1),h&&d(M(a,u,(()=>{const e={};return I(s,(t=>e[t]=q.getCell(i,n,t))),[S(),D(),void 0,e]}),(([,e])=>{F(e,n)})),v,n)})))}_(i,r,q);const B=(e,t,n,l)=>{const a=e=>r.getCell(t,n,e);s(l,(t=>{var n;const[l,,o,s,d]=Q(P,t),u=null==o?void 0:o(a,e),[c,v]=null!=(n=Q(d,e))?n:[];u!=c&&(f(v)||U(i,v),x(d,e,f(u)?null:[u,...N(i,1,r.addRowListener(l,u,(()=>B(e,l,u,s))))]))})),(e=>{const t=(t,n)=>{var l,o,s;return r.getCell(...f(n)?[u,e,t]:t===u?[u,e,n]:[null==(l=Q(P,t))?void 0:l[0],null==(s=Q(null==(o=Q(P,t))?void 0:o[4],e))?void 0:s[0],n])};q.transaction((()=>o(L,(e=>e(t)))?j(A,((n,l)=>((e,t,n,l,r)=>f(r)?e.delCell(t,n,l,!0):e.setCell(t,n,l,r))(q,i,e,n,l(t,e)))):q.delRow(i,e)))})(e)},{3:G}=Q(P,null);return q.transaction((()=>N(i,1,r.addRowListener(u,null,((e,t,n)=>{r.hasRow(u,n)?B(n,u,n,G):(q.delRow(i,n),I(P,(({4:e})=>g(Q(e,n),(([,t])=>{U(i,t),x(e,n)})))))}))))),ee},delQueryDefinition:e=>($(e),J(e),ee),getStore:u,getQueryIds:v,forEachQuery:h,hasQuery:B,getTableId:G,delListener:e=>(X.delListener(e),ee),destroy:K,getListenerStats:()=>((e,t)=>{var n={};for(var l in e)W.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&P)for(var l of P(e))t.indexOf(l)<0&&q.call(e,l)&&(n[l]=e[l]);return n})(X.getListenerStats(),["tables","tableIds","transaction"])};var te,ne;return te={Table:[1,1],RowIds:[0,1],SortedRowIds:[0,5],Row:[1,2],CellIds:[0,2],Cell:[1,3]},ne=([e,t],n)=>{s(e?["get","has","forEach"]:["get"],(e=>ee[e+"Result"+n]=(...t)=>X[e+n](...t))),ee["addResult"+n+"Listener"]=(...e)=>{return X["add"+n+"Listener"](...(l=e,0,r=t,l.slice(0,r)),((n,...l)=>e[t](ee,...l)));var l,r}},((e,t)=>{e.map(t)})(z.entries(te),(([e,t])=>ne(t,e))),A(ee)})(r)),i.get(r))})();exports.createQueries=B;
