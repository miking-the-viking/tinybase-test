"use strict";const e=e=>typeof e,n=e(""),t=e=>""+e,l=(e,n)=>e.every(n),r=(e,n)=>l(e,((t,l)=>0==l||n(e[l-1],t)<=0)),s=(e,n)=>e.sort(n),o=(e,n)=>e.forEach(n),u=e=>e.length,d=(e,...n)=>e.push(...n),i=e=>null==e,a=(e,n,t)=>i(e)?null==t?void 0:t():n(e),c=e=>Array.isArray(e),v=(e,n)=>{var t;return null!=(t=null==e?void 0:e.has(n))&&t},h=e=>i(e)||0==(e=>e.size)(e),f=e=>{var n;return[...null!=(n=null==e?void 0:e.values())?n:[]]},I=e=>e.clear(),g=(e,n)=>null==e?void 0:e.forEach(n),S=(e,n)=>null==e?void 0:e.delete(n),w=e=>new Map(e),L=e=>{var n;return[...null!=(n=null==e?void 0:e.keys())?n:[]]},x=(e,n)=>null==e?void 0:e.get(n),p=(e,n)=>g(e,((e,t)=>n(t,e))),y=(e,n,t)=>i(t)?(S(e,n),e):null==e?void 0:e.set(n,t),E=(e,n,t)=>(v(e,n)||y(e,n,t()),x(e,n)),R=(e,n,t,l,r=0)=>a((t?E:x)(e,n[r],r>u(n)-2?t:w),(s=>{if(r>u(n)-2)return(null==l?void 0:l(s))&&y(e,n[r]),s;const o=R(s,n,t,l,r+1);return h(s)&&y(e,n[r]),o})),b=e=>new Set(c(e)||i(e)?e:[e]),T=(e,n)=>null==e?void 0:e.add(n),k=(t,l)=>e(t)==n?e=>e(t):null!=t?t:()=>null!=l?l:"",z=(e,n)=>e<n?-1:1,A=/^\d+$/,C=Object.freeze,D=(e=>{const n=new WeakMap;return e=>(n.has(e)||n.set(e,(e=>{const n=w(),D=w(),[M,j,m,O,W,$,q,,B,F,G]=((e,n,t)=>{const r=e.hasRow,s=w(),d=w(),R=w(),k=w(),z=w(),A=(n,t,...l)=>{const r=E(z,n,b);return o(l,(n=>T(r,n)&&t&&e.callListener(n))),l},C=(n,...t)=>a(x(z,n),(l=>{o(0==u(t)?f(l):t,(n=>{e.delListener(n),S(l,n)})),h(l)&&y(z,n)})),D=(e,t)=>{y(s,e,t),v(d,e)||(y(d,e,n()),y(R,e,w()),y(k,e,w()))},M=e=>{y(s,e),y(d,e),y(R,e),y(k,e),C(e)};return[()=>e,()=>L(s),e=>p(d,e),e=>v(d,e),e=>x(s,e),e=>x(d,e),(e,n)=>y(d,e,n),D,(n,s,d,a,h)=>{D(n,s);const f=w(),S=w(),L=x(R,n),E=x(k,n),b=n=>{const o=t=>e.getCell(s,n,t),d=x(L,n),v=r(s,n)?t(a(o,n)):void 0;var I,g;if(d===v||c(d)&&c(v)&&(g=v,u(I=d)===u(g)&&l(I,((e,n)=>g[n]===e)))||y(f,n,[d,v]),!i(h)){const e=x(E,n),t=r(s,n)?h(o,n):void 0;e!=t&&y(S,n,t)}},T=e=>{d((()=>{g(f,(([,e],n)=>y(L,n,e))),g(S,((e,n)=>y(E,n,e)))}),f,S,L,E,e),I(f),I(S)};p(L,b),e.hasTable(s)&&o(e.getRowIds(s),(e=>{v(L,e)||b(e)})),T(!0),C(n),A(n,0,e.addRowListener(s,null,((e,n,t)=>b(t))),e.addTableListener(s,(()=>T())))},M,()=>p(z,M),A,C]})(e,w,(e=>{return i(e)?"":c(e)?(n=t,e.map(n)):t(e);var n})),[H,J,K]=(e=>{let n;const[t,l]=(()=>{const e=[];let n=0;return[()=>{var t;return null!=(t=e.shift())?t:""+n++},n=>{A.test(n)&&u(e)<1e3&&d(e,n)}]})(),r=w();return[(e,l,s,o=[],u=(()=>[]))=>{null!=n||(n=P);const d=t();return y(r,d,[e,l,s,o,u]),T(R(l,null!=s?s:[""],b),d),d},(e,t,...l)=>o(((e,n=[""])=>{const t=[],l=(e,r)=>r==u(n)?d(t,e):null===n[r]?g(e,(e=>l(e,r+1))):o([n[r],null],(n=>l(x(e,n),r+1)));return l(e,0),t})(e,t),(e=>g(e,(e=>x(r,e)[0](n,...null!=t?t:[],...l))))),e=>a(x(r,e),(([,n,t])=>(R(n,null!=t?t:[""],void 0,(n=>(S(n,e),h(n)?1:0))),y(r,e),l(e),t))),e=>a(x(r,e),(([e,,t=[],l,r])=>{const s=(...d)=>{var a,c;const v=u(d);v==u(t)?e(n,...d,...r(d)):i(t[v])?o(null!=(c=null==(a=l[v])?void 0:a.call(l,...d))?c:[],(e=>s(...d,e))):s(...d,t[v])};s()}))]})(),N=(n,t,l)=>{const r=W(n);g(l,((n,l)=>t(l,(t=>g(n,(n=>t(n,(t=>e.forEachCell(r,n,t)))))))))},P={setIndexDefinition:(e,t,l,o,u,d=z)=>{const c=i(u)?void 0:([e],[n])=>u(e,n);return B(e,t,((t,l,u,f,I,L)=>{let E=0;const R=b(),k=b(),z=$(e);if(g(l,(([e,n],t)=>{const l=b(e),r=b(n);g(l,(e=>S(r,e)?S(l,e):0)),g(l,(e=>{T(R,e),a(x(z,e),(n=>{S(n,t),h(n)&&(y(z,e),E=1)}))})),g(r,(e=>{T(R,e),v(z,e)||(y(z,e,b()),E=1),T(x(z,e),t),i(o)||T(k,e)}))})),t(),h(I)||(L?p(z,(e=>T(k,e))):p(u,(e=>a(x(f,e),(e=>T(k,e))))),g(k,(e=>{const n=(n,t)=>d(x(I,n),x(I,t),e),t=[...x(z,e)];r(t,n)||(y(z,e,b(s(t,n))),T(R,e))}))),(E||L)&&!i(c)){const n=[...z];r(n,c)||(q(e,w(s(n,c))),E=1)}E&&J(n,[e]),g(R,(n=>J(D,[e,n])))}),k(l),a(o,k)),P},delIndexDefinition:e=>(F(e),P),getStore:M,getIndexIds:j,forEachIndex:e=>m(((n,t)=>e(n,(e=>N(n,e,t))))),forEachSlice:(e,n)=>N(e,n,$(e)),hasIndex:O,hasSlice:(e,n)=>v($(e),n),getTableId:W,getSliceIds:e=>L($(e)),getSliceRowIds:(e,n)=>f(x($(e),n)),addSliceIdsListener:(e,t)=>H(t,n,[e]),addSliceRowIdsListener:(e,n,t)=>H(t,D,[e,n]),delListener:e=>(K(e),P),destroy:G,getListenerStats:()=>({})};return C(P)})(e)),n.get(e))})();exports.createIndexes=D;
