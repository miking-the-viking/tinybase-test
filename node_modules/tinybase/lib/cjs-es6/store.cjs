"use strict";const e=e=>typeof e,t=e(""),l=e(!0),n=e(0),s=e(e),r=e=>""+e,a=(e,t)=>e.forEach(t),o=(e,t)=>e.map(t),u=e=>e.length,i=(e,t,l)=>e.slice(t,l),c=(e,...t)=>e.push(...t),d=e=>JSON.stringify(e,((e,t)=>{return h(t,Map)?(l=(e,[t,l])=>(e[t]=l,e),n={},[...t].reduce(l,n)):t;var l,n})),v=JSON.parse,f=isFinite,h=(e,t)=>e instanceof t,T=e=>null==e,V=(e,t,l)=>T(e)?null==l?void 0:l():t(e),g=e=>e==t||e==l,b=t=>e(t)==s,S=(e,t)=>{var l;return null!=(l=null==e?void 0:e.has(t))&&l},w=e=>T(e)||0==(e=>e.size)(e),y=e=>e.clear(),I=(e,t)=>null==e?void 0:e.forEach(t),R=(e,t)=>null==e?void 0:e.delete(t),p=e=>new Map(e),C=e=>{var t;return[...null!=(t=null==e?void 0:e.keys())?t:[]]},J=(e,t)=>null==e?void 0:e.get(t),m=(e,t)=>I(e,((e,l)=>t(l,e))),L=(e,t,l)=>T(l)?(R(e,t),e):null==e?void 0:e.set(t,l),E=(e,t,l)=>(S(e,t)||L(e,t,l()),J(e,t)),F=(e,t,l)=>{const n={},s=null!=t?t:e=>e;return I(e,((e,t)=>V(s(e),(e=>(null==l?void 0:l(e))?0:n[t]=e)))),n},z=(e,t)=>{const l=p(),n=null!=t?t:e=>e;return I(e,((e,t)=>l.set(t,n(e)))),l},O=e=>z(e,z),k=(e,t,l,n,s=0)=>V((l?E:J)(e,t[s],s>u(t)-2?l:p),(r=>{if(s>u(t)-2)return(null==n?void 0:n(r))&&L(e,t[s]),r;const a=k(r,t,l,n,s+1);return w(r)&&L(e,t[s]),a})),A=e=>new Set(Array.isArray(e)||T(e)?e:[e]),M=(e,t)=>null==e?void 0:e.add(t),N=/^\d+$/,P=()=>{const e=[];let t=0;return[()=>{var l;return null!=(l=e.shift())?l:""+t++},t=>{N.test(t)&&u(e)<1e3&&c(e,t)}]},j=Object,x=j.keys,D=j.isFrozen,W=j.freeze,$=e=>h(e,j)&&e.constructor==j,q=(e,t)=>!T(((e,t)=>V(e,(e=>e[t])))(e,t)),B=(e,t)=>delete e[t],G=(e,t)=>o(j.entries(e),(([e,l])=>t(l,e))),H=e=>{return $(e)&&(t=x(e),0==u(t));var t},K=e=>[e,e],Q=()=>[p(),p()],U=t=>{const l=e(t);return g(l)||l==n&&f(t)?l:void 0},X=(e,t,l,n=L)=>{const s=(r=e=>!q(t,e),C(e).filter(r));var r;return a(x(t),(n=>l(e,n,t[n]))),a(s,(t=>n(e,t))),e},Y=(e,t,l)=>T(e)||!$(e)||H(e)||D(e)?(null==l||l(),!1):(G(e,((l,n)=>{t(l,n)||B(e,n)})),!H(e)),Z=(e,t,l)=>L(e,t,J(e,t)==-l?void 0:l),_=()=>{let e,t,l,s,f=0;const h=p(),N=p(),j=p(),x=p(),D=p(),$=p(),ee=p(),te=p(),le=p(),ne=p(),se=p(),re=p(),ae=A(),oe=p(),ue=p(),ie=p(),ce=Q(),de=Q(),ve=Q(),fe=Q(),he=Q(),Te=Q(),Ve=Q(),ge=Q(),be=Q(),Se=Q(),we=Q(),ye=Q(),Ie=Q(),Re=Q(),[pe,Ce,Je,me]=(e=>{let t;const[l,n]=P(),s=p();return[(e,n,r,a=[],o=(()=>[]))=>{null!=t||(t=Nt);const u=l();return L(s,u,[e,n,r,a,o]),M(k(n,null!=r?r:[""],A),u),u},(e,l,...n)=>a(((e,t=[""])=>{const l=[],n=(e,s)=>s==u(t)?c(l,e):null===t[s]?I(e,(e=>n(e,s+1))):a([t[s],null],(t=>n(J(e,t),s+1)));return n(e,0),l})(e,l),(e=>I(e,(e=>J(s,e)[0](t,...null!=l?l:[],...n))))),e=>V(J(s,e),(([,t,l])=>(k(t,null!=l?l:[""],void 0,(t=>(R(t,e),w(t)?1:0))),L(s,e),n(e),l))),e=>V(J(s,e),(([e,,l=[],n,s])=>{const r=(...o)=>{var i,c;const d=u(o);d==u(l)?e(t,...o,...s(o)):T(l[d])?a(null!=(c=null==(i=n[d])?void 0:i.call(n,...o))?c:[],(e=>r(...o,e))):r(...o,l[d])};r()}))]})(),Le=e=>{if(!Y(e,((e,t)=>["type","default"].includes(t))))return!1;const t=e.type;return!(!g(t)&&t!=n||(U(e.default)!=t&&B(e,"default"),0))},Ee=(t,l)=>(!e||S(le,l)||rt(l))&&Y(t,((e,t)=>Fe(l,t,e)),(()=>rt(l))),Fe=(e,t,l,n)=>Y(n?l:Ae(l,e,t),((n,s)=>V(ze(e,t,s,n),(e=>(l[s]=e,!0)),(()=>!1))),(()=>rt(e,t))),ze=(t,l,n,s)=>e?V(J(J(le,t),n),(e=>U(s)!=e.type?rt(t,l,n,s,e.default):s),(()=>rt(t,l,n,s))):T(U(s))?rt(t,l,n,s):s,Oe=(e,t)=>Y(t?e:Me(e),((t,l)=>V(ke(l,t),(t=>(e[l]=t,!0)),(()=>!1))),(()=>at())),ke=(e,l)=>t?V(J(se,e),(t=>U(l)!=t.type?at(e,l,t.default):l),(()=>at(e,l))):T(U(l))?at(e,l):l,Ae=(e,t,l)=>(V(J(ne,t),(([n,s])=>{I(n,((t,l)=>{q(e,l)||(e[l]=t)})),I(s,(n=>{q(e,n)||rt(t,l,n)}))})),e),Me=e=>(t&&(I(re,((t,l)=>{q(e,l)||(e[l]=t)})),I(ae,(t=>{q(e,t)||at(t)}))),e),Ne=e=>X(le,e,((e,t,l)=>{const n=p(),s=A();X(E(le,t,p),l,((e,t,l)=>{L(e,t,l),V(l.default,(e=>L(n,t,e)),(()=>M(s,t)))})),L(ne,t,[n,s])}),((e,t)=>{L(le,t),L(ne,t)})),Pe=e=>X(se,e,((e,t,l)=>{L(se,t,l),V(l.default,(e=>L(re,t,e)),(()=>M(ae,t)))}),((e,t)=>{L(se,t),L(re,t),R(ae,t)})),je=e=>H(e)?Et():pt(e),xe=e=>X(ue,e,((e,t,l)=>De(t,l)),((e,t)=>Ue(t))),De=(e,t)=>X(E(ue,e,(()=>(_e(e,1),p()))),t,((t,l,n)=>We(e,t,l,n)),((t,l)=>Xe(e,t,l))),We=(e,t,l,n,s)=>X(E(t,l,(()=>(et(e,l,1),p()))),n,((t,n,s)=>$e(e,l,t,n,s)),((n,r)=>Ye(e,t,l,n,r,s))),$e=(e,t,l,n,s)=>{S(l,n)||tt(e,t,n,1);const r=J(l,n);s!==r&&(lt(e,t,n,r,s),L(l,n,s))},qe=(e,t,l,n,s)=>V(J(t,l),(t=>$e(e,l,t,n,s)),(()=>We(e,t,l,Ae({[n]:s},e,l)))),Be=e=>H(e)?Ft():Ct(e),Ge=e=>X(ie,e,((e,t,l)=>He(t,l)),((e,t)=>Ze(t))),He=(e,t)=>{S(ie,e)||nt(e,1);const l=J(ie,e);t!==l&&(st(e,l,t),L(ie,e,t))},Ke=e=>{const[t]=E(oe,e,P),l=t();return S(J(ue,e),l)?Ke(e):l},Qe=e=>{var t;return null!=(t=J(ue,e))?t:De(e,{})},Ue=e=>De(e,{}),Xe=(e,t,l)=>{const[,n]=E(oe,e,P);n(l),We(e,t,l,{},!0)},Ye=(e,t,l,n,s,r)=>{var a;const o=J(null==(a=J(ne,e))?void 0:a[0],s);if(!T(o)&&!r)return $e(e,l,n,s,o);const u=t=>{lt(e,l,t,J(n,t)),tt(e,l,t,-1),L(n,t)};T(o)?u(s):m(n,u),w(n)&&(et(e,l,-1),w(L(t,l))&&(_e(e,-1),L(ue,e),L(oe,e)))},Ze=e=>{const t=J(re,e);if(!T(t))return He(e,t);st(e,J(ie,e)),nt(e,-1),L(ie,e)},_e=(e,t)=>Z(h,e,t),et=(e,t,l)=>Z(E(N,e,p),t,l),tt=(e,t,l,n)=>Z(E(E(j,e,p),t,p),l,n),lt=(e,t,l,n,s)=>E(E(E(x,e,p),t,p),l,(()=>[n,0]))[1]=s,nt=(e,t)=>Z(D,e,t),st=(e,t,l)=>E($,e,(()=>[t,0]))[1]=l,rt=(e,t,l,n,s)=>(c(E(E(E(ee,e,p),t,p),l,(()=>[])),n),s),at=(e,t,l)=>(c(E(te,e,(()=>[])),t),l),ot=(e,t,l)=>V(J(J(J(x,e),t),l),(([e,t])=>[!0,e,t]),(()=>[!1,...K(wt(e,t,l))])),ut=e=>V(J($,e),(([e,t])=>[!0,e,t]),(()=>[!1,...K(Rt(e))])),it=e=>w(ee)||w(be[e])?0:I(e?z(ee,O):ee,((t,l)=>I(t,((t,n)=>I(t,((t,s)=>Ce(be[e],[l,n,s],t))))))),ct=e=>w(te)||w(Se[e])?0:I(e?z(te):te,((t,l)=>Ce(Se[e],[l],t))),dt=(e,t,l)=>{if(!w(t))return Ce(e,l),1},vt=e=>{const t=w(he[e]),l=w(Ve[e])&&w(fe[e])&&t&&w(de[e]),n=w(ge[e])&&w(Te[e])&&w(ve[e])&&w(ce[e]);if(!l||!n){const s=e?[z(h),O(N),z(j,O),z(x,O)]:[h,N,j,x];if(!l){I(s[2],((t,l)=>I(t,((t,n)=>dt(Ve[e],t,[l,n])))));const l=A();I(s[1],((n,s)=>{dt(fe[e],n,[s])&&!t&&(Ce(he[e],[s,null]),M(l,s))})),t||I(s[3],((t,n)=>{if(!S(l,n)){const l=A();I(t,(e=>I(e,(([t,n],s)=>n!==t?M(l,s):R(e,s))))),I(l,(t=>Ce(he[e],[n,t])))}})),dt(de[e],s[0])}if(!n){let t;I(s[3],((l,n)=>{let s;I(l,((l,r)=>{let a;I(l,(([l,o],u)=>{o!==l&&(Ce(ge[e],[n,r,u],o,l,ot),t=s=a=1)})),a&&Ce(Te[e],[n,r],ot)})),s&&Ce(ve[e],[n],ot)})),t&&Ce(ce[e],void 0,ot)}}},ft=e=>{const t=w(ye[e]),l=w(Ie[e])&&w(we[e]);if(!t||!l){const n=e?[z(D),z($)]:[D,$];if(t||dt(ye[e],n[0]),!l){let t;I(n[1],(([l,n],s)=>{n!==l&&(Ce(Ie[e],[s],n,l,ut),t=1)})),t&&Ce(we[e],void 0,ut)}}},ht=(e,...t)=>(kt((()=>e(...o(t,r)))),Nt),Tt=()=>F(ue,(e=>F(e,F))),Vt=()=>C(ue),gt=e=>C(J(ue,r(e))),bt=(e,t,l,n=0,s)=>{return o(i((u=J(ue,r(e)),c=(e,l)=>[T(t)?l:J(e,r(t)),l],a=([e],[t])=>(e<t?-1:1)*(l?-1:1),o([...null!=(d=null==u?void 0:u.entries())?d:[]],(([e,t])=>c(t,e))).sort(a)),n,T(s)?s:n+s),(([,e])=>e));var a,u,c,d},St=(e,t)=>C(J(J(ue,r(e)),r(t))),wt=(e,t,l)=>J(J(J(ue,r(e)),r(t)),r(l)),yt=()=>F(ie),It=()=>C(ie),Rt=e=>J(ie,r(e)),pt=e=>ht((()=>(e=>Y(e,Ee,rt))(e)?xe(e):0)),Ct=e=>ht((()=>Oe(e)?Ge(e):0)),Jt=e=>{try{je(v(e))}catch(e){}return Nt},mt=t=>ht((()=>{if((e=Y(t,(e=>Y(e,Le))))&&(Ne(t),!w(ue))){const e=Tt();Et(),pt(e)}})),Lt=e=>ht((()=>{if(t=(e=>Y(e,Le))(e)){const l=yt();Ot(),Ft(),t=!0,Pe(e),Ct(l)}})),Et=()=>ht((()=>xe({}))),Ft=()=>ht((()=>Ge({}))),zt=()=>ht((()=>{Ne({}),e=!1})),Ot=()=>ht((()=>{Pe({}),t=!1})),kt=(e,t)=>{if(-1==f)return;At();const l=e();return Mt(t),l},At=()=>(f++,Nt),Mt=e=>(f>0&&(f--,0==f&&(l=!w(x),s=!w($),f=1,it(1),l&&vt(1),ct(1),s&&ft(1),f=-1,(null==e?void 0:e(F(x,(e=>F(e,(e=>F(e,(e=>[...e]),(([e,t])=>e===t))),H)),H),F(ee,(e=>F(e,F))),F($,(e=>[...e]),(([e,t])=>e===t)),F(te)))&&(f=1,I(x,((e,t)=>I(e,((e,l)=>I(e,(([e],n)=>((e,t,l,n,s)=>T(s)?e.delCell(t,l,n,!0):e.setCell(t,l,n,s))(Nt,t,l,n,e))))))),I($,(([e],t)=>((e,t,l)=>T(l)?e.delValue(t):e.setValue(t,l))(Nt,t,e))),f=-1,l=s=!1),Ce(Re[0],void 0,l,s),it(0),l&&vt(0),ct(0),s&&ft(0),Ce(Re[1],void 0,l,s),f=0,a([h,N,j,x,ee,D,$,te],y))),Nt),Nt={getTables:Tt,getTableIds:Vt,getTable:e=>F(J(ue,r(e)),F),getRowIds:gt,getSortedRowIds:bt,getRow:(e,t)=>F(J(J(ue,r(e)),r(t))),getCellIds:St,getCell:wt,getValues:yt,getValueIds:It,getValue:Rt,hasTables:()=>!w(ue),hasTable:e=>S(ue,r(e)),hasRow:(e,t)=>S(J(ue,r(e)),r(t)),hasCell:(e,t,l)=>S(J(J(ue,r(e)),r(t)),r(l)),hasValues:()=>!w(ie),hasValue:e=>S(ie,r(e)),getTablesJson:()=>d(ue),getValuesJson:()=>d(ie),getJson:()=>d([ue,ie]),getTablesSchemaJson:()=>d(le),getValuesSchemaJson:()=>d(se),getSchemaJson:()=>d([le,se]),setTables:pt,setTable:(e,t)=>ht((e=>Ee(t,e)?De(e,t):0),e),setRow:(e,t,l)=>ht(((e,t)=>Fe(e,t,l)?We(e,Qe(e),t,l):0),e,t),addRow:(e,t)=>kt((()=>{let l;return Fe(e,l,t)&&(e=r(e),We(e,Qe(e),l=Ke(e),t)),l})),setPartialRow:(e,t,l)=>ht(((e,t)=>{if(Fe(e,t,l,1)){const n=Qe(e);G(l,((l,s)=>qe(e,n,t,s,l)))}}),e,t),setCell:(e,t,l,n)=>ht(((e,t,l)=>V(ze(e,t,l,b(n)?n(wt(e,t,l)):n),(n=>qe(e,Qe(e),t,l,n)))),e,t,l),setValues:Ct,setPartialValues:e=>ht((()=>Oe(e,1)?G(e,((e,t)=>He(t,e))):0)),setValue:(e,t)=>ht((e=>V(ke(e,b(t)?t(Rt(e)):t),(t=>He(e,t)))),e),setTablesJson:Jt,setValuesJson:e=>{try{Be(v(e))}catch(e){}return Nt},setJson:e=>{try{const[t,l]=v(e);je(t),Be(l)}catch(t){Jt(e)}return Nt},setTablesSchema:mt,setValuesSchema:Lt,setSchema:(e,t)=>ht((()=>{mt(e),Lt(t)})),delTables:Et,delTable:e=>ht((e=>S(ue,e)?Ue(e):0),e),delRow:(e,t)=>ht(((e,t)=>V(J(ue,e),(l=>S(l,t)?Xe(e,l,t):0))),e,t),delCell:(e,t,l,n)=>ht(((e,t,l)=>V(J(ue,e),(s=>V(J(s,t),(r=>S(r,l)?Ye(e,s,t,r,l,n):0))))),e,t,l),delValues:Ft,delValue:e=>ht((e=>S(ie,e)?Ze(e):0),e),delTablesSchema:zt,delValuesSchema:Ot,delSchema:()=>ht((()=>{zt(),Ot()})),transaction:kt,startTransaction:At,finishTransaction:Mt,forEachTable:e=>I(ue,((t,l)=>e(l,(e=>I(t,((t,l)=>e(l,(e=>m(t,e))))))))),forEachRow:(e,t)=>I(J(ue,r(e)),((e,l)=>t(l,(t=>m(e,t))))),forEachCell:(e,t,l)=>m(J(J(ue,r(e)),r(t)),l),forEachValue:e=>m(ie,e),addSortedRowIdsListener:(e,t,l,n,s,r,a)=>{let o=bt(e,t,l,n,s);return pe((()=>{const a=bt(e,t,l,n,s);var i,c,d;c=o,u(i=a)===u(c)&&(d=(e,t)=>c[t]===e,i.every(d))||(o=a,r(Nt,e,t,l,n,s,o))}),he[a?1:0],[e,t],[Vt])},addWillFinishTransactionListener:e=>pe(e,Re[0]),addDidFinishTransactionListener:e=>pe(e,Re[1]),callListener:e=>(me(e),Nt),delListener:e=>(Je(e),Nt),getListenerStats:()=>({}),createStore:_};return G({Tables:[0,ce],TableIds:[0,de],Table:[1,ve,[Vt]],RowIds:[1,fe,[Vt]],Row:[2,Te,[Vt,gt]],CellIds:[2,Ve,[Vt,gt]],Cell:[3,ge,[Vt,gt,St],e=>K(wt(...e))],InvalidCell:[3,be],Values:[0,we],ValueIds:[0,ye],Value:[1,Ie,[It],e=>K(Rt(e[0]))],InvalidValue:[1,Se]},(([e,t,l,n],s)=>{Nt["add"+s+"Listener"]=(...s)=>pe(s[e],t[s[e+1]?1:0],e>0?i(s,0,e):void 0,l,n)})),W(Nt)};exports.createStore=_;
