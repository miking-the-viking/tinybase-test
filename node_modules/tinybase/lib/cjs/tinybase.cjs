"use strict";var e=require("fs");const t=e=>typeof e,s=t(""),n=t(!0),r=t(0),o=t(t),a=e=>""+e,i=(e,t)=>e.includes(t),l=(e,t)=>e.every(t),c=(e,t)=>L(e)===L(t)&&l(e,((e,s)=>t[s]===e)),d=(e,t)=>l(e,((s,n)=>0==n||t(e[n-1],s)<=0)),u=(e,t)=>e.sort(t),h=(e,t)=>e.forEach(t),f=(e,t)=>e.map(t),g=e=>p(e,((e,t)=>e+t),0),L=e=>e.length,w=e=>0==L(e),p=(e,t,s)=>e.reduce(t,s),v=(e,t,s)=>e.slice(t,s),R=(e,...t)=>e.push(...t),I=e=>e.pop(),S=e=>e.shift(),T=e=>JSON.stringify(e,((e,t)=>V(t,Map)?p([...t],((e,[t,s])=>(e[t]=s,e)),{}):t)),y=JSON.parse,b=Math.max,C=Math.min,m=isFinite,V=(e,t)=>e instanceof t,x=e=>null==e,E=(e,t,s)=>x(e)?s?.():t(e),k=e=>e==s||e==n,J=e=>t(e)==o,M=e=>Array.isArray(e),A=()=>{},D=e=>e.size,F=(e,t)=>e?.has(t)??!1,P=e=>x(e)||0==D(e),Q=e=>[...e?.values()??[]],z=e=>e.clear(),N=(e,t)=>e?.forEach(t),O=(e,t)=>e?.delete(t),j=e=>new Map(e),W=e=>[...e?.keys()??[]],q=(e,t)=>e?.get(t),B=(e,t)=>N(e,((e,s)=>t(s,e))),H=(e,t,s)=>x(s)?(O(e,t),e):e?.set(t,s),$=(e,t,s)=>(F(e,t)||H(e,t,s()),q(e,t)),G=(e,t,s)=>{const n={},r=t??(e=>e);return N(e,((e,t)=>E(r(e),(e=>s?.(e)?0:n[t]=e)))),n},K=(e,t)=>{const s=j(),n=t??(e=>e);return N(e,((e,t)=>s.set(t,n(e)))),s},U=e=>K(e,K),X=(e,t,s,n,r=0)=>E((s?$:q)(e,t[r],r>L(t)-2?s:j),(o=>{if(r>L(t)-2)return n?.(o)&&H(e,t[r]),o;const a=X(o,t,s,n,r+1);return P(o)&&H(e,t[r]),a})),Y=e=>{const s=t(e);return k(s)||s==r&&m(e)?s:void 0},Z=(e,t,s,n,r)=>x(r)?e.delCell(t,s,n,!0):e.setCell(t,s,n,r),_=(e,t,s)=>x(s)?e.delValue(t):e.setValue(t,s),ee=e=>new Set(M(e)||x(e)?e:[e]),te=(e,t)=>e?.add(t),se=(e,t,s)=>{const n=e.hasRow,r=j(),o=j(),a=j(),i=j(),l=j(),d=(t,s,...n)=>{const r=$(l,t,ee);return h(n,(t=>te(r,t)&&s&&e.callListener(t))),n},u=(t,...s)=>E(q(l,t),(n=>{h(w(s)?Q(n):s,(t=>{e.delListener(t),O(n,t)})),P(n)&&H(l,t)})),f=(e,s)=>{H(r,e,s),F(o,e)||(H(o,e,t()),H(a,e,j()),H(i,e,j()))},g=e=>{H(r,e),H(o,e),H(a,e),H(i,e),u(e)};return[()=>e,()=>W(r),e=>B(o,e),e=>F(o,e),e=>q(r,e),e=>q(o,e),(e,t)=>H(o,e,t),f,(t,r,o,l,g)=>{f(t,r);const L=j(),w=j(),p=q(a,t),v=q(i,t),R=t=>{const o=s=>e.getCell(r,t,s),a=q(p,t),i=n(r,t)?s(l(o,t)):void 0;if(a===i||M(a)&&M(i)&&c(a,i)||H(L,t,[a,i]),!x(g)){const e=q(v,t),s=n(r,t)?g(o,t):void 0;e!=s&&H(w,t,s)}},I=e=>{o((()=>{N(L,(([,e],t)=>H(p,t,e))),N(w,((e,t)=>H(v,t,e)))}),L,w,p,v,e),z(L),z(w)};B(p,R),e.hasTable(r)&&h(e.getRowIds(r),(e=>{F(p,e)||R(e)})),I(!0),u(t),d(t,0,e.addRowListener(r,null,((e,t,s)=>R(s))),e.addTableListener(r,(()=>I())))},g,()=>B(l,g),d,u]},ne=(e,n)=>t(e)==s?t=>t(e):e??(()=>n??""),re=e=>{const t=new WeakMap;return s=>(t.has(s)||t.set(s,e(s)),t.get(s))},oe=/^\d+$/,ae=()=>{const e=[];let t=0;return[()=>S(e)??""+t++,t=>{oe.test(t)&&L(e)<1e3&&R(e,t)}]},ie=e=>{let t;const[s,n]=ae(),r=j();return[(n,o,a,i=[],l=(()=>[]))=>{t??=e();const c=s();return H(r,c,[n,o,a,i,l]),te(X(o,a??[""],ee),c),c},(e,s,...n)=>h(((e,t=[""])=>{const s=[],n=(e,r)=>r==L(t)?R(s,e):null===t[r]?N(e,(e=>n(e,r+1))):h([t[r],null],(t=>n(q(e,t),r+1)));return n(e,0),s})(e,s),(e=>N(e,(e=>q(r,e)[0](t,...s??[],...n))))),e=>E(q(r,e),(([,t,s])=>(X(t,s??[""],void 0,(t=>(O(t,e),P(t)?1:0))),H(r,e),n(e),s))),e=>E(q(r,e),(([e,,s=[],n,r])=>{const o=(...a)=>{const i=L(a);i==L(s)?e(t,...a,...r(a)):x(s[i])?h(n[i]?.(...a)??[],(e=>o(...a,e))):o(...a,s[i])};o()}))]},le=Object,ce=le.keys,de=le.isFrozen,ue=le.freeze,he=e=>V(e,le)&&e.constructor==le,fe=(e,t)=>!x(((e,t)=>E(e,(e=>e[t])))(e,t)),ge=(e,t)=>delete e[t],Le=(e,t)=>f(le.entries(e),(([e,s])=>t(s,e))),we=e=>he(e)&&w(ce(e)),pe=re((e=>{let t,s,n,r=100,o=j(),a=j(),l=1;const c=j(),d=j(),[u,f,g]=ie((()=>U)),p=j(),v=j(),T=[],y=[],b=(t,s)=>{l=0,e.transaction((()=>{const[n,r]=q(p,s);N(n,((s,n)=>N(s,((s,r)=>N(s,((s,o)=>Z(e,n,r,o,s[t]))))))),N(r,((s,n)=>_(e,n,s[t])))})),l=1},C=e=>{H(p,e),H(v,e),f(d,[e])},m=(e,t)=>h(((e,t)=>e.splice(0,t))(e,t??L(e)),C),V=()=>m(T,L(T)-r),k=()=>E(t,(()=>{R(T,t),V(),m(y),t=void 0,n=1})),J=()=>{t=I(T),n=1},M=e.addCellListener(null,null,null,((e,t,s,n,r,a)=>{if(l){k();const e=$(o,t,j),i=$(e,s,j),l=$(i,n,(()=>[a,void 0]));l[1]=r,l[0]===r&&P(H(i,n))&&P(H(e,s))&&P(H(o,t))&&J(),O()}})),A=e.addValueListener(null,((e,t,s,n)=>{if(l){k();const e=$(a,t,(()=>[n,void 0]));e[1]=s,e[0]===s&&P(H(a,t))&&J(),O()}})),D=(e="")=>(x(t)&&(t=""+s++,H(p,t,[o,a]),G(t,e),o=j(),a=j(),n=1),t),Q=()=>{w(T)||(((e,...t)=>{e.unshift(...t)})(y,D()),b(0,t),t=I(T),n=1)},z=()=>{w(y)||(R(T,t),t=S(y),b(1,t),n=1)},O=()=>{n&&(f(c),n=0)},W=e=>{const t=D(e);return O(),t},G=(e,t)=>(K(e)&&q(v,e)!==t&&(H(v,e,t),f(d,[e])),U),K=e=>F(p,e),U={setSize:e=>(r=e,V(),U),addCheckpoint:W,setCheckpoint:G,getStore:()=>e,getCheckpointIds:()=>[[...T],t,[...y]],forEachCheckpoint:e=>B(v,e),hasCheckpoint:K,getCheckpoint:e=>q(v,e),goBackward:()=>(Q(),O(),U),goForward:()=>(z(),O(),U),goTo:e=>{const s=i(T,e)?Q:i(y,e)?z:null;for(;!x(s)&&e!=t;)s();return O(),U},addCheckpointIdsListener:e=>u(e,c),addCheckpointListener:(e,t)=>u(t,d,[e]),delListener:e=>(g(e),U),clear:()=>(m(T),m(y),x(t)||C(t),t=void 0,s=0,W(),U),destroy:()=>{e.delListener(M),e.delListener(A)},getListenerStats:()=>({})};return ue(U.clear())})),ve=(e,t)=>e<t?-1:1,Re=re((e=>{const t=j(),s=j(),[n,r,o,i,l,c,h,,g,L,w]=se(e,j,(e=>x(e)?"":M(e)?f(e,a):a(e))),[p,v,R]=ie((()=>S)),I=(t,s,n)=>{const r=l(t);N(n,((t,n)=>s(n,(s=>N(t,(t=>s(t,(s=>e.forEachCell(r,t,s)))))))))},S={setIndexDefinition:(e,n,r,o,a,i=ve)=>{const l=x(a)?void 0:([e],[t])=>a(e,t);return g(e,n,((n,r,a,f,g,L)=>{let w=0;const p=ee(),R=ee(),I=c(e);if(N(r,(([e,t],s)=>{const n=ee(e),r=ee(t);N(n,(e=>O(r,e)?O(n,e):0)),N(n,(e=>{te(p,e),E(q(I,e),(t=>{O(t,s),P(t)&&(H(I,e),w=1)}))})),N(r,(e=>{te(p,e),F(I,e)||(H(I,e,ee()),w=1),te(q(I,e),s),x(o)||te(R,e)}))})),n(),P(g)||(L?B(I,(e=>te(R,e))):B(a,(e=>E(q(f,e),(e=>te(R,e))))),N(R,(e=>{const t=(t,s)=>i(q(g,t),q(g,s),e),s=[...q(I,e)];d(s,t)||(H(I,e,ee(u(s,t))),te(p,e))}))),(w||L)&&!x(l)){const t=[...I];d(t,l)||(h(e,j(u(t,l))),w=1)}w&&v(t,[e]),N(p,(t=>v(s,[e,t])))}),ne(r),E(o,ne)),S},delIndexDefinition:e=>(L(e),S),getStore:n,getIndexIds:r,forEachIndex:e=>o(((t,s)=>e(t,(e=>I(t,e,s))))),forEachSlice:(e,t)=>I(e,t,c(e)),hasIndex:i,hasSlice:(e,t)=>F(c(e),t),getTableId:l,getSliceIds:e=>W(c(e)),getSliceRowIds:(e,t)=>Q(q(c(e),t)),addSliceIdsListener:(e,s)=>p(s,t,[e]),addSliceRowIdsListener:(e,t,n)=>p(n,s,[e,t]),delListener:e=>(R(e),S),destroy:w,getListenerStats:()=>({})};return ue(S)})),Ie=j([["avg",[(e,t)=>g(e)/t,(e,t,s)=>e+(t-e)/(s+1),(e,t,s)=>e+(e-t)/(s-1),(e,t,s,n)=>e+(t-s)/n]],["max",[e=>b(...e),(e,t)=>b(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:b(t,e)]],["min",[e=>C(...e),(e,t)=>C(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:C(t,e)]],["sum",[e=>g(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,s)=>e-s+t]]]),Se=(e,t,s,n,r,o=!1)=>{if(P(s))return;const[a,i,l,c]=r;return o||=x(e),N(n,(([s,n])=>{o||(e=x(s)?i?.(e,n,t++):x(n)?l?.(e,s,t--):c?.(e,n,s,t),o||=x(e))})),o?a(Q(s),D(s)):e},Te=re((e=>{const t=j(),[s,n,r,o,a,i,l,,c,d,u]=se(e,A,(e=>isNaN(e)||x(e)||!0===e||!1===e||""===e?void 0:1*e)),[h,f,g]=ie((()=>L)),L={setMetricDefinition:(e,s,n,r,o,a,d)=>{const u=J(n)?[n,o,a,d]:q(Ie,n)??q(Ie,"sum");return c(e,s,((s,n,r,o,a,c)=>{const d=i(e),h=D(o);c||=x(d),s();let g=Se(d,h,o,n,u,c);m(g)||(g=void 0),g!=d&&(l(e,g),f(t,[e],g,d))}),ne(r,1)),L},delMetricDefinition:e=>(d(e),L),getStore:s,getMetricIds:n,forEachMetric:r,hasMetric:o,getTableId:a,getMetric:i,addMetricListener:(e,s)=>h(s,t,[e]),delListener:e=>(g(e),L),destroy:u,getListenerStats:()=>({})};return ue(L)})),ye=(e,t,s,n,r)=>{let o,a,i=0;const l={load:async(s,n)=>{if(2!=i){i=1;const r=await t();x(r)||""==r?e.transaction((()=>e.setTables(s).setValues(n))):e.setJson(r),i=0}return l},startAutoLoad:async(e,t)=>(l.stopAutoLoad(),await l.load(e,t),n(l.load),l),stopAutoLoad:()=>(r(),l),save:async()=>(1!=i&&(i=2,await s(e.getJson()),i=0),l),startAutoSave:async()=>(await l.stopAutoSave().save(),o=e.addTablesListener(l.save),a=e.addValuesListener(l.save),l),stopAutoSave:()=>(E(o,e.delListener),E(a,e.delListener),l),getStore:()=>e,destroy:()=>l.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return ue(l)},be=globalThis.window,Ce=(e,t,s)=>{let n;return ye(e,(async()=>s.getItem(t)),(async e=>s.setItem(t,e)),(e=>{n=n=>{n.storageArea===s&&n.key===t&&e()},be.addEventListener("storage",n)}),(()=>{be.removeEventListener("storage",n),n=void 0}))},me=e=>e.headers.get("ETag"),Ve=re((e=>{const t=e.createStore,[s,n,r,o,a,,,i,,c,d,u,f]=se(e,(()=>!0),A),g=t(),p=t(),I=j(),S=(e,t,...s)=>h(s,(s=>te($($(I,t,j),e,ee),s))),T=e=>{E(q(I,e),(e=>{B(e,((e,t)=>N(t,(t=>e.delListener(t))))),z(e)})),h([p,g],(t=>t.delTable(e)))},y=(e,t,s)=>S(t,e,t.addWillFinishTransactionListener(s.startTransaction),t.addDidFinishTransactionListener((()=>s.finishTransaction()))),b={setQueryDefinition:(t,s,n)=>{i(t,s),T(t);const r=[],o=[[null,[s,null,null,[],j()]]],a=[],c=[],d=[];n({select:(e,t)=>{const s=J(e)?[L(r)+"",e]:[x(t)?e:t,s=>s(e,t)];return R(r,s),{as:e=>s[0]=e}},join:(e,t,s)=>{const n=x(s)||J(t)?null:t,r=x(n)?t:s,a=[e,[e,n,J(r)?r:e=>e(r),[],j()]];return R(o,a),{as:e=>a[0]=e}},where:(e,t,s)=>R(a,J(e)?e:x(s)?s=>s(e)===t:n=>n(e,t)===s),group:(e,t,s,n,r)=>{const o=[e,[e,J(t)?[t,s,n,r]:q(Ie,t)??[(e,t)=>t]]];return R(c,o),{as:e=>o[0]=e}},having:(e,t)=>R(d,J(e)?e:s=>s(e)===t)});const v=j(r);if(P(v))return b;const I=j(o);B(I,((e,[,t])=>E(q(I,t),(({3:t})=>x(e)?0:R(t,e)))));const C=j(c);let m=g;if(P(C)&&w(d))m=p;else{y(t,m,p);const e=j();B(C,((t,[s,n])=>te($(e,s,ee),[t,n])));const s=ee();B(v,(t=>F(e,t)?0:te(s,t)));const n=j(),r=(s,n,r,o)=>E(s,(([a,i,c,u])=>{B(n,((t,[s])=>{const n=$(a,t,j),i=q(n,r),l=o?void 0:s;if(i!==l){const s=ee([[i,l]]),o=D(n);H(n,r,l),N(q(e,t),(([e,t])=>{const r=Se(u[e],o,n,s,t);u[e]=x(Y(r))?null:r}))}})),P(i)||!l(d,(e=>e((e=>u[e]))))?p.delRow(t,c):x(c)?s[2]=p.addRow(t,u):p.setRow(t,c,u)}));S(m,t,m.addRowListener(t,null,((o,a,i,l)=>{const c=[],d=[],u=j(),h=m.hasRow(t,i);let f=!h;N(s,(e=>{const[s,n,r]=l(t,i,e);R(c,n),R(d,r),f||=s})),B(e,(e=>{const[s,,n]=l(t,i,e);(f||s)&&H(u,e,[n])})),f&&r(X(n,c,void 0,(([,e])=>(O(e,i),P(e)))),u,i,1),h&&r(X(n,d,(()=>{const e={};return N(s,(s=>e[s]=m.getCell(t,i,s))),[j(),ee(),void 0,e]}),(([,e])=>{te(e,i)})),u,i)})))}y(t,e,m);const V=(n,r,o,i)=>{const c=t=>e.getCell(r,o,t);h(i,(s=>{const[r,,o,a,i]=q(I,s),l=o?.(c,n),[d,h]=q(i,n)??[];l!=d&&(x(h)||f(t,h),H(i,n,x(l)?null:[l,...u(t,1,e.addRowListener(r,l,(()=>V(n,r,l,a))))]))})),(n=>{const r=(t,r)=>e.getCell(...x(r)?[s,n,t]:t===s?[s,n,r]:[q(I,t)?.[0],q(q(I,t)?.[4],n)?.[0],r]);m.transaction((()=>l(a,(e=>e(r)))?B(v,((e,s)=>Z(m,t,n,e,s(r,n)))):m.delRow(t,n)))})(n)},{3:k}=q(I,null);return m.transaction((()=>u(t,1,e.addRowListener(s,null,((n,r,o)=>{e.hasRow(s,o)?V(o,s,o,k):(m.delRow(t,o),N(I,(({4:e})=>E(q(e,o),(([,s])=>{f(t,s),H(e,o)})))))}))))),b},delQueryDefinition:e=>(T(e),c(e),b),getStore:s,getQueryIds:n,forEachQuery:r,hasQuery:o,getTableId:a,delListener:e=>(p.delListener(e),b),destroy:d,getListenerStats:()=>{const{tables:e,tableIds:t,transaction:s,...n}=p.getListenerStats();return n}};return Le({Table:[1,1],RowIds:[0,1],SortedRowIds:[0,5],Row:[1,2],CellIds:[0,2],Cell:[1,3]},(([e,t],s)=>{h(e?["get","has","forEach"]:["get"],(e=>b[e+"Result"+s]=(...t)=>p[e+s](...t))),b["addResult"+s+"Listener"]=(...e)=>p["add"+s+"Listener"](...v(e,0,t),((s,...n)=>e[t](b,...n)))})),ue(b)})),xe=re((e=>{const t=j(),s=j(),n=j(),r=j(),[o,a,i,l,c,d,,,u,h,f]=se(e,(()=>[j(),j(),j(),j()]),(e=>x(e)?void 0:e+"")),[g,L,w]=ie((()=>I)),p=(e,t,s)=>E(d(e),(([n,,r])=>{if(!F(r,t)){const o=ee();if(c(e)!=R(e))te(o,t);else{let e=t;for(;!x(e)&&!F(o,e);)te(o,e),e=q(n,e)}if(s)return o;H(r,t,o)}return q(r,t)})),v=(e,t)=>E(d(e),(([,,e])=>H(e,t))),R=e=>q(t,e),I={setRelationshipDefinition:(e,o,a,i)=>(H(t,e,a),u(e,o,((t,o)=>{const a=ee(),i=ee(),l=ee(),[c,u]=d(e);N(o,(([t,s],n)=>{x(t)||(te(i,t),E(q(u,t),(e=>{O(e,n),P(e)&&H(u,t)}))),x(s)||(te(i,s),F(u,s)||H(u,s,ee()),te(q(u,s),n)),te(a,n),H(c,n,s),B(q(r,e),(t=>{F(p(e,t),n)&&te(l,t)}))})),t(),N(a,(t=>L(s,[e,t]))),N(i,(t=>L(n,[e,t]))),N(l,(t=>{v(e,t),L(r,[e,t])}))}),ne(i)),I),delRelationshipDefinition:e=>(H(t,e),h(e),I),getStore:o,getRelationshipIds:a,forEachRelationship:t=>i((s=>t(s,(t=>e.forEachRow(c(s),t))))),hasRelationship:l,getLocalTableId:c,getRemoteTableId:R,getRemoteRowId:(e,t)=>q(d(e)?.[0],t),getLocalRowIds:(e,t)=>Q(q(d(e)?.[1],t)),getLinkedRowIds:(e,t)=>x(d(e))?[t]:Q(p(e,t,!0)),addRemoteRowIdListener:(e,t,n)=>g(n,s,[e,t]),addLocalRowIdsListener:(e,t,s)=>g(s,n,[e,t]),addLinkedRowIdsListener:(e,t,s)=>(p(e,t),g(s,r,[e,t])),delListener:e=>(v(...w(e)),I),destroy:f,getListenerStats:()=>({})};return ue(I)})),Ee=e=>[e,e],ke=()=>[j(),j()],Je=(e,t,s,n=H)=>{const r=(o=e=>!fe(t,e),W(e).filter(o));var o;return h(ce(t),(n=>s(e,n,t[n]))),h(r,(t=>n(e,t))),e},Me=(e,t,s)=>x(e)||!he(e)||we(e)||de(e)?(s?.(),!1):(Le(e,((s,n)=>{t(s,n)||ge(e,n)})),!we(e)),Ae=(e,t,s)=>H(e,t,q(e,t)==-s?void 0:s),De=()=>{let e,t,s,n,o=0;const l=j(),d=j(),g=j(),L=j(),w=j(),p=j(),I=j(),S=j(),b=j(),C=j(),m=j(),V=j(),M=ee(),A=j(),D=j(),Q=j(),X=ke(),se=ke(),ne=ke(),re=ke(),oe=ke(),le=ke(),ce=ke(),de=ke(),he=ke(),pe=ke(),Re=ke(),Ie=ke(),Se=ke(),Te=ke(),[ye,be,Ce,me]=ie((()=>jt)),Ve=e=>{if(!Me(e,((e,t)=>i(["type","default"],t))))return!1;const t=e.type;return!(!k(t)&&t!=r||(Y(e.default)!=t&&ge(e,"default"),0))},xe=(t,s)=>(!e||F(b,s)||dt(s))&&Me(t,((e,t)=>Fe(s,t,e)),(()=>dt(s))),Fe=(e,t,s,n)=>Me(n?s:Ne(s,e,t),((n,r)=>E(Pe(e,t,r,n),(e=>(s[r]=e,!0)),(()=>!1))),(()=>dt(e,t))),Pe=(t,s,n,r)=>e?E(q(q(b,t),n),(e=>Y(r)!=e.type?dt(t,s,n,r,e.default):r),(()=>dt(t,s,n,r))):x(Y(r))?dt(t,s,n,r):r,Qe=(e,t)=>Me(t?e:Oe(e),((t,s)=>E(ze(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>ut())),ze=(e,s)=>t?E(q(m,e),(t=>Y(s)!=t.type?ut(e,s,t.default):s),(()=>ut(e,s))):x(Y(s))?ut(e,s):s,Ne=(e,t,s)=>(E(q(C,t),(([n,r])=>{N(n,((t,s)=>{fe(e,s)||(e[s]=t)})),N(r,(n=>{fe(e,n)||dt(t,s,n)}))})),e),Oe=e=>(t&&(N(V,((t,s)=>{fe(e,s)||(e[s]=t)})),N(M,(t=>{fe(e,t)||ut(t)}))),e),je=e=>Je(b,e,((e,t,s)=>{const n=j(),r=ee();Je($(b,t,j),s,((e,t,s)=>{H(e,t,s),E(s.default,(e=>H(n,t,e)),(()=>te(r,t)))})),H(C,t,[n,r])}),((e,t)=>{H(b,t),H(C,t)})),We=e=>Je(m,e,((e,t,s)=>{H(m,t,s),E(s.default,(e=>H(V,t,e)),(()=>te(M,t)))}),((e,t)=>{H(m,t),H(V,t),O(M,t)})),qe=e=>we(e)?Dt():Et(e),Be=e=>Je(D,e,((e,t,s)=>He(t,s)),((e,t)=>et(t))),He=(e,t)=>Je($(D,e,(()=>(rt(e,1),j()))),t,((t,s,n)=>$e(e,t,s,n)),((t,s)=>tt(e,t,s))),$e=(e,t,s,n,r)=>Je($(t,s,(()=>(ot(e,s,1),j()))),n,((t,n,r)=>Ge(e,s,t,n,r)),((n,o)=>st(e,t,s,n,o,r))),Ge=(e,t,s,n,r)=>{F(s,n)||at(e,t,n,1);const o=q(s,n);r!==o&&(it(e,t,n,o,r),H(s,n,r))},Ke=(e,t,s,n,r)=>E(q(t,s),(t=>Ge(e,s,t,n,r)),(()=>$e(e,t,s,Ne({[n]:r},e,s)))),Ue=e=>we(e)?Ft():kt(e),Xe=e=>Je(Q,e,((e,t,s)=>Ye(t,s)),((e,t)=>nt(t))),Ye=(e,t)=>{F(Q,e)||lt(e,1);const s=q(Q,e);t!==s&&(ct(e,s,t),H(Q,e,t))},Ze=e=>{const[t]=$(A,e,ae),s=t();return F(q(D,e),s)?Ze(e):s},_e=e=>q(D,e)??He(e,{}),et=e=>He(e,{}),tt=(e,t,s)=>{const[,n]=$(A,e,ae);n(s),$e(e,t,s,{},!0)},st=(e,t,s,n,r,o)=>{const a=q(q(C,e)?.[0],r);if(!x(a)&&!o)return Ge(e,s,n,r,a);const i=t=>{it(e,s,t,q(n,t)),at(e,s,t,-1),H(n,t)};x(a)?i(r):B(n,i),P(n)&&(ot(e,s,-1),P(H(t,s))&&(rt(e,-1),H(D,e),H(A,e)))},nt=e=>{const t=q(V,e);if(!x(t))return Ye(e,t);ct(e,q(Q,e)),lt(e,-1),H(Q,e)},rt=(e,t)=>Ae(l,e,t),ot=(e,t,s)=>Ae($(d,e,j),t,s),at=(e,t,s,n)=>Ae($($(g,e,j),t,j),s,n),it=(e,t,s,n,r)=>$($($(L,e,j),t,j),s,(()=>[n,0]))[1]=r,lt=(e,t)=>Ae(w,e,t),ct=(e,t,s)=>$(p,e,(()=>[t,0]))[1]=s,dt=(e,t,s,n,r)=>(R($($($(I,e,j),t,j),s,(()=>[])),n),r),ut=(e,t,s)=>(R($(S,e,(()=>[])),t),s),ht=(e,t,s)=>E(q(q(q(L,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...Ee(Ct(e,t,s))])),ft=e=>E(q(p,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Ee(xt(e))])),gt=e=>P(I)||P(he[e])?0:N(e?K(I,U):I,((t,s)=>N(t,((t,n)=>N(t,((t,r)=>be(he[e],[s,n,r],t))))))),Lt=e=>P(S)||P(pe[e])?0:N(e?K(S):S,((t,s)=>be(pe[e],[s],t))),wt=(e,t,s)=>{if(!P(t))return be(e,s),1},pt=e=>{const t=P(oe[e]),s=P(ce[e])&&P(re[e])&&t&&P(se[e]),n=P(de[e])&&P(le[e])&&P(ne[e])&&P(X[e]);if(!s||!n){const r=e?[K(l),U(d),K(g,U),K(L,U)]:[l,d,g,L];if(!s){N(r[2],((t,s)=>N(t,((t,n)=>wt(ce[e],t,[s,n])))));const s=ee();N(r[1],((n,r)=>{wt(re[e],n,[r])&&!t&&(be(oe[e],[r,null]),te(s,r))})),t||N(r[3],((t,n)=>{if(!F(s,n)){const s=ee();N(t,(e=>N(e,(([t,n],r)=>n!==t?te(s,r):O(e,r))))),N(s,(t=>be(oe[e],[n,t])))}})),wt(se[e],r[0])}if(!n){let t;N(r[3],((s,n)=>{let r;N(s,((s,o)=>{let a;N(s,(([s,i],l)=>{i!==s&&(be(de[e],[n,o,l],i,s,ht),t=r=a=1)})),a&&be(le[e],[n,o],ht)})),r&&be(ne[e],[n],ht)})),t&&be(X[e],void 0,ht)}}},vt=e=>{const t=P(Ie[e]),s=P(Se[e])&&P(Re[e]);if(!t||!s){const n=e?[K(w),K(p)]:[w,p];if(t||wt(Ie[e],n[0]),!s){let t;N(n[1],(([s,n],r)=>{n!==s&&(be(Se[e],[r],n,s,ft),t=1)})),t&&be(Re[e],void 0,ft)}}},Rt=(e,...t)=>(zt((()=>e(...f(t,a)))),jt),It=()=>G(D,(e=>G(e,G))),St=()=>W(D),Tt=e=>W(q(D,a(e))),yt=(e,t,s,n=0,r)=>{return f(v(u((o=q(D,a(e)),i=(e,s)=>[x(t)?s:q(e,a(t)),s],f([...o?.entries()??[]],(([e,t])=>i(t,e)))),(([e],[t])=>ve(e,t)*(s?-1:1))),n,x(r)?r:n+r),(([,e])=>e));var o,i},bt=(e,t)=>W(q(q(D,a(e)),a(t))),Ct=(e,t,s)=>q(q(q(D,a(e)),a(t)),a(s)),mt=()=>G(Q),Vt=()=>W(Q),xt=e=>q(Q,a(e)),Et=e=>Rt((()=>(e=>Me(e,xe,dt))(e)?Be(e):0)),kt=e=>Rt((()=>Qe(e)?Xe(e):0)),Jt=e=>{try{qe(y(e))}catch{}return jt},Mt=t=>Rt((()=>{if((e=Me(t,(e=>Me(e,Ve))))&&(je(t),!P(D))){const e=It();Dt(),Et(e)}})),At=e=>Rt((()=>{if(t=(e=>Me(e,Ve))(e)){const s=mt();Qt(),Ft(),t=!0,We(e),kt(s)}})),Dt=()=>Rt((()=>Be({}))),Ft=()=>Rt((()=>Xe({}))),Pt=()=>Rt((()=>{je({}),e=!1})),Qt=()=>Rt((()=>{We({}),t=!1})),zt=(e,t)=>{if(-1==o)return;Nt();const s=e();return Ot(t),s},Nt=()=>(o++,jt),Ot=e=>(o>0&&(o--,0==o&&(s=!P(L),n=!P(p),o=1,gt(1),s&&pt(1),Lt(1),n&&vt(1),o=-1,e?.(G(L,(e=>G(e,(e=>G(e,(e=>[...e]),(([e,t])=>e===t))),we)),we),G(I,(e=>G(e,G))),G(p,(e=>[...e]),(([e,t])=>e===t)),G(S))&&(o=1,N(L,((e,t)=>N(e,((e,s)=>N(e,(([e],n)=>Z(jt,t,s,n,e))))))),N(p,(([e],t)=>_(jt,t,e))),o=-1,s=n=!1),be(Te[0],void 0,s,n),gt(0),s&&pt(0),Lt(0),n&&vt(0),be(Te[1],void 0,s,n),o=0,h([l,d,g,L,I,w,p,S],z))),jt),jt={getTables:It,getTableIds:St,getTable:e=>G(q(D,a(e)),G),getRowIds:Tt,getSortedRowIds:yt,getRow:(e,t)=>G(q(q(D,a(e)),a(t))),getCellIds:bt,getCell:Ct,getValues:mt,getValueIds:Vt,getValue:xt,hasTables:()=>!P(D),hasTable:e=>F(D,a(e)),hasRow:(e,t)=>F(q(D,a(e)),a(t)),hasCell:(e,t,s)=>F(q(q(D,a(e)),a(t)),a(s)),hasValues:()=>!P(Q),hasValue:e=>F(Q,a(e)),getTablesJson:()=>T(D),getValuesJson:()=>T(Q),getJson:()=>T([D,Q]),getTablesSchemaJson:()=>T(b),getValuesSchemaJson:()=>T(m),getSchemaJson:()=>T([b,m]),setTables:Et,setTable:(e,t)=>Rt((e=>xe(t,e)?He(e,t):0),e),setRow:(e,t,s)=>Rt(((e,t)=>Fe(e,t,s)?$e(e,_e(e),t,s):0),e,t),addRow:(e,t)=>zt((()=>{let s;return Fe(e,s,t)&&(e=a(e),$e(e,_e(e),s=Ze(e),t)),s})),setPartialRow:(e,t,s)=>Rt(((e,t)=>{if(Fe(e,t,s,1)){const n=_e(e);Le(s,((s,r)=>Ke(e,n,t,r,s)))}}),e,t),setCell:(e,t,s,n)=>Rt(((e,t,s)=>E(Pe(e,t,s,J(n)?n(Ct(e,t,s)):n),(n=>Ke(e,_e(e),t,s,n)))),e,t,s),setValues:kt,setPartialValues:e=>Rt((()=>Qe(e,1)?Le(e,((e,t)=>Ye(t,e))):0)),setValue:(e,t)=>Rt((e=>E(ze(e,J(t)?t(xt(e)):t),(t=>Ye(e,t)))),e),setTablesJson:Jt,setValuesJson:e=>{try{Ue(y(e))}catch{}return jt},setJson:e=>{try{const[t,s]=y(e);qe(t),Ue(s)}catch{Jt(e)}return jt},setTablesSchema:Mt,setValuesSchema:At,setSchema:(e,t)=>Rt((()=>{Mt(e),At(t)})),delTables:Dt,delTable:e=>Rt((e=>F(D,e)?et(e):0),e),delRow:(e,t)=>Rt(((e,t)=>E(q(D,e),(s=>F(s,t)?tt(e,s,t):0))),e,t),delCell:(e,t,s,n)=>Rt(((e,t,s)=>E(q(D,e),(r=>E(q(r,t),(o=>F(o,s)?st(e,r,t,o,s,n):0))))),e,t,s),delValues:Ft,delValue:e=>Rt((e=>F(Q,e)?nt(e):0),e),delTablesSchema:Pt,delValuesSchema:Qt,delSchema:()=>Rt((()=>{Pt(),Qt()})),transaction:zt,startTransaction:Nt,finishTransaction:Ot,forEachTable:e=>N(D,((t,s)=>e(s,(e=>N(t,((t,s)=>e(s,(e=>B(t,e))))))))),forEachRow:(e,t)=>N(q(D,a(e)),((e,s)=>t(s,(t=>B(e,t))))),forEachCell:(e,t,s)=>B(q(q(D,a(e)),a(t)),s),forEachValue:e=>B(Q,e),addSortedRowIdsListener:(e,t,s,n,r,o,a)=>{let i=yt(e,t,s,n,r);return ye((()=>{const a=yt(e,t,s,n,r);c(a,i)||(i=a,o(jt,e,t,s,n,r,i))}),oe[a?1:0],[e,t],[St])},addWillFinishTransactionListener:e=>ye(e,Te[0]),addDidFinishTransactionListener:e=>ye(e,Te[1]),callListener:e=>(me(e),jt),delListener:e=>(Ce(e),jt),getListenerStats:()=>({}),createStore:De};return Le({Tables:[0,X],TableIds:[0,se],Table:[1,ne,[St]],RowIds:[1,re,[St]],Row:[2,le,[St,Tt]],CellIds:[2,ce,[St,Tt]],Cell:[3,de,[St,Tt,bt],e=>Ee(Ct(...e))],InvalidCell:[3,he],Values:[0,Re],ValueIds:[0,Ie],Value:[1,Se,[Vt],e=>Ee(xt(e[0]))],InvalidValue:[1,pe]},(([e,t,s,n],r)=>{jt["add"+r+"Listener"]=(...r)=>ye(r[e],t[r[e+1]?1:0],e>0?v(r,0,e):void 0,s,n)})),ue(jt)};exports.createCheckpoints=pe,exports.createCustomPersister=ye,exports.createFilePersister=(t,s)=>{let n;return ye(t,(async()=>{try{return await e.promises.readFile(s,"utf8")}catch{}}),(async t=>{try{await e.promises.writeFile(s,t,"utf8")}catch{}}),(t=>{n=e.watch(s,t)}),(()=>{n?.close(),n=void 0}))},exports.createIndexes=Re,exports.createLocalPersister=(e,t)=>Ce(e,t,localStorage),exports.createMetrics=Te,exports.createQueries=Ve,exports.createRelationships=xe,exports.createRemotePersister=(e,t,s,n)=>{let r,o;return ye(e,(async()=>{const e=await fetch(t);return o=me(e),e.text()}),(async e=>await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:e})),(e=>{r=setInterval((async()=>{const s=await fetch(t,{method:"HEAD"}),n=me(s);x(o)||x(n)||n==o||(o=n,e())}),1e3*n)}),(()=>{E(r,clearInterval),r=void 0}))},exports.createSessionPersister=(e,t)=>Ce(e,t,sessionStorage),exports.createStore=De,exports.defaultSorter=ve;
