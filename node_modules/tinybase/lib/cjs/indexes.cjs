"use strict";const e=e=>typeof e,t=e(""),n=e=>""+e,s=(e,t)=>e.every(t),r=(e,t)=>s(e,((n,s)=>0==s||t(e[s-1],n)<=0)),o=(e,t)=>e.sort(t),c=(e,t)=>e.forEach(t),d=e=>e.length,l=(e,...t)=>e.push(...t),a=e=>null==e,i=(e,t,n)=>a(e)?n?.():t(e),u=e=>Array.isArray(e),h=(e,t)=>e?.has(t)??!1,f=e=>a(e)||0==(e=>e.size)(e),I=e=>[...e?.values()??[]],g=e=>e.clear(),S=(e,t)=>e?.forEach(t),v=(e,t)=>e?.delete(t),w=e=>new Map(e),L=e=>[...e?.keys()??[]],x=(e,t)=>e?.get(t),p=(e,t)=>S(e,((e,n)=>t(n,e))),y=(e,t,n)=>a(n)?(v(e,t),e):e?.set(t,n),E=(e,t,n)=>(h(e,t)||y(e,t,n()),x(e,t)),R=(e,t,n,s,r=0)=>i((n?E:x)(e,t[r],r>d(t)-2?n:w),(o=>{if(r>d(t)-2)return s?.(o)&&y(e,t[r]),o;const c=R(o,t,n,s,r+1);return f(o)&&y(e,t[r]),c})),b=e=>new Set(u(e)||a(e)?e:[e]),T=(e,t)=>e?.add(t),k=(n,s)=>e(n)==t?e=>e(n):n??(()=>s??""),z=(e,t)=>e<t?-1:1,A=/^\d+$/,C=Object.freeze,D=(e=>{const t=new WeakMap;return e=>(t.has(e)||t.set(e,(e=>{const t=w(),D=w(),[M,j,m,O,W,$,q,,B,F,G]=((e,t,n)=>{const r=e.hasRow,o=w(),l=w(),R=w(),k=w(),z=w(),A=(t,n,...s)=>{const r=E(z,t,b);return c(s,(t=>T(r,t)&&n&&e.callListener(t))),s},C=(t,...n)=>i(x(z,t),(s=>{c(0==d(n)?I(s):n,(t=>{e.delListener(t),v(s,t)})),f(s)&&y(z,t)})),D=(e,n)=>{y(o,e,n),h(l,e)||(y(l,e,t()),y(R,e,w()),y(k,e,w()))},M=e=>{y(o,e),y(l,e),y(R,e),y(k,e),C(e)};return[()=>e,()=>L(o),e=>p(l,e),e=>h(l,e),e=>x(o,e),e=>x(l,e),(e,t)=>y(l,e,t),D,(t,o,l,i,f)=>{D(t,o);const I=w(),v=w(),L=x(R,t),E=x(k,t),b=t=>{const c=n=>e.getCell(o,t,n),l=x(L,t),h=r(o,t)?n(i(c,t)):void 0;var g,S;if(l===h||u(l)&&u(h)&&(S=h,d(g=l)===d(S)&&s(g,((e,t)=>S[t]===e)))||y(I,t,[l,h]),!a(f)){const e=x(E,t),n=r(o,t)?f(c,t):void 0;e!=n&&y(v,t,n)}},T=e=>{l((()=>{S(I,(([,e],t)=>y(L,t,e))),S(v,((e,t)=>y(E,t,e)))}),I,v,L,E,e),g(I),g(v)};p(L,b),e.hasTable(o)&&c(e.getRowIds(o),(e=>{h(L,e)||b(e)})),T(!0),C(t),A(t,0,e.addRowListener(o,null,((e,t,n)=>b(n))),e.addTableListener(o,(()=>T())))},M,()=>p(z,M),A,C]})(e,w,(e=>{return a(e)?"":u(e)?(t=n,e.map(t)):n(e);var t})),[H,J,K]=(e=>{let t;const[n,s]=(()=>{const e=[];let t=0;return[()=>e.shift()??""+t++,t=>{A.test(t)&&d(e)<1e3&&l(e,t)}]})(),r=w();return[(e,s,o,c=[],d=(()=>[]))=>{t??=P;const l=n();return y(r,l,[e,s,o,c,d]),T(R(s,o??[""],b),l),l},(e,n,...s)=>c(((e,t=[""])=>{const n=[],s=(e,r)=>r==d(t)?l(n,e):null===t[r]?S(e,(e=>s(e,r+1))):c([t[r],null],(t=>s(x(e,t),r+1)));return s(e,0),n})(e,n),(e=>S(e,(e=>x(r,e)[0](t,...n??[],...s))))),e=>i(x(r,e),(([,t,n])=>(R(t,n??[""],void 0,(t=>(v(t,e),f(t)?1:0))),y(r,e),s(e),n))),e=>i(x(r,e),(([e,,n=[],s,r])=>{const o=(...l)=>{const i=d(l);i==d(n)?e(t,...l,...r(l)):a(n[i])?c(s[i]?.(...l)??[],(e=>o(...l,e))):o(...l,n[i])};o()}))]})(),N=(t,n,s)=>{const r=W(t);S(s,((t,s)=>n(s,(n=>S(t,(t=>n(t,(n=>e.forEachCell(r,t,n)))))))))},P={setIndexDefinition:(e,n,s,c,d,l=z)=>{const u=a(d)?void 0:([e],[t])=>d(e,t);return B(e,n,((n,s,d,I,g,L)=>{let E=0;const R=b(),k=b(),z=$(e);if(S(s,(([e,t],n)=>{const s=b(e),r=b(t);S(s,(e=>v(r,e)?v(s,e):0)),S(s,(e=>{T(R,e),i(x(z,e),(t=>{v(t,n),f(t)&&(y(z,e),E=1)}))})),S(r,(e=>{T(R,e),h(z,e)||(y(z,e,b()),E=1),T(x(z,e),n),a(c)||T(k,e)}))})),n(),f(g)||(L?p(z,(e=>T(k,e))):p(d,(e=>i(x(I,e),(e=>T(k,e))))),S(k,(e=>{const t=(t,n)=>l(x(g,t),x(g,n),e),n=[...x(z,e)];r(n,t)||(y(z,e,b(o(n,t))),T(R,e))}))),(E||L)&&!a(u)){const t=[...z];r(t,u)||(q(e,w(o(t,u))),E=1)}E&&J(t,[e]),S(R,(t=>J(D,[e,t])))}),k(s),i(c,k)),P},delIndexDefinition:e=>(F(e),P),getStore:M,getIndexIds:j,forEachIndex:e=>m(((t,n)=>e(t,(e=>N(t,e,n))))),forEachSlice:(e,t)=>N(e,t,$(e)),hasIndex:O,hasSlice:(e,t)=>h($(e),t),getTableId:W,getSliceIds:e=>L($(e)),getSliceRowIds:(e,t)=>I(x($(e),t)),addSliceIdsListener:(e,n)=>H(n,t,[e]),addSliceRowIdsListener:(e,t,n)=>H(n,D,[e,t]),delListener:e=>(K(e),P),destroy:G,getListenerStats:()=>({})};return C(P)})(e)),t.get(e))})();exports.createIndexes=D;
