"use strict";var e=require("fs");const t=e=>null==e,s=(e,s,a)=>t(e)?a?.():s(e),a=Object.freeze,r=(e,r,o,n,i)=>{let c,l,d=0;const u={load:async(s,a)=>{if(2!=d){d=1;const o=await r();t(o)||""==o?e.transaction((()=>e.setTables(s).setValues(a))):e.setJson(o),d=0}return u},startAutoLoad:async(e,t)=>(u.stopAutoLoad(),await u.load(e,t),n(u.load),u),stopAutoLoad:()=>(i(),u),save:async()=>(1!=d&&(d=2,await o(e.getJson()),d=0),u),startAutoSave:async()=>(await u.stopAutoSave().save(),c=e.addTablesListener(u.save),l=e.addValuesListener(u.save),u),stopAutoSave:()=>(s(c,e.delListener),s(l,e.delListener),u),getStore:()=>e,destroy:()=>u.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return a(u)},o=globalThis.window,n=(e,t,s)=>{let a;return r(e,(async()=>s.getItem(t)),(async e=>s.setItem(t,e)),(e=>{a=a=>{a.storageArea===s&&a.key===t&&e()},o.addEventListener("storage",a)}),(()=>{o.removeEventListener("storage",a),a=void 0}))},i=e=>e.headers.get("ETag");exports.createCustomPersister=r,exports.createFilePersister=(t,s)=>{let a;return r(t,(async()=>{try{return await e.promises.readFile(s,"utf8")}catch{}}),(async t=>{try{await e.promises.writeFile(s,t,"utf8")}catch{}}),(t=>{a=e.watch(s,t)}),(()=>{a?.close(),a=void 0}))},exports.createLocalPersister=(e,t)=>n(e,t,localStorage),exports.createRemotePersister=(e,a,o,n)=>{let c,l;return r(e,(async()=>{const e=await fetch(a);return l=i(e),e.text()}),(async e=>await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:e})),(e=>{c=setInterval((async()=>{const s=await fetch(a,{method:"HEAD"}),r=i(s);t(l)||t(r)||r==l||(l=r,e())}),1e3*n)}),(()=>{s(c,clearInterval),c=void 0}))},exports.createSessionPersister=(e,t)=>n(e,t,sessionStorage);
